<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [ジェネリクス](#ジェネリクス)
  - [概要](#概要)
  - [ジェネリクスのメリット](#ジェネリクスのメリット)
  - [用語](#用語)
  - [仮型引数のローマ字が表す一般的な意味](#仮型引数のローマ字が表す一般的な意味)
  - [ジェネリクスのスコープ](#ジェネリクスのスコープ)
    - [ジェネリクスメソッドの使いどころ](#ジェネリクスメソッドの使いどころ)
  - [ジェネリクスの定義方法](#ジェネリクスの定義方法)
    - [ジェネリクスクラス](#ジェネリクスクラス)
    - [ジェネリクスメソッド](#ジェネリクスメソッド)
  - [継承元の実型引数を指定する方法](#継承元の実型引数を指定する方法)
  - [参考](#参考)

<!-- /TOC -->


# ジェネリクス

## 概要

ジェネリクスとは、クラス内 or メソッド内に定義した変数の型を動的に変更することで、  
そのクラス or メソッドを汎用的に使用することを可能にします。

ジェネリクスは、実行時に動的に型が変わるオブジェクトについて、  
コンパイル時に型チェックを行えるようにするために導入されました。

ジェネリクスの型情報はコンパイル時にのみ存在しており、実行時には消えています。  
この仕組みはイレイジャと呼ばれており、ジェネリクス登場前のコードとの共存を可能にしています。


## ジェネリクスのメリット

- コンパイル時に型チェックが可能になるため、早い段階でエラーを発見できる
- 実行時に Object 型から特定の型へキャストする必要がなくなる
- 実行時のキャストが不要になるため、キャストに失敗するリスクがなくなる


## 用語

- 仮型引数 (仮型パラメータ)
  - T などで、仮の型を表したもの
- 実型引数 (実型パラメータ)
  - T などの仮型引数に、実際にあてはめた型のこと ( String や Integer 等)
- ジェネリクスクラス
  - 仮型引数を持つクラス
- ジェネリクスインターフェース
  - 仮型引数を持つインターフェース
- ジェネリクス型
  - ジェネリクスクラスとジェネリクスインターフェースの総称
- パラメータ化された型
  - 変数の格納先としての型がジェネリクス型である場合、こう呼ぶことがある。
- 非境界型ワイルドカード型
  - `List<?>` のように、 `<>` 内に `?` のみが入ったパラメータ化された型のこと。
- 境界ワイルドカード型
  - `List<? extends E>` や `List<? super E>` のように、上限 or 下限が設定されたワイルドカード型のこと
- 原型
  - ジェネリクスが登場する前に存在していた `<>` を含まない `List` クラス等のこと
  - クラスリテラルでは原型を使用する必要があります。
  - 例えば、 `List.class` や `String[].class` や `int.class` などの場合です。
    - ジェネリクスを使用した `List<String>.class` や `List<?>.class` という記述はできません。
- イレイジャ
  - コンパイル時のみに型制約を強制し、実行時には型情報を破棄 (すなわちイレイズ) するというジェネリクスの仕様のこと
- アングルブラケット
  - `<>` 記号のこと。
 
**まとめ**

| 用語                   | 例                                                      |
| ---------------------- | ------------------------------------------------------- |
| 原型                   | List                                                    |
| ジェネリクス型         | List\<E>                                                |
| パラメータ化された型   | List\<String>                                           |
| 非境界ワイルドカード型 | List\<?>                                                |
| 境界ワイルドカード型   | List\<? extends Number> / List\<? super Number>         |
| 仮型パラメータ         | E                                                       |
| 実型パラメータ         | String                                                  |
| 境界型パラメータ       | \<E extends Number> /  \<E super Number>                |
| 再帰境界型パラメータ   | \<T extends Comparable\<T>> / \<T super Comparable\<T>> |
| ジェネリクスメソッド   | static \<E> List\<E> asList(E[] a)                      |
| 型トークン (※ 1 )      | String.class                                            |
| 具象化不可能型         | new List\<E>() (※ 2 )                                   |

(※ 1 )  
クラスリテラルが、コンパイル時と実行時の型情報を伝えるためにメソッドに渡された場合、  
それは型トークンと呼ばれます。
(※ 2 )  
E などの仮型引数を含む場合、インスタンス化ができない。  
実形引数ならインスタンス化できる。


## 仮型引数のローマ字が表す一般的な意味

| ローマ字     | 意味                |
| ------------ | ------------------- |
| E            | Element             |
| K            | Key                 |
| V            | Value               |
| T            | Type                |
| N            | Number              |
| S, U, V, ... | 2nd, 3rd, 4th types |
| R            | Return?             |
| P            | Parameter?          |


## ジェネリクスのスコープ

ジェネリクスには、スコープがクラスのものと、メソッドのものの 2 種類が存在しています。


### ジェネリクスメソッドの使いどころ

メソッドの呼び出し元でキャストが必要な場合、ジェネリクスメソッド化することで  
たいていの場合、キャストをしなくてもメソッドが呼び出せるようになります。

ジェネリクスメソッドは、ジェネリクス型を操作する共通メソッドを作成したい場合に  
`static` 修飾子とともによく使用されます。


## ジェネリクスの定義方法

### ジェネリクスクラス

**定義側のサンプル**

```Java
// クラス名の後ろに <> を記述し、その中に仮型引数の名前を定義する。
class MyClass<T> {
	// do something.
}
```


**使用側のサンプル**

```Java
public static void sample(String[] args) {

    // String 型として利用する例
    MyClass<String> cu1 = new MyClass<String>("Hello");

	// 省略表記の例
    MyClass<String> cu1 = new MyClass<>("Hello");

}

// 継承する場合の例
public class StringList extends ArrayList<String> {
	// do something.
}
```


### ジェネリクスメソッド

**定義側のサンプル**

```java
public class Generic {

	// 戻り値の型の前に <> で仮型引数の名前を定義する。
    public <T1> void method1(T1 arg){
		// do something.
    }

}
```


**使用側のサンプル**

```java
Generic generic = new Generic();

// 引数に型パラメータがある場合
// 引数が Human 型なので暗黙的に T が Human になる。
generic.method1(new Human());

// メソッド名の前に <> で実型引数を明示的に指定することができます。
// (大抵の場合は、引数にジェネリクス型が含まれているはずなので、あまりこの指定方法は使用されない。)
generic.<Human>method2();
```


## 継承元の実型引数を指定する方法

```java
// 直接指定した場合
public class MyArrayList extends ArrayList<String> {
}
// 間接的に指定した場合
public class MyArrayList<E> extends ArrayList<E> {
}
// 限定つきで間接的に指定した場合
public class MyArrayList<E extends String> extends ArrayList<E> {
}
```


## 参考

再帰ジェネリクスや内部クラスのジェネリクスなどあるようだが、難しそうなので、リンクだけ貼っておく。

[ジェネリクスの基礎とクラス設計への応用](https://www.slideshare.net/nagise/jjug2013-public)




