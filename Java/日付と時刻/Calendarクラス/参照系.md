<!-- TOC START min:1 max:3 link:true asterisk:false update:true -->
- [参照系](#参照系)
  - [インスタンスを取得する（現在の時刻で取得）](#インスタンスを取得する現在の時刻で取得)
  - [曜日を取得する](#曜日を取得する)
  - [日時を取得する](#日時を取得する)
    - [long 型 [単位 : ミリ秒] で日時を取得する](#long-型-単位--ミリ秒-で日時を取得する)
  - [Calendar オブジェクト同士の大小比較](#calendar-オブジェクト同士の大小比較)
    - [before/after/equalsを使用した方法](#beforeafterequalsを使用した方法)
    - [compareToを使用した方法](#comparetoを使用した方法)
  - [当月の最終日を取得する](#当月の最終日を取得する)
  - [二つの Calendar オブジェクトの差分日数を算出](#二つの-calendar-オブジェクトの差分日数を算出)
    - [1 日未満の時間差は 0 日として切り捨てて日数をカウントする場合](#1-日未満の時間差は-0-日として切り捨てて日数をカウントする場合)
    - [日付のみで日数をカウントする場合（時間は考慮しない場合）](#日付のみで日数をカウントする場合時間は考慮しない場合)
  - [二つの Calendar オブジェクトが同じ日付かどうかを判定する](#二つの-calendar-オブジェクトが同じ日付かどうかを判定する)
  - [年の第何週目かを取得](#年の第何週目かを取得)
  - [月の第何週目かを取得](#月の第何週目かを取得)
<!-- TOC END -->


# 参照系

## インスタンスを取得する（現在の時刻で取得）

```java
Calendar calendar = Calendar.getInstance();
// getInstanceだけでも現在の日時のセットされたCalendarオブジェクトが取得可能であるが、
// ネット上のサンプルコードを見ていると、その後、以下のように明示的に現在の日時をセットしているコードも存在する。
// 明示的にセットする必要性があるのかどうかはわからない。
calendar.setTimeInMillis(System.currentTimeMillis());
```


## 曜日を取得する

```java
Calendar calendar = Calendar.getInstance();
// 1:Sunday,2:Monday,3:Tuesday,4:Wednesday,
// 5:Thursday,6:Friday,7:Saturday
int dayOfTheWeek = calendar.get(Calendar.DAY_OF_WEEK);
```


## 日時を取得する

```java
Calendar calendar = Calendar.getInstance();
int thisYear = calendar.get(Calendar.YEAR);
int thisMonthMinus1 = calendar.get(Calendar.MONTH);
int thisMonth = thisMonthMinus1 + 1;
// Calendar.DATE と Calendar.DAY_OF_MONTH は同じ結果を返す。
int today1 = calendar.get(Calendar.DATE);
int today2 = calendar.get(Calendar.DAY_OF_MONTH);
int hour1 = calendar.get(Calendar.HOUR_OF_DAY); // 24 時間表記
int hour2 = calendar.get(Calendar.HOUR); // 12 時間表記
int minute = calendar.get(Calendar.MINUTE);
```


### long 型 [単位 : ミリ秒] で日時を取得する

```Java
Calendar calendar = Calendar.getInstance();
long dateTime = calendar.getTimeInMillis();
```


## Calendar オブジェクト同士の大小比較

### before/after/equalsを使用した方法

```Java
Calendar cal = Calendar.getInstance();
Calendar cal2 = Calendar.getInstance();
cal.set(Calendar.YEAR, 2016);
cal2.set(Calendar.YEAR, 2010);
System.out.println(cal.before(cal2));   // 結果：false
System.out.println(cal.equals(cal2));   // 結果：false
System.out.println(cal.after(cal2));    // 結果：true
```

カレンダーが同じであるとは、日付／時刻値が同じであるだけでなく、タイムゾーンやロケールなどのカレンダー設定も等しいことを意味します。
これらが異なるカレンダーに対して、 `equals()` メソッドは `false` を返します。

**<注意>**  
`before()` `after()` は、**ミリ秒以下を比較しません。**（おそらく `equals` も同様）  
例えば、`10時20分30秒000 before 10時20分30秒100` の場合、右の方が後であるため、本来ならば  
`true` を返してほしいところですが、ミリ秒を無視するため、 `false` が返ってきます。  
`10時20分30秒000 before 10時20分31秒000` となった時点で初めて `true` が返ってきます。


### compareToを使用した方法

```Java
Calendar cal1 = Calendar.getInstance(); // cal1のインスタンスを生成
Calendar cal2 = Calendar.getInstance(); // cal2のインスタンスを生成

cal1.set(2018, 5, 1, 13, 10, 20); // それぞれ値をセット
cal2.set(2018, 5, 1, 13, 10, 21);

System.out.println(cal1.compareTo(cal2)); // -1
System.out.println(cal2.compareTo(cal1)); // 1
System.out.println(cal1.compareTo(cal1)); // 0
```


## 当月の最終日を取得する

```java
calendar.getActualMaximum(Calendar.DAY_OF_MONTH);
```

例えば、calendarオブジェクトが3月を指す場合、31日が最終日なので、31が返される。


## 二つの Calendar オブジェクトの差分日数を算出

### 1 日未満の時間差は 0 日として切り捨てて日数をカウントする場合

```java
public class CalendarUtil {

    /**
     * calendar1 を基準として、 calendar2 が何日離れているかを返すメソッド。
     * calendar2 が calendar1 よりも未来の場合は、正の整数を返す。
     * calendar2 が calendar1 よりも過去の場合は、負の整数を返す。
    **/
    public static int diffDaysFromCalendar1To2(Calendar calendar1, Calendar calendar2) {
        long diffMillis = calendar2.getTimeInMillis() - calendar1.getTimeInMillis();
        int OneDayInMillis = 1000 * 60 * 60 * 24;  // 1 日を「秒」で表した値
        return (int) (diffMillis / OneDayInMillis);  // ※ 1
    }

}
```

**(※ 1 ) に関する補足**

long 型と int 型の四則演算は、まず、 int 型が long 型に変換されます。  
long 型と long 型の計算結果は long 型になります。

`(int)` によるキャストは、小数点以下を切り捨てます。  
マイナスの数値の場合は、正の方向に近い整数にまるめられます。  

計算結果は int 型に収まるため、 int 型にキャストしてから代入しています。


### 日付のみで日数をカウントする場合（時間は考慮しない場合）

```Java
public class CalendarUtil {

    /**
     * パラメータで渡された Calendar オブジェクトの時間は切り捨てて、
     * 日付の部分のみを考慮して、二つの Calendar の差分日数を返します。
     *
     * @param calendarFrom 起点となる日付
     * @param calendarTo 起点からの差分を求めたい日付
     * @return 起点から終点までの差分日数
     */
    public static int diffDaysFromParam1To2(Calendar calendarFrom, Calendar calendarTo) {
        Calendar from = Calendar.getInstance();
        from.setTimeInMillis(calendarFrom.getTimeInMillis());
        from.set(Calendar.HOUR, 0);
        from.set(Calendar.MINUTE, 0);
        from.set(Calendar.SECOND, 0);
        from.set(Calendar.MILLISECOND, 0);

        Calendar to = Calendar.getInstance();
        to.setTimeInMillis(calendarTo.getTimeInMillis());
        to.set(Calendar.HOUR, 0);
        to.set(Calendar.MINUTE, 0);
        to.set(Calendar.SECOND, 0);
        to.set(Calendar.MILLISECOND, 0);

        long diffDaysInMillis = to.getTimeInMillis() - from.getTimeInMillis();
        long oneDayInMillis = 1000 * 60 * 60 * 24;
        return (int) (diffDaysInMillis / oneDayInMillis);
    }

}
```


## 二つの Calendar オブジェクトが同じ日付かどうかを判定する

Calendar クラスには、日付が同じかどうかを判定するメソッドは用意されていないため、  
以下のユーティリティを作成して使用するのが良いです。

```Java
public class CalendarUtil {

    public static boolean isSameDate(Calendar calendar1, Calendar calendar2) {
        // 「 %tF 」 フォーマットで 「 2022-01-31 」 形式の文字列を取得
        String dateString1 = String.format(Locale.JAPAN, "%tF", calendar1);
        String dateString2 = String.format(Locale.JAPAN, "%tF", calendar2);
        return dateString1.equals(dateString2);
    }

}
```


## 年の第何週目かを取得

```Java
Calendar cal = Calendar.getInstance();
cal.get(Calendar.WEEK_OF_YEAR);
```


## 月の第何週目かを取得

```Java
Calendar cal = Calendar.getInstance();
cal.get(Calendar.WEEK_OF_MONTH);

// デフォルトだと週始めは日曜日（日曜日〜土曜日で一週間）ですが、週始めをずらすことも出来ます。
cal.setFirstDayOfWeek(Calendar.MONDAY);
```
