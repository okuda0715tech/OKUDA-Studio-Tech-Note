- [Adapter（Wrapper）パターン](#adapterwrapperパターン)
  - [役割](#役割)
  - [実装方法](#実装方法)
  - [使いどころ](#使いどころ)
    - [API レベル対応](#api-レベル対応)
    - [RecyclerView や ListView の Adapter](#recyclerview-や-listview-の-adapter)
    - [異なるライブラリやAPIを統一したインターフェースで扱う](#異なるライブラリやapiを統一したインターフェースで扱う)
    - [テスト容易性（モック化）やDI（依存性注入）のための抽象化](#テスト容易性モック化やdi依存性注入のための抽象化)
    - [旧システムとの互換性確保](#旧システムとの互換性確保)
    - [複数データソースの統一インターフェース提供](#複数データソースの統一インターフェース提供)


# Adapter（Wrapper）パターン

## 役割

- 「既に提供されているもの」 と 「実際に必要なもの」 の間にある 「ずれ」 を解消する。
- 異なるものを同じように扱えるようにする。


## 実装方法

Adapter パターンの実装方法には、以下の 2 種類の方法があります。

- 継承を使用した方法 (クラスを使用した方法)
- 委譲を使用した方法 (インスタンスを使用した方法)


## 使いどころ

### API レベル対応

`BiometricPrompt` は API 28（Android 9）以降で導入された機能ですが、それ以前のバージョンもサポートしたいときに、 Adapter パターンが活躍します。

```kotlin
// Target 役
interface BiometricAuthAdapter {
    fun authenticate()
}
```

```kotlin
// Adapter 役
class BiometricPromptAdapter(private val context: Context) : BiometricAuthAdapter {
    override fun authenticate() {
        // BiometricPrompt を使った認証
    }
}
```

```kotlin
// Adapter 役
class LegacyFingerprintAdapter(private val context: Context) : BiometricAuthAdapter {
    override fun authenticate() {
        // FingerprintManager を使った認証（旧方式）
    }
}
```

```kotlin
// Adapter を提供するメソッド
fun provideBiometricAdapter(context: Context): BiometricAuthAdapter {
    return if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {
        BiometricPromptAdapter(context)
    } else {
        LegacyFingerprintAdapter(context)
    }
}
```

このようにすることで、アプリのロジック部分は、 `BiometricAuthAdapter` にだけ依存し、内部実装をバージョンによって切り替えられます。


### RecyclerView や ListView の Adapter

これは「データ構造（ List ）」を「 View（ UI 表示）」に適合させる Adapter パターンの典型です。


### 異なるライブラリやAPIを統一したインターフェースで扱う

```kotlin
interface Logger {
    fun log(message: String)
}

class TimberAdapter : Logger {
    override fun log(message: String) {
        Timber.d(message)
    }
}

class AndroidLogAdapter : Logger {
    override fun log(message: String) {
        Log.d("App", message)
    }
}
```


### テスト容易性（モック化）やDI（依存性注入）のための抽象化

外部依存（例えばストレージ、ネットワーク、センサーなど）をモックしやすくする

```kotlin
interface LocationProvider {
    fun getCurrentLocation(): Location
}

class GpsLocationAdapter : LocationProvider {
    override fun getCurrentLocation(): Location {
        // 実際のGPSから取得
    }
}

class FakeLocationAdapter : LocationProvider {
    override fun getCurrentLocation(): Location {
        return Location("mock").apply { latitude = 35.0; longitude = 139.0 }
    }
}
```


### 旧システムとの互換性確保

古いシステムのインターフェースを、新しいシステムでも使えるようにする。

- 例
  - 旧方式のデータモデル → 新方式のデータモデルへの変換
  - 旧DB（SQLite）と新DB（Room）の共存


### 複数データソースの統一インターフェース提供

API・キャッシュ・ローカルDBなど、異なるソースからのデータ取得を抽象化

```kotlin
interface DataSource {
    fun getData(): List<Item>
}

class ApiDataSource : DataSource { /* ネットワーク経由 */ }
class CacheDataSource : DataSource { /* メモリ・SharedPref */ }
```

