- [Visitor パターン](#visitor-パターン)
  - [役割](#役割)
  - [実装方法](#実装方法)
    - [基本的な例](#基本的な例)
    - [Kotlin で簡潔に表現した例](#kotlin-で簡潔に表現した例)
  - [使いどころ](#使いどころ)


# Visitor パターン

## 役割

処理をデータ構造から分離します。処理をビジター役に集中することにより、ビジター役の修正が容易になります。


## 実装方法

### 基本的な例

以下に Visitor パターンの実装例を提示しますが、これは、冗長な書き方です。 Kotlin の 「 sealed クラス + when 」 を使用すれば、簡潔に記述することができあますが、 Visitor パターンの勉強のために、あえて冗長な書き方をしています。

```kotlin
interface UiStateVisitor {
    fun visitLoading()
    fun visitSuccess(data: String)
    fun visitError(message: String)
}

sealed class UiState {
    abstract fun accept(visitor: UiStateVisitor)

    object Loading : UiState() {
        // accept メソッドの中身は、ビジターの visit メソッドをすぐに呼び返すのが、
        // Visitor パターンの特徴です。
        // これにより、 Visitor 側の「オープン・クローズド(※ 1 )」を実現しています。
        override fun accept(visitor: UiStateVisitor) = visitor.visitLoading()
    }

    data class Success(val data: String) : UiState() {
        override fun accept(visitor: UiStateVisitor) = visitor.visitSuccess(data)
    }

    data class Error(val message: String) : UiState() {
        override fun accept(visitor: UiStateVisitor) = visitor.visitError(message)
    }
}
```

(※ 1 ) オープン・クローズドの原理とは、機能を追加する際に、既存のコードの修正が少なく、機能追加が容易であることです。

```kotlin
@Composable
fun MyScreen(uiState: UiState) {
    uiState.accept(object : UiStateVisitor {
        override fun visitLoading() {
            LoadingView()
        }

        override fun visitSuccess(data: String) {
            SuccessView(data)
        }

        override fun visitError(message: String) {
            ErrorView(message)
        }
    })
}
```

### Kotlin で簡潔に表現した例

具体的な要素の約が、ビジターの visit メソッドを呼び返す際に、「自分がどの要素なのか」という情報しか返さないことが、 Visitor パターンの特徴です。そのため、 Kotlin の sealed クラス + when を使用すれば、 Visitor パターンを簡単に実現することができます。

```kotlin
sealed class UiState {
    object Loading : UiState()
    data class Success(val data: String) : UiState()
    data class Error(val message: String) : UiState()
}

@Composable
fun MyScreen(uiState: UiState) {
    when (uiState) {
        is UiState.Loading -> LoadingView()
        is UiState.Success -> SuccessView(uiState.data)
        is UiState.Error -> ErrorView(uiState.message)
    }
}
```


## 使いどころ




