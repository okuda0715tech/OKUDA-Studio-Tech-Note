- [ファイル形式](#ファイル形式)
  - [DB をファイルにバックアップする際のファイル形式](#db-をファイルにバックアップする際のファイル形式)
  - [それぞれのファイル形式のメリットとデメリット](#それぞれのファイル形式のメリットとデメリット)
    - [JSON 形式](#json-形式)
    - [CSV や TSV](#csv-や-tsv)
    - [独自の区切り文字を使用した形式](#独自の区切り文字を使用した形式)
  - [カンマ / タブ文字 / 改行コードの置き換えに関する注意点](#カンマ--タブ文字--改行コードの置き換えに関する注意点)
  - [ファイル形式の選定基準](#ファイル形式の選定基準)


# ファイル形式

## DB をファイルにバックアップする際のファイル形式

DB をファイルにバックアップする際のファイル形式には、以下の 3 通りの形式が考えられます。

1. JSON 形式
2. CSV や TSV などの一般的な区切り文字を使用した形式
3. 独自の区切り文字を使用した形式


## それぞれのファイル形式のメリットとデメリット

### JSON 形式

- メリット
  - データにタブや改行が含まれていても特に気にすることなくデータを扱うことができる。
- デメリット
  - データ一件ごとにタグ情報が付与されるため、ファイルサイズが大きくなりやすい。


### CSV や TSV

- メリット
  - 出力されるファイルには、軽量な区切り文字程度しか含まれないため、ファイルサイズが小さくできる。
- デメリット
  - データにコンマ / タブ / 改行が含まれている場合にはそれを適切に処理しなければデータが復元できなかったり、復元前後でデータに差異が生じてしまうリスクがある。
  - 改行コードを一旦別の文字に置き換える必要がある。そうしないと、 CSV や TSV ファイル内で、本来一行であるべきデータが複数行になってしまう。


### 独自の区切り文字を使用した形式

- メリット
  - データ中に含まれることがあり得ないような区切り文字を使用することで、データの復元に失敗するリスクを軽減できる。
- デメリット
  - 区切り文字にある程度の長さが必要なため、ファイル出力した際のデータ量が CSV や TSV よりも増える傾向がある。
  - 改行コードの一旦別の文字に置き換える必要がある。そうしないと、 CSV や TSV ファイル内で、本来一行であるべきデータが複数行になってしまう。


## カンマ / タブ文字 / 改行コードの置き換えに関する注意点

CSV や TSV などの区切り文字形式のファイルフォーマットの場合、改行コード `\n` 等を別の文字に置き換える場合には注意が必要です。

例えば、 `\n` をエスケープして `\\n` に置き換えた場合、アンエスケープ時に不具合が生じる可能性があります。

なぜなら、ユーザーが `\\n` というデータを登録していた場合には、アンエスケープ時に、その文字が `\n` に置き換えられてしまう危険性があります。

文字を置き換える場合は、どう考えてもユーザーが登録することがないような文字に置き換えれば問題は発生しないと思われます。


## ファイル形式の選定基準

- 一つのテーブルあたりのデータ量が少なければ、 JSON でも OK 。
- 一つのテーブルあたりのデータ量が多ければ、 CSV , TSV , 独自の区切り文字形式を検討しても良い。




