- [拡張プロパティ](#拡張プロパティ)
  - [概要](#概要)
  - [拡張プロパティはバッキングフィールドを持たない](#拡張プロパティはバッキングフィールドを持たない)
  - [使いどころ](#使いどころ)
  - [サンプル](#サンプル)
    - [文字列の末尾の一文字を取得・更新する例](#文字列の末尾の一文字を取得更新する例)
    - [Duration オブジェクトを生成する例](#duration-オブジェクトを生成する例)
  - [companion object の拡張プロパティ](#companion-object-の拡張プロパティ)
  - [拡張プロパティのスコープ](#拡張プロパティのスコープ)


# 拡張プロパティ

## 概要

拡張プロパティは、変更できないサードパーティライブラリのクラスまたはインターフェイスの新しいプロパティを作成できます。  
このようなプロパティは、元のクラスのプロパティであるかのように、通常の方法で参照ことができます。

実際には、拡張プロパティは、クラスに新しいプロパティを追加するのではなく、クラスの外にプロパティを定義します。  
しかし、あたかもクラスの中にプロパティを追加したかのように、プロパティを参照することができます。

ただし、バッキングフィールドを持たないため、次のような制約が発生します。


## 拡張プロパティはバッキングフィールドを持たない

拡張プロパティはバッキングフィールドを持たないため、  
以下の二つの制約があります。

**1. イコール文 ( `=` ) で初期化することはできません。**

イコール文による初期化はセッターを経由せず、バッキングフィールドに直接値を代入するため、  
バッキングフィールドを持たない拡張プロパティでは行えません。

**2. アクセッサー内で field を参照することができません。**

バッキングフィールドを持たないため、当然ですが、 field を参照することができません。


## 使いどころ

拡張プロパティはバッキングフィールドを持たないため、フィールドに値を保持することができません。

つまり、 **拡張プロパティとは、フィールドを定義せず、アクセッサーのみを新たに定義するもの** ということになります。

よって、使いどころとしては、  
拡張プロパティのアクセッサーの中で、レシーバーのプロパティを参照したり、  
レシーバーの関数を呼び出すと便利な場合に使用する機能になりそうです。


## サンプル

### 文字列の末尾の一文字を取得・更新する例

```kotlin
/** 末尾の文字を取得・設定します */
var StringBuilder.lastChar: Char
    get() = get(length - 1)
    set(value) {
        setCharAt(length - 1, value)
    }

val sb = StringBuilder("ABC")
sb.lastChar = 'X'
println(sb)  // "ABX"
```


### Duration オブジェクトを生成する例

```kotlin
val fiveHundredMilliseconds: Duration = 500.milliseconds

@kotlin.internal.InlineOnly
public inline val Int.milliseconds get() = toDuration(DurationUnit.MILLISECONDS)
```

`toDuration()` 関数は、指定された数値と単位を使用して、その期間を表す Duration オブジェクトを返します。 Duration オブジェクトは期間をナノ秒で保持するため、 500 ミリ秒を 500,000,000 ナノ秒に変換して値を保持します。したがって、 toDuration() 関数内では、単位の変換と Duration オブジェクトの生成が行われています。


## companion object の拡張プロパティ

`companion object` に対して、拡張プロパティを定義することも可能です。

```kotlin
class MyClass {
    companion object {}
}

// companion object の拡張プロパティを定義
val MyClass.Companion.companionVal: String
    get() = "companion val"

// companion object の拡張プロパティを参照
MyClass.companionVal
```


## 拡張プロパティのスコープ

ほとんどの場合、拡張プロパティはパッケージ直下 (ファイルのトップレベル) に定義されます。  
パッケージ直下に定義された拡張プロパティは、パッケージ直下に定義された普通の関数と同じ方法で呼び出せます。


