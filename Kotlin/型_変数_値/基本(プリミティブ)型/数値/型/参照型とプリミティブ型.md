- [参照型とプリミティブ型](#参照型とプリミティブ型)
  - [概要](#概要)
  - [Kotlin から Java へ変換されたときに何が起こるか](#kotlin-から-java-へ変換されたときに何が起こるか)


# 参照型とプリミティブ型

## 概要

Kotlin には、 Java の `int` のようなプリミティブ型は存在しないと思われがちだが、  
実は、 Kotlin のコードがコンパイル時に Java に変換されると、  
Java のプリミティブ型が生成される場合が多々あるため、  
その点について、このドキュメントでは解説していきます。


## Kotlin から Java へ変換されたときに何が起こるか

Kotlin は JVM プラットフォーム上で動作しており、  
コンパイルされると Java のコードが生成されます。

`Int?` などの null 許容型の数値型は、 Java コードが生成されると `Integer` などの参照型になります。  
`Int` などの null を許容しない数値型は、 Java コードが生成されると `int` などのプリミティブ型になります。

同じ値を null 許容型の別のプロパティに代入した場合は、  
その都度、新しいインスタンスが生成されます。

```kotlin
val a: Int = 10000
// Integer 型の新しいインスタンスを生成
val boxedA: Int? = a
// 別の新しいインスタンスを生成
val anotherBoxedA: Int? = a

// 同じインスタンスを示しているかの判定
println(boxedA === anotherBoxedA) // false
```

ただし、 -128 から 127 までの整数に関しては、 JVM が最適化を行い、  
その都度インスタンスを生成せず、全てのプロパティは、最初に生成したインスタンスを参照します。

```kotlin
// 最初に 100 を代入した時点で、
// Integer 型のインスタンスが一つだけ生成されていると思われる。
val b: Int = 100
val boxedB: Int? = b
val anotherBoxedB: Int? = b

println(boxedB === anotherBoxedB) // true
```


