- [リフレクション](#リフレクション)
  - [概要](#概要)
  - [JVM 依存関係](#jvm-依存関係)
  - [クラス参照](#クラス参照)
    - [KClass の取得](#kclass-の取得)
    - [変数の型ではなく実際の型の情報が取得される](#変数の型ではなく実際の型の情報が取得される)
    - [Class の取得](#class-の取得)
  - [呼び出し可能な参照](#呼び出し可能な参照)
  - [関数参照、プロパティ参照、コンストラクタ参照の使い所](#関数参照プロパティ参照コンストラクタ参照の使い所)
    - [関数参照](#関数参照)
    - [プロパティ参照](#プロパティ参照)
    - [コンストラクタ参照](#コンストラクタ参照)


# リフレクション

## 概要

リフレクションは、言語とライブラリ機能の一部で、実行時に自分の書いたプログラムの構造を内観することを可能にします。 Kotlin では、関数とプロパティは第一級オブジェクトであり、それらを内観すること (例えば、プロパティの型や関数の名前を実行時にな学習すること) は、関数を使用したり、リアクティブなスタイルを使用する上で、必要不可欠なことです。

Kotlin/JS では、リフレクションの機能の提供を一部制限しています。


## JVM 依存関係

リフレクションの機能を使用するには、依存関係を追加する必要があります。

```kotlin
dependencies {
    implementation(kotlin("reflect"))
}
```


## クラス参照

### KClass の取得

Kotlin クラス ( `KClass` ) への実行時参照を取得する機能は、リフレクションの最も基本的な機能です。 Kotlin クラスへの参照を取得するには次のように **クラスリテラル** 文法を使用します。

```kotlin
// KClass 型の値を取得する方法は二種類あります。

// 方法１：アンバインドなクラス参照
// 'クラス名::class' による参照
val c1 = MyClass::class

// 方法２：バインドされたクラス参照
// 'インスタンス名::class' による参照
val m = MyClass()
val c2 = m::class
```

`クラス名::class` による参照も `インスタンス名::class` による参照も返されるオブジェクトは全く同じ物になります。


### 変数の型ではなく実際の型の情報が取得される

以下の例で、 `GoodPerson` は、 `Person` クラスを継承しているものとします。 `person` インスタンスは `Person` 型のプロパティに格納されていますが、実際のオブジェクトは `GoodPerson` なので、クラス参照を行うと `GoodPerson` の KClass が取得されます。

```kotlin
val person: Person = GoodPerson("Taro")
Log.d("test", "person = ${person::class.qualifiedName}")
// person = com.example.mykotlinpractice.GoodPerson
```


### Class の取得

Java クラス ( `Class` ) への実行時参照を取得するには、 KClass インスタンスに対して `.java` を付与します。

```Kotlin
// Class 型の値が取得されます。
val c = MyClass::class.java
```

`Activity` の遷移などで `Intent` を生成する場合は、  
この `Class` クラスを取得する必要があります。


## 呼び出し可能な参照

関数参照、プロパティ参照、コンストラクタ参照は、関数型のインスタンスとして使用されます (呼び出されます) 。

すべての呼び出し可能な参照に共通のスーパータイプは `KCallable<out R>` です。 `R` は、プロパティの場合はプロパティの型であり、コンストラクターの場合は生成されたクラスの型です。


## 関数参照、プロパティ参照、コンストラクタ参照の使い所

関数参照、プロパティ参照、コンストラクタ参照は、関数の引数に渡すことで力を発揮します。

関数の引数に各種の参照を渡すことで、以下のメリットが享受できます。

- ライブラリなど、変更ができない関数に対して、実質的に変更が加えられる
- 関数の呼び出し時点では、呼び出されず、関数の内部で呼び出される
  - そのため、関数の呼び出し時には引数の値などが確定していなくても問題ない


### 関数参照

別紙 「関数参照.md 」 を参照してください。


### プロパティ参照

別紙 「プロパティ参照.md 」 を参照してください。


### コンストラクタ参照

別紙 「コンストラクタ参照.md 」 を参照してください。



