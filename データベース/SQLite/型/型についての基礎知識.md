<!-- TOC START min:1 max:3 link:true asterisk:false update:true -->
- [型についての基礎知識](#型についての基礎知識)
  - [動的型付けシステムとは](#動的型付けシステムとは)
  - [データが分類される型](#データが分類される型)
    - [Boolean 型は存在しない](#boolean-型は存在しない)
    - [分類方法](#分類方法)
  - [型の親和性（Type Affinity）](#型の親和性type-affinity)
    - [型の親和性（Type Affinity）とは](#型の親和性type-affinityとは)
    - [型の親和性の一覧](#型の親和性の一覧)
    - [親和性の決定優先順位](#親和性の決定優先順位)
    - [型の新和性よる変換](#型の新和性よる変換)
<!-- TOC END -->


# 型についての基礎知識

## 動的型付けシステムとは

SQLite では、動的型付けシステムを採用しています。特徴は以下の通りです。

- 通常のデータベースのように、テーブルのカラムに型を定義することはしません。
- データそのものに型を持たせます。
- そのため、一つのカラムに様々なデータ型のデータが格納される可能性があります。

ただし、 2021 年 11 月ごろにリリースされたバージョン 3.37.0 では、 STRICT TABLE という仕組みで、静的型付けが可能になりました。


## データが分類される型

SQLite は、 INSERT や UPDATE 文中のデータの記述方法で、データがどのデータ型なのかを識別しています。  
データ型は以下の 5 つのいずれかに分類されます。

| 型      | 保持されるデータの種類 | 補足                                         |
|---------|------------------------|----------------------------------------------|
| INTEGER | 符号付整数             | 1, 2, 3, 4, 6, or 8 バイトで格納             |
| REAL    | 浮動小数点数           | 8バイトで格納                                |
| TEXT    | テキスト               | UTF-8, UTF-16BE or UTF-16-LEのいずれかで格納 |
| BLOB    | バイナリデータ         | 入力データをそのまま格納                     |
| NULL    | NULL 値                | -                                            |

### Boolean 型は存在しない

Boolean 型は存在しないため、 `INTEGER` 型の `0 (偽)` 、 `1 (真)` で表現するのが一般的です。


### 分類方法

数値ではあるが、小数点も指数 ( ※ 1 ) も無ければ `INTEGER` 型  
数値であり、小数点か指数があれば `REAL` 型  
「シングルクオート ( `'` ) 」 で囲まれていれば `TEXT` 型  
値が `NULL` であれば、 `NULL` 型  
上記のいずれにも該当しなければ、 `BLOB` 型

( ※ 1 )  
例 : `3.0e+3` は 3000 を表します。


## 型の親和性（Type Affinity）

### 型の親和性（Type Affinity）とは

- カラムに型付けしているように見えるのは、 「型の親和性 ( Type Affinity ) 」 と呼ばれるものです。
- 型の親和性を定義することにより、データをテーブルに格納する際に、定義した型に変換してから格納されます。
- テーブル定義時に親和性を指定するかどうかは任意です。


### 型の親和性の一覧

| 型 (型の親和性) | エイリアス 1 | エイリアス 2 | エイリアス 3 |
|-----------------|--------------|--------------|--------------|
| INTEGER         | INT を含む   | -            | -            |
| REAL            | FLOA を含む  | DOUB を含む  | -            |
| NUMERIC ( ※ 1 ) | -            | -            | -            |
| TEXT            | CHAR を含む  | CLOB を含む  | TEXT を含む  |
| BLOB ( ※ 2 )    | BLOB を含む  | 無指定       | -            |

( ※ 1 )  
何らかの親和性が指定されているけれど、上記の表のいずれにも該当しない場合は、 `NUMERIC` となります。  
( ※ 2 )  
古い SQLite では、 `BLOB` 型は `NONE` 型として定義されていたため、古いアプリでは、  
`NONE` が残っているアプリもあるかもしれません。


### 親和性の決定優先順位

もし、 `CHARINT` のような親和性が指定された場合、 `INTEGER` と `TEXT` の両方の条件を  
満たしますが、親和性の決定には、優先順位があるため、この場合は、 `INTEGER` となります。

優先順位は以下の通りです。

1. INTEGER
2. TEXT
3. BLOB
4. REAL
5. NUMERIC


### 型の新和性よる変換

一列目が型の親和性を表します。  
一行目の二列名以降は、一列目の型に一行目の各データ型が格納された場合を表しています。  
表の中身は、各親和性の型に各データ型が格納された場合に、変換されるか、変換されないかを示しています。

| 型の親和性 ↓ | データの型 → INTEGER | REAL      | TEXT      | BLOB | NULL |
|--------------|----------------------|-----------|-----------|------|------|
| INTEGER      | -                    | ○         | ○ ( ※ 1 ) | ×    | ×    |
| REAL         | ○ ( ※ 2 )            | -         | ○ ( ※ 1 ) | ×    | ×    |
| NUMERIC      | ○ ( ※ 3 )            | ○ ( ※ 3 ) | ○ ( ※ 1 ) | ×    | ×    |
| TEXT         | ○                    | ○         | -         | ×    | ×    |
| BLOB         | ×                    | ×         | ×         | ×    | ×    |

○ : 変換する / × : 変換しない

( ※ 1 )  
変換に失敗した場合は、 `TEXT` 型のまま格納されます。  
( ※ 2 )  
整数値を強制的に小数値に変換します。  
【参考】 DB 内部では、ストレージ節約のために小数点をとった形で保存されるらしい。  
( ※ 3 )  
`NUMERIC` という型は存在しないため、 `INTEGER` か `REAL` のどちらかに変換されます。
`INTEGER` と `REAL` 両方に変換可能な場合は `INTEGER` に変換します。  
例えば、文字列 `'3.0e+2'` は、 `REAL` の `300.0` ではなく、 `INTEGER` の `300` に変換されます。
