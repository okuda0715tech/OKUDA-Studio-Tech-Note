<!-- TOC START min:1 max:3 link:true asterisk:false update:true -->
- [日付と時刻の関数](#日付と時刻の関数)
  - [メソッド一覧](#メソッド一覧)
  - [time-value の書式一覧](#time-value-の書式一覧)
  - [modifier の一覧](#modifier-の一覧)
  - [日時の加減算結果が存在しない日時である場合の繰り上げ / 繰り下げについて](#日時の加減算結果が存在しない日時である場合の繰り上げ--繰り下げについて)
  - [format の一覧](#format-の一覧)
    - [サンプル](#サンプル)
<!-- TOC END -->


# 日付と時刻の関数

## メソッド一覧

| メソッドの書式                                        | 返値の書式                           |
|-------------------------------------------------------|--------------------------------------|
| date(time-value, modifier, modifier, ...)             | YYYY-MM-DD                           |
| time(time-value, modifier, modifier, ...)             | HH:MM:SS                             |
| datetime(time-value, modifier, modifier, ...)         | YYYY-MM-DD HH:MM:SS                  |
| unixepoch(time-value, modifier, modifier, ...)        | 約 10 桁の UNIX エポック (単位 : 秒) |
| strftime(format, time-value, modifier, modifier, ...) | 自分で指定した書式                   |

`modifier` は、一つも指定しなくても良いですし、複数指定することもできます。


## time-value の書式一覧

| 項番 | 書式                              | 書式のデータ型 | 例                        |
|------|-----------------------------------|----------------|---------------------------|
| 1    | YYYY-MM-DD                        | 文字列         | '2022-04-26'              |
| 2    | YYYY-MM-DD HH:MM[+/-HH:MM]        | 文字列         | '2022-04-26 14:05'        |
| 3    | YYYY-MM-DD HH:MM:SS[+/-HH:MM]     | 文字列         | '2022-04-26 14:05:59'     |
| 4    | YYYY-MM-DD HH:MM:SS.SSS[+/-HH:MM] | 文字列         | '2022-04-26 14:05:59.012' |
| 5    | YYYY-MM-DDTHH:MM[+/-HH:MM]        | 文字列         | '2022-04-26T14:05+09:00'  |
| 6    | YYYY-MM-DDTHH:MM:SS[+/-HH:MM]     | 文字列         | '2022-04-26T14:05:59'     |
| 7    | YYYY-MM-DDTHH:MM:SS.SSS[+/-HH:MM] | 文字列         | '2022-04-26T14:05:59.012' |
| 8    | HH:MM[+/-HH:MM]                   | 文字列         | '14:05'                   |
| 9    | HH:MM:SS[+/-HH:MM]                | 文字列         | '14:05:59'                |
| 10   | HH:MM:SS.SSS[+/-HH:MM]            | 文字列         | '14:05:59.012'            |
| 11   | -                                 | 文字列         | 'now'                     |
| 12   | DDDDDDDDDD                        | 文字列         | ''                          |

**項番 1 の時刻省略時は、 00:00:00.000 になります。**  

**項番 2 ～ 10 の文字 「 `H` 」 について**  
「 `H` 」 は、 24 時間表記です。  
`00` ～ `24` の値が入りますが、 `24` は、 `'24:01:01'` などとなった場合に、  
日付が変わってしまうと思われるため、基本的には `24` は使用せず、 `00` を使用したほうが良いと思われます。

**項番 2 ～ 10 の末尾には、 「 `Z` 」 が入ることがある**
`Z` は、 UTC (世界標準時) を意味する。  
`Z` を付与しない場合も、デフォルトで UTC が指定されるため、  
`Z` は、付与してもしなくても同じ意味である。

**項番 2 ～ 10 の末尾には、UTC (世界標準時) との時差 「 `[+/-HH:MM]` 」 が入ることがある**
項番 2 ～ 10 の末尾に何も指定しない場合、もしくは `Z` を指定した場合には、その時刻は世界標準時とみなされる。  
`[+/-HH:MM]` を指定した場合には、その時刻は、 UTC からその時間分の時差が生じる場所での時刻を示します。  
例 : `'14:05+09:00'`  
これは、日本時刻が 14 時 05 分であることを表しています。  
言い換えれば、 UTC では、 05 時 05 分を示していることになります。

**項番 5 ～ 7 の文字 「 `T` 」 について**  
「 `T` 」 は、単なるシンボルです。  
見た目上の日付と時刻を区切るという意味であり、それ以外の意味はありません。

**項番 8 ～ 10 の日付省略時は、 2000-01-01 になります。**  

**項番 12 は、 modifier が 'unixepoch' の場合、 time-value を UNIX エポックとして扱います。**  
```sql
// 1970-01-01 00:00:01
select datetime('1', 'unixepoch') as datetime;
```

**【注意】 ゼロは省略不可**  
項番 1 ～ 10 の各文字に、ゼロが入る場合は、ゼロを省略せずに記述する必要があります。  
例えば、  2022 年 3 月 3 日を表す場合には、 `2022-03-03` と記述してください。
`2022-3-3` と記述した場合には、 `NULL` が返ってきてしまいます。


## modifier の一覧

| 項番 | 書式                  | 書式のデータ型 | 例                      |
|------|-----------------------|----------------|-------------------------|
| 1    | +/-NNN year[s]        | 文字列         | '+3 year' や '-5 years' |
| 2    | +/-NNN month[s]       | 文字列         | 上記同様                |
| 3    | +/-NNN day[s]         | 文字列         | 上記同様                |
| 4    | +/-NNN hour[s]        | 文字列         | 上記同様                |
| 5    | +/-NNN minute[s]      | 文字列         | 上記同様                |
| 6    | +/-NNN.NNNN second[s] | 文字列         | 上記同様                |
| 7    | start of year         | 文字列         | 'start of year'         |
| 8    | start of month        | 文字列         | 'start of month'        |
| 9    | start of day          | 文字列         | 'start of day'          |
| 10   | weekday N             | 文字列         | 'weekday 3'             |
| 11   | unixepoch             | 文字列         | 'unixepoch'             |
| 12   | localtime             | 文字列         | 'localtime'             |
| 13   | utc                   | 文字列         | 'utc'                   |

**modifier を複数指定した場合は、左の modifier から順番に実行されます。**

**項番 1 ～ 6 は、日時の加減算を行います**  
計算結果が存在しない日時である場合の繰り上げ / 繰り下げについては、次項を参照してください。  
`+` or `-` を省略した場合は、 `+` であるとみなされます。

**項番 1 ～ 6 の N は、 3 桁である必要はない**  
`NNN` の部分に `1` を入れても問題なく計算されましたし、  
`1000` を入れても問題なく計算されました。

**項番 7 ～ 9 は、各日時の最初の日時を返します**  
```sql
// 2019-01-01 00:00:00
select datetime('2019-05-04 21:16', 'start of year') as datetime;

// 2019-05-01 00:00:00
select datetime('2019-05-04 21:16', 'start of month') as datetime;

// 2019-05-04 00:00:00
select datetime('2019-05-04 21:16', 'start of day') as datetime;
```

**項番 10 は、指定した曜日になるまで日付を進め、その日付を返します**  
```sql
// 0 : 日曜日 , 1 : 月曜日 , ... , 6 : 土曜日

// 2019-05-04 は 土曜日です。
// 2019-05-05 15:00:10
select datetime('2019-05-04 15:00:10', 'weekday 0') as datetime;
// 2019-05-08 15:00:10
select datetime('2019-05-04 15:00:10', 'weekday 3') as datetime;
// 指定した曜日が、既にその曜日だった場合には、日付は進みません。
// 2019-05-04 15:00:10
select datetime('2019-05-04 15:00:10', 'weekday 6') as datetime;
```

**項番 11 は、入力を UNIX エポック時刻 (単位 : 秒) とみなし、見やすい形式で日時を返します**  
```sql
// 1970-01-01 00:00:01
select datetime('1', 'unixepoch') as datetime;
```

**項番 12 は、入力を UTC (世界協定時) とみなし、ローカルとの時差を計算し、ローカルの日時を返します**  
```sql
// ロケールが日本の場合
// UTC の 'now' が 2022-04-28 08:25:00 だとすると、
// 以下の処理は、 2022-04-28 17:25:00 を返します。
select datetime('now', 'localtime') as datetime;
```

**項番 13 は、入力をローカルの時刻とみなし、 UTC (世界協定時) との時差を計算し、 UTC の日時を返します**  
```sql
// ロケールが日本の場合
// 日本の 'now' が 2022-04-28 17:25:00 だとすると、
// 以下の処理は、 2022-04-28 08:25:00 を返します。
select datetime('now', 'utc') as datetime;
```


## 日時の加減算結果が存在しない日時である場合の繰り上げ / 繰り下げについて

**最小値に減算をしたり、最大値に加算をした場合**

この場合、上位の日時に影響が及びます。  
例えば、 4 月 1 日を 1 日減算した場合は、 3 月 31 日になります。  
3 月 31 日を 1 日加算した場合は、 4 月 1 日になります。
13 時 00 分を 1 分減算した場合は、 12 時 59 分になります。  
12 時 59 分を 1 分加算した場合は、 13 時 00 分になります。  

**各月の日数の違いの吸収方法**

各月の日数の違いで、計算結果が存在しない日付となった場合は、その差分日数を計算結果に加算します。  
この場合、 「月」 は必ず繰り上げられます。以下に例を示します。

| 元となる日付 | 元日付のうるう年判定 | 加減算する値 | 加減算の結果 |
|--------------|----------------------|--------------|--------------|
| 2020-02-29   | ○                    | +1 years     | 2021-03-01   |
| 2020-02-29   | ○                    | -1 years     | 2019-03-01   |
| 2020-03-31   | ○                    | +1 months    | 2020-05-01   |
| 2020-03-31   | ○                    | -1 months    | 2020-03-02   |
| 2019-03-31   | ×                    | -1 months    | 2019-03-03   |


## format の一覧

| 項番 | フォーマット定数 | 意味                        | 出力書式  |
|------|------------------|-----------------------------|-----------|
| 1    | %Y               | 年                          | 0000-9999 |
| 2    | %m               | 月                          | 01-12     |
| 3    | %d               | 日                          | 00        |
| 4    | %H               | 時                          | 00-24     |
| 5    | %M               | 分                          | 00-59     |
| 6    | %S               | 秒                          | 00-59     |
| 7    | %f               | 秒 + ミリ秒                 | SS.SSS    |
| 8    | %s               | UNIX エポック (単位 : 秒)   | -         |
| 9    | %w               | 曜日 / 0 : 日曜 ～ 6 : 土曜 |           |
| 10   | %j               | 一年の何日目か              | 001-366   |
| 11   | %W               | 一年の何週目か              | 00-53     |
| 12   | %%               | 文字としての %              | -         |


### サンプル
```sql
// 2021 年 12 月 03 日
select strftime('%Y 年 %m 月 %d 日', '2021-12-03 12:34:56.789') as datetime;
```
