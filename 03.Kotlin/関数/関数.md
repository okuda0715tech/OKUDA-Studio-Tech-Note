- [関数](#関数)
  - [引数の最後のコンマ](#引数の最後のコンマ)
  - [引数のデフォルト値の設定](#引数のデフォルト値の設定)
    - [メリット](#メリット)
    - [サンプル](#サンプル)
    - [オーバーライド時にはデフォルト値を上書きできない](#オーバーライド時にはデフォルト値を上書きできない)
    - [デフォルト値を設定する引数は後ろの方に定義するほうが良い](#デフォルト値を設定する引数は後ろの方に定義するほうが良い)
  - [名前付き引数](#名前付き引数)
    - [概要](#概要)
    - [サンプル](#サンプル-1)
    - [Java のメソッドを呼び出す場合は名前は使用できない](#java-のメソッドを呼び出す場合は名前は使用できない)
  - [関数型引数](#関数型引数)
    - [関数型引数の場合は、引数の最後に設定すると良い](#関数型引数の場合は引数の最後に設定すると良い)
  - [Unit 型を返す関数 (何も返さない関数)](#unit-型を返す関数-何も返さない関数)
  - [本文が一文のみの関数](#本文が一文のみの関数)
    - [中カッコと return を省略](#中カッコと-return-を省略)
    - [戻り値の型を省略](#戻り値の型を省略)


# 関数

## 引数の最後のコンマ

```kotlin
class Person(
    val firstName: String,
    val lastName: String,
    val age: Int, // trailing comma
)
```

Kotlin の関数には、関数定義の引数の最後にコンマを付与することが可能です。

コンマを付与することのメリットは以下の通りです。

- 引数の追加時に、追加した行にのみ、バージョンコントロールの差分が発生する
- 引数の追加や削除時、コンマを追加したり削除する必要がない
- オブジェクト初期化子などのコード生成が簡素化されます。最後の要素にはカンマを含めることもできます。
  - これはまだちょっと理解できないが、公式ドキュメントに記載されていたので転記しています。

Kotlin スタイル ガイドでは、宣言サイトで末尾のコンマを使用することが奨励されており、  
呼び出しサイトではユーザーの裁量に任せられています。

IntelliJ IDEA フォーマッタでは、以下の設定で末尾のカンマを有効にすることが可能です。

```
[設定/環境設定] | [設定/環境設定]に移動します。
編集者 | コードスタイル | Kotlin で、「その他」タブを開き、
「末尾のカンマを使用する」オプションを選択します。
```


## 引数のデフォルト値の設定

### メリット

引数のデフォルト値を設定することで、オーバーロードの定義を減らすことが可能になります。


### サンプル

例えば、デフォルト値が定義できなかった場合は、以下のようにオーバーロードが必要になります。

```kotlin
fun myFunction(
    s: String,
) {
    funcB(s, 0)
}


fun myFunction(
    s: String,
    i: Int,
) { /*...*/ }
```

しかし、デフォルト値が定義できる場合は、以下の通り、オーバーロードが不要になります。

```kotlin
fun myFunction(
    s: String,
    i: Int = 0,
) { /*...*/ }
```


### オーバーライド時にはデフォルト値を上書きできない

```kotlin
open class A {
    open fun foo(i: Int = 10) { /*...*/ }
}

class B : A() {
    // A のデフォルト値 10 が B のデフォルト値として設定される。
    // B 側でデフォルト値を上書きすることはできない。
    override fun foo(i: Int) { /*...*/ }
}
```


### デフォルト値を設定する引数は後ろの方に定義するほうが良い

以下のような二つの関数があったとします。

```kotlin
    // デフォルト値ありの引数がなしの引数より後ろに定義
    fun a(i1: Int, i2: Int = 10) {

    }

    // デフォルト値ありの引数がなしの引数より前に定義
    fun b(i1: Int = 10, i2: Int) {

    }
```

上記のような場合、関数 `b()` を呼び出す際に、引数を一つだけ設定して呼び出すには、引数名を指定する必要があります。  
一方、関数 `a()` は、引数名を指定しなくても引数一つで呼び出すことが可能です。

```kotlin
    fun c() {
        // OK
        a(1)
        // コンパイルエラー
        b(1)
        // OK
        b(i2 = 1)
    }
```


## 名前付き引数

### 概要

関数呼び出し時に、引数の名前を使用することで、引数の順番を入れ替えることが可能になります。

逆にいうと、名前なしで引数を渡した場合には、必ず、引数の定義順通りに引数を渡す必要があります。


### サンプル

```kotlin
fun reformat(
    str: String,
    normalizeCase: Boolean = true,
    upperCaseFirstLetter: Boolean = true,
) { /*...*/ }

// 第二引数を省略してデフォルト値を使用する場合は、
// 第三引数を渡す際に名前付きで渡す必要があります
reformat("String!", upperCaseFirstLetter = false)
```


### Java のメソッドを呼び出す場合は名前は使用できない

Kotlin のコードから Java のメソッドを呼び出す場合は、引数の名前を指定することはできません。


## 関数型引数

### 関数型引数の場合は、引数の最後に設定すると良い

関数型引数を引数の最後に設定すると、関数の呼び出し時に、  
丸カッコの後ろにラムダ式で関数型引数を渡すことが可能になります。

```kotlin
fun foo(
    i: Int = 0,
    f: () -> Unit,
) { /*...*/ }

// デフォルト値を不使用
foo(1) { println("hello") }
// デフォルト値を使用
// ラムダ式で引数を渡している場合のみ、丸カッコを省略可能
foo { println("hello") }
// NG (ラムダ式で引数を渡していない場合は、丸カッコの省略は NG )
foo
// OK
foo()
```

```kotlin
// この場合は、関数型引数が引数の最後に定義されていないため、
// 丸カッコの後ろに中カッコを作って関数型引数を渡すことができない。
fun foo(
    f: () -> Unit,
    i: Int = 0,
) { /*...*/ }
```


## Unit 型を返す関数 (何も返さない関数)

戻り値に `Unit` 型が指定された関数が `return` できる値は、唯一 `Unit` のみです。  
もしくは、 `return` 文自体を省略できます。

```kotlin
fun printHello(name: String?): Unit {
    if (name != null)
        println("Hello $name")
    else
        println("Hi there!")
    // return Unit は省略することが可能です。
    return Unit
}
```

関数の戻り値の型 `Unit` の場合は戻り値の型の指定を省略することが可能です。

```kotlin
// 戻り値の型がない関数は、 Unit 型を返している関数と同じ
fun printHello(name: String?) { ... }
```


## 本文が一文のみの関数

### 中カッコと return を省略

本文が一文のみの関数は、中カッコを省略して、イコール記号 ( `=` ) の後に本文を記述することが可能です。  
また、 retun は必ず省略しなければいけません。

```kotlin
fun double(x: Int): Int = x * 2

// 上の関数と下の関数は、表記の違いのみで同じ内容です。

fun double(x: Int): Int {
    return x * 2
}
```


### 戻り値の型を省略

戻り値の型が推測可能な場合は、戻り値の型を省略することが可能です。

```kotlin
fun double(x: Int) = x * 2
```

本文が一文ではない場合は、本文が複雑になっている可能性があり、  
コンパイラでさえ、戻り値の型を推論することが困難である場合があります。   
そのため、そのような場合は、戻り値の型が `Unit` である場合を除き、  
戻り値の型を指定する必要があります。





