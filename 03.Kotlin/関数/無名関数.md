- [無名関数](#無名関数)
  - [概要](#概要)
  - [サンプル](#サンプル)
    - [本文の定義に中カッコを使用](#本文の定義に中カッコを使用)
    - [本文の定義にイコールを使用](#本文の定義にイコールを使用)
    - [拡張関数の例](#拡張関数の例)
  - [引数の型が省略可能](#引数の型が省略可能)
  - [ラムダ式との違い](#ラムダ式との違い)
    - [戻り値の型を明示できるかどうか](#戻り値の型を明示できるかどうか)
    - [最後の一文が暗黙的に return されるかどうか](#最後の一文が暗黙的に-return-されるかどうか)
    - [関数の最後の引数が関数型である場合、丸カッコの外側で渡せるか](#関数の最後の引数が関数型である場合丸カッコの外側で渡せるか)
    - [ノンローカルリターン（非局所的リターン）](#ノンローカルリターン非局所的リターン)
  - [戻り値の型の省略](#戻り値の型の省略)


# 無名関数

## 概要

関数定義時に関数の名前を記載していない関数を **無名関数** と呼びます。

基本的に、関数名が記載されていないこと以外は、普通の関数と同じですが、名前がないため、その場ですぐに使用されるか、プロパティに代入する必要があります。


## サンプル

### 本文の定義に中カッコを使用

```kotlin
val noNameFunc2 = fun(x: Int, y: Int): Int {
  return x + y
}
```


### 本文の定義にイコールを使用

通常の関数同様に、本文が一文だけの場合は、イコールで本文を定義することが可能です。

```kotlin
val noNameFunc1 = fun(x: Int, y: Int): Int = x + y
```


### 拡張関数の例

無名関数では、関数定義時にレシーバーの型を直接指定することが可能です。これは、無名関数を変数に代入し、後でそれを使用する場合に便利です。

```kotlin
// this はレシーバーの Int のインスタンスを参照します。
val sum = fun Int.(other: Int): Int = this + other
println(1.sum(2)) // 3
```


## 引数の型が省略可能

通常の関数は引数の型を省略することはできませんが、無名関数は引数の型が推測可能な場合は、省略することができます。

```kotlin
val ints = listOf(-1, 0, 1, 2, 3)
// (Int) -> Boolean 型に推論されます。
ints.filter(fun(item) = item > 0)
```


## ラムダ式との違い

### 戻り値の型を明示できるかどうか

ラムダ式の場合は戻り値の型を明示することができませんが、無名関数の場合は、明示することができます。


### 最後の一文が暗黙的に return されるかどうか

ラムダ式の場合は、必ず最後の一文が return されます。一方で、無名関数の場合は、最後の一文が return されるとは限りません。

無名関数の本文が中カッコで囲まれている場合は、最後の一文が暗黙的に return されることはありません。 return したい場合には、明示的に return 文を記述する必要があります。

無名関数の本文がイコールで連結されている場合は、本文に定義された唯一の一文の結果が return されます。

```kotlin
// 関数は 1 を返します。
val a = fun() = 1

// 関数は何も返しません。
val b = fun() {
    1
}

// 関数は 1 を返します。
// 後述しますが、このケースでは戻り値の型は省略できません。
val c = fun(): Int {
    return 1
}
```


### 関数の最後の引数が関数型である場合、丸カッコの外側で渡せるか

関数の最後の引数に関数型が存在し、そこにラムダ式を渡す場合は、丸カッコの後ろに中カッコでラムダ式を渡すことが可能です。

しかし、そこに無名関数を渡す場合は、同様のことはできず、必ず丸カッコの中で渡す必要があります。


### ノンローカルリターン（非局所的リターン）

Kotlin では、ラベルの付いていない `return` 文は、 `fun` キーワードが付与された関数から抜け出します。つまり、名前付き関数か無名関数から抜け出す術であり、ラムダ式から抜け出す術ではないことを意味します。ラムダ式内でラベル無し return が使用された場合は、ラムダ式を囲っている直近の fun キーワード付きの関数から抜け出します。


## 戻り値の型の省略

無名関数は、本文がイコール `=` で連結されている場合のみ、戻り値の型を推測できるため、それを省略することが可能です。無名関数の戻り値の型は、関数の本文から推論されます。

本文が中カッコで囲まれている場合は、戻り値の型を推測することはできません。型を明示的に記述するか、もしくは、省略した場合は問答無用に `Unit` 型に解決されます。

```kotlin
// () -> Int 型に解決される
val a = fun() = 1

// () -> Unit 型に解決される
val b = fun() {
    // この 1 は関数の呼び出し元に返されません。
    1
}

// () -> Int 型に解決される
val c = fun(): Int {
    return 1
}
```








