- [コレクションの共通事項](#コレクションの共通事項)
  - [概要](#概要)
  - [ビルダー関数を使用したコレクションの生成](#ビルダー関数を使用したコレクションの生成)
  - [要素数が 0 (空) のコレクションの生成](#要素数が-0-空-のコレクションの生成)
  - [コレクションのコピー](#コレクションのコピー)
  - [Mutable コレクションの Immutable 化](#mutable-コレクションの-immutable-化)
  - [コレクションのコピーや変換時に注意すること](#コレクションのコピーや変換時に注意すること)
    - [1. 参照しているインスタンスは何か？](#1-参照しているインスタンスは何か)
    - [2. 要素のコピーはディープかシャローか？](#2-要素のコピーはディープかシャローか)


# コレクションの共通事項

## 概要

List, Set, Map で共通の事項について記述していきます。


## ビルダー関数を使用したコレクションの生成

コレクションはビルダー関数を使用して生成することが可能です。

```kotlin
// Map の例
val map = buildMap {
    put("a", 1)
    put("b", 2)
    put("c", 3)
}

println(map) // {a=1, b=2, c=3}
```

List を生成したい場合は `buildList()` 、 Set を生成したい場合は、 `buildSet()` 関数が使用できます。

ビルダー関数の内部では、 Mutable なコレクションが生成されますが、ビルダー関数が返すのは、読み取り専用のコレクションです。


## 要素数が 0 (空) のコレクションの生成

要素数が 0 (空) のコレクションの生成したい場合には、専用の関数を使用することができます。

```kotlin
val empty = emptyList<String>()
```

Set, Map の場合も同様の関数が用意されています。


## コレクションのコピー

標準ライブラリに用意されいるコピー関数 ( `list.toList()` や `list.toMutableList()` ( Set や Map も同様)) は、浅いコピーです。そのため、元のコレクションの要素に加えられた変更は、コピーされたコレクションにも反映されます。

要素の追加と削除については、元のコレクションとコピーされたコレクションは独立しています。つまり、どちらかに要素を追加したり、削除しても、もう一方には反映されません。

```kotlin
val sourceList = mutableListOf(Person("Alice"))
val copyList = sourceList.toList()

// 要素の追加
sourceList.add(Person("Bob"))
// 名前の変更
alice.name = "Alicia"

// 名前の変更は両方のコレクションに反映される
println("${sourceList[0].name}, ${copyList[0].name}") // Alicia, Alicia
// 要素の追加は、片方にのみ反映される
println("${sourceList.size}, ${copyList.size}") // 2, 1
```


## Mutable コレクションの Immutable 化

Mutable なコレクションを Immutable な型のプロパティに代入すると、要素の追加・削除・入れ替えができなくなります。

```kotlin
val sourceList = mutableListOf(1, 2, 3)
val referenceList: List<Int> = sourceList
//referenceList.add(4) // コンパイルエラー
sourceList.add(4)
println(referenceList) // shows the current state of sourceList
```

要素の追加・削除・入れ替えを制限したい場合にこの手法を使用します。


## コレクションのコピーや変換時に注意すること

コレクションのコピーや変換を行う際には、以下の二点に注意してください。

1. 元のコレクションインスタンスを参照しているか、新しく生成したインスタンスを参照しているか？
2. 要素はディープコピーかシャローコピーか？


### 1. 参照しているインスタンスは何か？

参照しているコレクションのインスタンスが元のインスタンスと同じである場合、参照中のコレクションへの操作は、当然ですが、全て元のコレクションに反映されます。


### 2. 要素のコピーはディープかシャローか？

ディープコピーの場合は、コピー先の要素のプロパティに対する操作は、コピー元の要素には反映されません。

一方で、シャローコピーの場合は、コピー先の要素のプロパティに対する操作は、コピー元の要素に反映されます。


