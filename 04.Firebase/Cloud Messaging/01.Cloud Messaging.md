- [Cloud Messaging](#cloud-messaging)
  - [ğŸ”§ FCMã®ä¸»ãªç”¨é€”](#-fcmã®ä¸»ãªç”¨é€”)
  - [âš™ï¸ ä»•çµ„ã¿ã®æ¦‚è¦](#ï¸-ä»•çµ„ã¿ã®æ¦‚è¦)
  - [ğŸ“± ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¨®é¡](#-ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¨®é¡)
  - [ğŸ’¡ ã‚ˆãã‚ã‚‹ä½¿ã„æ–¹](#-ã‚ˆãã‚ã‚‹ä½¿ã„æ–¹)
  - [ğŸ“š ä½¿ã„å§‹ã‚ã‚‹ã«ã¯ï¼Ÿ](#-ä½¿ã„å§‹ã‚ã‚‹ã«ã¯)
  - [ğŸ” æ³¨æ„ç‚¹](#-æ³¨æ„ç‚¹)
  - [å®Ÿè£…æ–¹æ³•](#å®Ÿè£…æ–¹æ³•)
    - [âœ… äº‹å‰æº–å‚™](#-äº‹å‰æº–å‚™)
    - [ğŸ”§ FirebaseMessagingService ã®å®Ÿè£…](#-firebasemessagingservice-ã®å®Ÿè£…)
    - [ğŸ“ AndroidManifest.xml ã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç™»éŒ²](#-androidmanifestxml-ã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç™»éŒ²)
    - [ğŸš€ é€šçŸ¥ã®å—ä¿¡ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹æ–¹æ³•](#-é€šçŸ¥ã®å—ä¿¡ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹æ–¹æ³•)
  - [ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—](#ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—)
    - [é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸](#é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
      - [1. ãƒ¬ã‚¬ã‚·ãƒ¼ HTTP APIï¼ˆä»Šã§ã‚‚ä½¿ç”¨å¯èƒ½ï¼‰](#1-ãƒ¬ã‚¬ã‚·ãƒ¼-http-apiä»Šã§ã‚‚ä½¿ç”¨å¯èƒ½)
      - [2. HTTP v1 APIï¼ˆæ–°ã—ã„æ¨å¥¨æ–¹å¼ï¼‰](#2-http-v1-apiæ–°ã—ã„æ¨å¥¨æ–¹å¼)
    - [ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸](#ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
      - [1. ãƒ¬ã‚¬ã‚·ãƒ¼ HTTP APIï¼ˆä»Šã§ã‚‚ä½¿ç”¨å¯èƒ½ï¼‰](#1-ãƒ¬ã‚¬ã‚·ãƒ¼-http-apiä»Šã§ã‚‚ä½¿ç”¨å¯èƒ½-1)
      - [2. HTTP v1 APIï¼ˆæ–°ã—ã„æ¨å¥¨æ–¹å¼ï¼‰](#2-http-v1-apiæ–°ã—ã„æ¨å¥¨æ–¹å¼-1)
    - [è¦‹åˆ†ã‘æ–¹](#è¦‹åˆ†ã‘æ–¹)
    - [ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆé€šçŸ¥ï¼‹ãƒ‡ãƒ¼ã‚¿ï¼‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸](#ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰é€šçŸ¥ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
      - [â–¶ Android ã‚¢ãƒ—ãƒªãŒ ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ ã®å ´åˆï¼š](#-android-ã‚¢ãƒ—ãƒªãŒ-ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰-ã®å ´åˆ)
      - [â–¶ Android ã‚¢ãƒ—ãƒªãŒ ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ ã®å ´åˆï¼š](#-android-ã‚¢ãƒ—ãƒªãŒ-ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰-ã®å ´åˆ)
  - [ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ã¨ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ã«ã‚ˆã‚‹æŒ™å‹•ã®é•ã„](#ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ã¨ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ã«ã‚ˆã‚‹æŒ™å‹•ã®é•ã„)
  - [ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡æ–¹æ³•](#ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡æ–¹æ³•)
    - [Firebase ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰é€ä¿¡](#firebase-ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰é€ä¿¡)
    - [curl ã‚³ãƒãƒ³ãƒ‰ã§ FCM HTTP v1 API ã‚’ä½¿ã£ã¦é€ä¿¡](#curl-ã‚³ãƒãƒ³ãƒ‰ã§-fcm-http-v1-api-ã‚’ä½¿ã£ã¦é€ä¿¡)
      - [1. ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ï¼ˆgcloud CLI ã¾ãŸã¯ OAuth2 æ‰‹å‹•ç™ºè¡Œï¼‰](#1-ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—gcloud-cli-ã¾ãŸã¯-oauth2-æ‰‹å‹•ç™ºè¡Œ)
        - [âœ… gcloud CLI ã‹ã‚‰å–å¾—ï¼ˆæ¨å¥¨ï¼‰](#-gcloud-cli-ã‹ã‚‰å–å¾—æ¨å¥¨)
      - [2. é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰](#2-é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
    - [äº‹å‰æº–å‚™](#äº‹å‰æº–å‚™)
      - [ğŸ” 1. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç§˜å¯†éµï¼ˆJSONï¼‰ã‚’å–å¾—](#-1-ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç§˜å¯†éµjsonã‚’å–å¾—)
      - [ğŸ†” 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’ç¢ºèª](#-2-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆidã‚’ç¢ºèª)
  - [ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚«ãƒ©ãƒ¼ã®æŒ‡å®š](#ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚«ãƒ©ãƒ¼ã®æŒ‡å®š)
  - [ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ä½¿ç”¨å¯èƒ½ãªã‚­ãƒ¼](#ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ä½¿ç”¨å¯èƒ½ãªã‚­ãƒ¼)
  - [å¼•ç”¨å…ƒè³‡æ–™](#å¼•ç”¨å…ƒè³‡æ–™)


# Cloud Messaging

Firebase Cloud Messagingï¼ˆFCMï¼‰ã¯ã€Google ãŒæä¾›ã™ã‚‹ç„¡æ–™ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã§ã€ã‚¢ãƒ—ãƒªã« ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ ã‚„ ãƒ‡ãƒã‚¤ã‚¹é–“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€šä¿¡ ã‚’ç°¡å˜ã«çµ„ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ç‰¹ã« Android ã‚¢ãƒ—ãƒªã§ã¯ã‚ˆãä½¿ã‚ã‚Œã¦ãŠã‚Šã€iOS ã‚„ Web ã§ã‚‚åˆ©ç”¨å¯èƒ½ã§ã™ã€‚


## ğŸ”§ FCMã®ä¸»ãªç”¨é€”

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚¢ãƒ—ãƒªã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
  - ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚ˆã†ã«ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãªãã€ã“ã£ãã‚Šã¨ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¦ã€ç°¡å˜ãªå‡¦ç†ãŒå®Ÿè¡Œã§ãã‚‹ã€‚
- ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ãƒˆãƒ”ãƒƒã‚¯ã«å¯¾ã™ã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé€šçŸ¥
- ã‚¢ãƒ—ãƒªå†…ã§ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸


## âš™ï¸ ä»•çµ„ã¿ã®æ¦‚è¦

1. Firebase ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ã‚¢ãƒ—ãƒªã‚’ç™»éŒ²ã€‚
2. ã‚¢ãƒ—ãƒªã« Firebase SDK ã‚’å°å…¥ã€‚
3. ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã™ã‚‹ã¨ã€FCM ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚Œã‚‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è­˜åˆ¥ã™ã‚‹IDã®ã‚ˆã†ãªã‚‚ã®ï¼‰ã€‚
4. ã‚µãƒ¼ãƒãƒ¼ï¼ˆã¾ãŸã¯ Firebase ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼‰ã‹ã‚‰ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒ‡å®šã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã€‚
5. Google ã® FCM ã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§ã€ã‚¢ãƒ—ãƒªã«é€šçŸ¥ãŒé…ä¿¡ã•ã‚Œã‚‹ã€‚


## ğŸ“± ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¨®é¡

- é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - é€šçŸ¥ãƒãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€‚ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§è‡ªå‹•çš„ã«å‡¦ç†ã€‚
  - ã‚¢ãƒ—ãƒªãŒãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã®éš›ã«é…ä¿¡ã•ã‚ŒãŸå ´åˆã«ã¯ã€æ˜ç¤ºçš„ã«é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹å‡¦ç†ã‚’è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
- ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - ã‚¢ãƒ—ãƒªã§ç‹¬è‡ªã«å‡¦ç†ã€‚ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã¯å‹•ä½œãŒåˆ¶é™ã•ã‚Œã‚‹ã“ã¨ã‚ã‚Šã€‚
- è¤‡åˆå‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - é€šçŸ¥ + ãƒ‡ãƒ¼ã‚¿ã®çµ„ã¿åˆã‚ã›ã€‚


## ğŸ’¡ ã‚ˆãã‚ã‚‹ä½¿ã„æ–¹

- æ–°ç€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šã„ãŸã¨ãã«é€šçŸ¥ã™ã‚‹
- ã‚»ãƒ¼ãƒ«æƒ…å ±ã‚’å®šæœŸçš„ã«é€ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•ã«å¿œã˜ã¦ç‰¹å®šã®é€šçŸ¥ã‚’å‡ºã™
- ãƒˆãƒ”ãƒƒã‚¯è³¼èª­ã§ã€Œå¤©æ°—æƒ…å ±ã€ã€Œãƒ‹ãƒ¥ãƒ¼ã‚¹ã€ãªã©ã‚’ã‚°ãƒ«ãƒ¼ãƒ—ã«é€ä¿¡


## ğŸ“š ä½¿ã„å§‹ã‚ã‚‹ã«ã¯ï¼Ÿ

1. Firebase Console ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
2. google-services.json ã‚’ Android ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«è¿½åŠ 
3. Gradle ã«å¿…è¦ãª Firebase ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ 
4. FirebaseMessagingService ã‚’ç¶™æ‰¿ã—ã¦é€šçŸ¥ã‚’å—ã‘å–ã‚‹å‡¦ç†ã‚’æ›¸ã


## ğŸ” æ³¨æ„ç‚¹

- Android 13 ä»¥é™ã¯ã€é€šçŸ¥ã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ãŒå¿…é ˆ
- ãƒˆãƒ¼ã‚¯ãƒ³ã®æ›´æ–°ã‚„å¤±åŠ¹ã«å‚™ãˆã¦å†å–å¾—ã®å‡¦ç†ã‚‚æ›¸ãå¿…è¦ã‚ã‚Š
- FCM ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯åˆ¶é™ï¼ˆã‚µã‚¤ã‚ºã€å›æ•°ï¼‰ã‚ã‚Š


## å®Ÿè£…æ–¹æ³•

### âœ… äº‹å‰æº–å‚™

- Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚
- google-services.json ã‚’ app/ ã«é…ç½®ã™ã‚‹ã€‚
- build.gradle ã« Firebase ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã™ã‚‹ã€‚

```kotlin
// app/build.gradle
dependencies {
    implementation("com.google.firebase:firebase-messaging:23.4.1")
}
```

```kotlin
// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® build.gradle
buildscript {
    dependencies {
        classpath("com.google.gms:google-services:4.4.1")
    }
}
```

```kotlin
// app/build.gradle ã®æœ€å¾Œã«è¿½åŠ 
apply plugin: 'com.google.gms.google-services'
```


### ğŸ”§ FirebaseMessagingService ã®å®Ÿè£…

```kotlin
class MyFirebaseMessagingService : FirebaseMessagingService() {

    // é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã—ãŸã¨ãã«å‘¼ã°ã‚Œã‚‹
    override fun onMessageReceived(remoteMessage: RemoteMessage) {
        super.onMessageReceived(remoteMessage)

        // é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆé€šçŸ¥ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ï¼‰
        remoteMessage.notification?.let {
            Log.d("FCM", "é€šçŸ¥ã‚¿ã‚¤ãƒˆãƒ«: ${it.title}, æœ¬æ–‡: ${it.body}")
        }

        // ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ï¼‰
        if (remoteMessage.data.isNotEmpty()) {
            Log.d("FCM", "ãƒ‡ãƒ¼ã‚¿ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰: ${remoteMessage.data}")
        }
    }

    // æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ãŒç”Ÿæˆã•ã‚ŒãŸã¨ã
    override fun onNewToken(token: String) {
        super.onNewToken(token)
        Log.d("FCM", "æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³: $token")
        // ã‚µãƒ¼ãƒãƒ¼ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’é€ã‚‹å‡¦ç†ã‚’æ›¸ã
    }
}
```

- `onMessageReceived()` é–¢æ•°ãŒå‘¼ã°ã‚Œã‚‹å ´åˆã¨å‘¼ã°ã‚Œãªã„å ´åˆã®æ¡ä»¶ã«ã¤ã„ã¦ã¯ã€ [ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ã¨ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ã«ã‚ˆã‚‹æŒ™å‹•ã®é•ã„](#ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ã¨ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ã«ã‚ˆã‚‹æŒ™å‹•ã®é•ã„) ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—ä¿¡å¾Œ 20 ç§’ä»¥å†…ã«ã‚µãƒ¼ãƒ“ã‚¹ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
  - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®æ™‚é–“æ ã¯ã€onMessageReceived ã®å‘¼ã³å‡ºã—ã«å…ˆç«‹ã£ã¦ç™ºç”Ÿã™ã‚‹é…å»¶ï¼ˆOS ã®é…å»¶ã€ã‚¢ãƒ—ãƒªã®èµ·å‹•æ™‚é–“ã€ä»–ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã€ã¾ãŸã¯ onMessageReceived ã®å‘¼ã³å‡ºã—æ™‚é–“ãŒã‹ã‹ã‚Šã™ãã‚‹ãªã©ï¼‰ã«å¿œã˜ã¦ 20 ç§’ã‚ˆã‚ŠçŸ­ããªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

`onMessageReceived()` é–¢æ•°ãŒå‘¼ã°ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ã§ã¯ã€é€šçŸ¥ã¯è‡ªå‹•çš„ã«ã¯è¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ã€è‡ªå‰ã§å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã«ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

```kotlin
override fun onMessageReceived(remoteMessage: RemoteMessage) {
    super.onMessageReceived(remoteMessage)

    val title = remoteMessage.data["title"] ?: "é€šçŸ¥ã‚¿ã‚¤ãƒˆãƒ«"
    val body = remoteMessage.data["body"] ?: "é€šçŸ¥æœ¬æ–‡"

    val notificationManager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager

    // Android 8.0 ä»¥é™ã¯ãƒãƒ£ãƒ³ãƒãƒ«ãŒå¿…è¦
    val channelId = "default_channel"
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
        val channel = NotificationChannel(
            channelId,
            "é€šå¸¸é€šçŸ¥",
            NotificationManager.IMPORTANCE_DEFAULT
        )
        notificationManager.createNotificationChannel(channel)
    }

    val notification = NotificationCompat.Builder(this, channelId)
        .setContentTitle(title)
        .setContentText(body)
        .setSmallIcon(R.drawable.ic_notification) // ã‚¢ã‚¤ã‚³ãƒ³ã¯å¿…é ˆ
        .setAutoCancel(true)
        .build()

    notificationManager.notify(1, notification)
}
```


### ğŸ“ AndroidManifest.xml ã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç™»éŒ²

```xml
<service
    android:name=".MyFirebaseMessagingService"
    android:exported="false">
    <intent-filter>
        <action android:name="com.google.firebase.MESSAGING_EVENT"/>
    </intent-filter>
</service>

<!-- Android 13 ä»¥é™ã¯é€šçŸ¥ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚‚å¿…è¦ -->
<uses-permission android:name="android.permission.POST_NOTIFICATIONS"/>
```


### ğŸš€ é€šçŸ¥ã®å—ä¿¡ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹æ–¹æ³•

- Firebase ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ã
- Cloud Messaging ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œæ–°ã—ã„é€šçŸ¥ã‚’é€ä¿¡ã€
- å¯¾è±¡ã®ã‚¢ãƒ—ãƒªã‚’é¸ã‚“ã§é€šçŸ¥ã‚’é€ä¿¡


## ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ã€ä»¥ä¸‹ã® 2 ç¨®é¡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ãŒå­˜åœ¨ã—ã¾ã™ã€‚ã¾ãŸã€ãã‚Œã‚‰ã®ä¸¡æ–¹ã‚’å«ã‚€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚å­˜åœ¨ã—ã¾ã™ã€‚

- é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸


### é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

#### 1. ãƒ¬ã‚¬ã‚·ãƒ¼ HTTP APIï¼ˆä»Šã§ã‚‚ä½¿ç”¨å¯èƒ½ï¼‰

```json
{
    "to": "fcm_device_token",
    "notification": {
        "title": "ã‚¿ã‚¤ãƒˆãƒ«",
        "body": "æœ¬æ–‡"
    }
}
```


#### 2. HTTP v1 APIï¼ˆæ–°ã—ã„æ¨å¥¨æ–¹å¼ï¼‰

```json
{
    "message": {
        "token": "fcm_device_token",
        "notification": {
            "title": "ã‚¿ã‚¤ãƒˆãƒ«",
            "body": "æœ¬æ–‡"
        }
    }
}
```


### ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

#### 1. ãƒ¬ã‚¬ã‚·ãƒ¼ HTTP APIï¼ˆä»Šã§ã‚‚ä½¿ç”¨å¯èƒ½ï¼‰

```json
{
    "to": "token",
    "data": {
        "key1": "value1",
        "key2": "value2"
    }
}
```


#### 2. HTTP v1 APIï¼ˆæ–°ã—ã„æ¨å¥¨æ–¹å¼ï¼‰

```json
{
    "message": {
        "token": "token",
        "data": {
            "key1": "value1",
            "key2": "value2"
        }
    }
}
```


### è¦‹åˆ†ã‘æ–¹

- notification ã‚­ãƒ¼ã‚’å«ã¿ã€ data ã‚­ãƒ¼ã‚’å«ã¾ãªã„å ´åˆã¯ã€Œé€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã§ã™ã€‚
  - data ã‚­ãƒ¼ã‚’å«ã‚“ã§ã„ã¦ã‚‚ã€Œé€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã«åˆ†é¡ã™ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚
- data ã‚­ãƒ¼ã‚’å«ã¿ã€ notification ã‚­ãƒ¼ã‚’å«ã¾ãªã„å ´åˆã¯ã€Œãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã§ã™ã€‚
- notification ã‚­ãƒ¼ã¨ data ã‚­ãƒ¼ä¸¡æ–¹ã‚’å«ã‚€å ´åˆã¯ã€Œãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã¨å‘¼ã°ã‚Œã¾ã™ã€‚


### ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆé€šçŸ¥ï¼‹ãƒ‡ãƒ¼ã‚¿ï¼‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

#### â–¶ Android ã‚¢ãƒ—ãƒªãŒ ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ ã®å ´åˆï¼š

- **onMessageReceived()** ãŒå‘¼ã°ã‚Œã¾ã™ã€‚
- RemoteMessage.getNotification() ã§é€šçŸ¥éƒ¨åˆ†ãŒã€
- RemoteMessage.getData() ã§ãƒ‡ãƒ¼ã‚¿éƒ¨åˆ†ãŒå–å¾—ã§ãã¾ã™ã€‚
- é€šçŸ¥ã®è¡¨ç¤ºã¯è‡ªåˆ†ã§è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆè‡ªå‹•ã§ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ï¼‰ã€‚


#### â–¶ Android ã‚¢ãƒ—ãƒªãŒ ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ ã®å ´åˆï¼š

- **onMessageReceived() ã¯å‘¼ã°ã‚Œã¾ã›ã‚“**ã€‚
- FCM ãŒé€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸éƒ¨åˆ†ï¼ˆnotification ã‚­ãƒ¼ï¼‰ã‚’ä½¿ã£ã¦ã€è‡ªå‹•ã§é€šçŸ¥ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
- data ã‚­ãƒ¼ã«å«ã¾ã‚Œã‚‹æƒ…å ±ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé€šçŸ¥ã‚’ã‚¿ãƒƒãƒ—ã—ãŸã¨ãã« Intent ã«å«ã¾ã‚Œã¦æ¸¡ã•ã‚Œã‚‹ï¼ˆãŒã€ã‚¢ãƒ—ãƒªã«ã‚ˆã£ã¦ã¯å—ã‘å–ã‚ŠãŒé¢å€’ï¼‰ã€‚


## ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ã¨ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ã«ã‚ˆã‚‹æŒ™å‹•ã®é•ã„

å¤šãã®å ´åˆã€ `onMessageReceived()` é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚Œã€é€šçŸ¥ã¯è‡ªå‹•çš„ã«ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€é–‹ç™ºè€…ãŒ `onMessageReceived()` å†…ã§ã€æ˜ç¤ºçš„ã«é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹å‡¦ç†ã‚’è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãŸã ã—ã€ ã€Œã‚¢ãƒ—ãƒªãŒãƒãƒƒã‚¯ã‚°ãƒ©ãƒ³ãƒ‰ã«ã‚ã‚Šã€ã‹ã¤ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã« `notification` ã‚­ãƒ¼ã‚’å«ã‚€ã€ å ´åˆã¯ã€ `onMessageReceived()` é–¢æ•°ã¯å‘¼ã³å‡ºã•ã‚Œãšã€é€šçŸ¥ãŒè‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ä¸Šè¨˜ã®æ¡ä»¶ã«åŠ ãˆã¦ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã« `data` ã‚­ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã«ã¯ã€ data ã®æ¸¡ã—æ–¹ãŒé€šå¸¸ã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚é€šå¸¸ã¯ã€ `onMessageReceived()` é–¢æ•°ã§æ¸¡ã•ã‚Œã¾ã™ãŒã€ã“ã®å ´åˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé€šçŸ¥ã‚’ã‚¿ãƒƒãƒ—ã—ãŸéš›ã«èµ·å‹•ã•ã‚Œã‚‹ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã® Intent ã® Extra ã«æ ¼ç´ã•ã‚Œã¦æ¸¡ã•ã‚Œã¾ã™ã€‚


## ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡æ–¹æ³•

### Firebase ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰é€ä¿¡

çœç•¥


### curl ã‚³ãƒãƒ³ãƒ‰ã§ FCM HTTP v1 API ã‚’ä½¿ã£ã¦é€ä¿¡

[äº‹å‰æº–å‚™](#äº‹å‰æº–å‚™) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


#### 1. ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ï¼ˆgcloud CLI ã¾ãŸã¯ OAuth2 æ‰‹å‹•ç™ºè¡Œï¼‰

##### âœ… gcloud CLI ã‹ã‚‰å–å¾—ï¼ˆæ¨å¥¨ï¼‰

```sh
gcloud auth application-default print-access-token
```


#### 2. é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰

```sh
curl -X POST \
    -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
    -H "Content-Type: application/json; UTF-8" \
    https://fcm.googleapis.com/v1/projects/YOUR_PROJECT_ID/messages:send \
    -d '{
        "message": {
            "token": "YOUR_DEVICE_TOKEN",
            "data": {
                "key1": "value1",
                "key2": "value2"
            }
        }
    }'
```


### äº‹å‰æº–å‚™

#### ğŸ” 1. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç§˜å¯†éµï¼ˆJSONï¼‰ã‚’å–å¾—

- Firebase ã‚³ãƒ³ã‚½ãƒ¼ãƒ« > ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š > ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- ã€Œæ–°ã—ã„ç§˜å¯†éµã‚’ç”Ÿæˆã€ã‹ã‚‰ .json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰


#### ğŸ†” 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’ç¢ºèª

- ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ JSON å†…ã® "project_id" ã‚’ä½¿ã„ã¾ã™


## ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚«ãƒ©ãƒ¼ã®æŒ‡å®š

```xml
<!-- Set custom default icon. This is used when no icon is set for incoming notification messages.
     See README(https://goo.gl/l4GJaQ) for more. -->
<meta-data
    android:name="com.google.firebase.messaging.default_notification_icon"
    android:resource="@drawable/ic_stat_ic_notification" />

<!-- Set color used with incoming notification messages. This is used when no color is set for the incoming
     notification message. See README(https://goo.gl/6BKBk7) for more. -->
<meta-data
    android:name="com.google.firebase.messaging.default_notification_color"
    android:resource="@color/colorAccent" />
```


## ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ä½¿ç”¨å¯èƒ½ãªã‚­ãƒ¼

- message JSON ã§ä½¿ç”¨å¯èƒ½ãªã‚­ãƒ¼ã¯ã€ [ã“ã¡ã‚‰](https://firebase.google.com/docs/reference/fcm/rest/v1/projects.messages?authuser=0&hl=ja&_gl=1*15cqa5v*_up*MQ..*_ga*MTI0NDIwMTYwNC4xNzM0NDQ0NjYz*_ga_CW55HF8NVT*czE3NDY1ODQxMzEkbzE3JGcwJHQxNzQ2NTg0MTMxJGowJGwwJGgw#resource:-message) ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
- notification JSON ã§ä½¿ç”¨å¯èƒ½ãªã‚­ãƒ¼ã¯ã€ [ã“ã¡ã‚‰](https://firebase.google.com/docs/reference/fcm/rest/v1/projects.messages?authuser=0&hl=ja&_gl=1*15cqa5v*_up*MQ..*_ga*MTI0NDIwMTYwNC4xNzM0NDQ0NjYz*_ga_CW55HF8NVT*czE3NDY1ODQxMzEkbzE3JGcwJHQxNzQ2NTg0MTMxJGowJGwwJGgw#notification) ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


## å¼•ç”¨å…ƒè³‡æ–™

- ChatGPT
- [Firebase Cloud Messaging - å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://firebase.google.com/docs/cloud-messaging?hl=ja&authuser=0&_gl=1*1ilu3f*_up*MQ..*_ga*MTI0NDIwMTYwNC4xNzM0NDQ0NjYz*_ga_CW55HF8NVT*czE3NDY1MzA0NzYkbzE2JGcwJHQxNzQ2NTMwNTA0JGozMiRsMCRoMA..)
- [Android ã§ Firebase Cloud Messaging ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ã‚¢ãƒ—ãƒªã‚’è¨­å®šã™ã‚‹ - å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://firebase.google.com/docs/cloud-messaging/android/client?hl=ja&authuser=0&_gl=1*13wz6b0*_up*MQ..*_ga*MTI0NDIwMTYwNC4xNzM0NDQ0NjYz*_ga_CW55HF8NVT*czE3NDY1OTIxMzMkbzE3JGcwJHQxNzQ2NTkyMTMzJGowJGwwJGgw)



