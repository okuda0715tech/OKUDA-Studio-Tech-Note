<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [バーコード読み取り機能](#ハーコート読み取り機能)
	- [概要](#概要)
	- [Gradleの取り込み](#gradleの取り込み)
	- [取り込み時の注意点](#取り込み時の注意点)

<!-- /TOC -->

# バーコード読み取り機能

## 概要

バーコード読み取り機能を実装した時のメモを残します。
参考にしたサイトは、以下です。

　Googleのサンプルコード取り込みの流れ
　　[Google Playサービスのバーコード検出を試してみました - BUILDBOX.net](http://buildbox.net/2016/04/google-play%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B3%E3%83%BC%E3%83%89%E6%A4%9C%E5%87%BA/)

　Google製サンプルアプリ
　　[android-vision/visionSamples/barcode-reader/ - Github](https://github.com/googlesamples/android-vision/tree/master/visionSamples/barcode-reader)

　上記の「取り込みの流れ」のサイトを書いた人が「Google製サンプルアプリ」を取り込んで作ってアプリ
　　[shige0501/sample_GoogleBarcodeReader - Github](https://github.com/shige0501/sample_GoogleBarcodeReader)

自分は、３つ目の「shige0501」さんのアプリを見て必要なクラスや設定を取り込み自分のアプリを作成しました。

## Gradleの取り込み

プロジェクトのgradleのdependenciesに定義したものは以下です。

```java
dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation 'androidx.appcompat:appcompat:1.0.2'
    implementation 'androidx.constraintlayout:constraintlayout:1.1.3'
    implementation 'com.google.android.gms:play-services-vision:17.0.2'
    implementation 'com.google.android.material:material:1.1.0-alpha07'
    testImplementation 'junit:junit:4.12'
    androidTestImplementation 'androidx.test:runner:1.2.0'
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.2.0'
}
```

不要なものも入っていますが、主に読み取り機能として直接必要なのは、`com.google.android.gms:play-services-vision:17.0.2`
でしょう。

## 取り込み時の注意点

- `MainActivity.java`と同階層の`google`パッケージの中には`ui/camera`パッケージがあるので、その中のクラスも忘れずに取り込むこと
- `BarcodeCaptureActivity.java`の205行目あたりのコード（以下）でエラーが出た場合は、CameraSourceクラスを自作のクラスではなく、ライブラリのクラスを参照している可能性があるので、importしているクラスが正しいか確認する。
```Java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.ICE_CREAM_SANDWICH) {
    builder = builder.setFocusMode(
            autoFocus ? Camera.Parameters.FOCUS_MODE_CONTINUOUS_PICTURE : null);
}
```
- ビルド時に次のようなエラー`Duplicate class android.support.v4.app.INotificationSideChannel found in modules`が出た場合は、`gradle.properties`に次の二行を追加する。
```Java
android.useAndroidX=true
android.enableJetifier=true
```
上記エラーはSupport LibraryとAndroidXが混在しているエラーであるため、対処として、AndroidXを使用するように設定をした。
- `barcode_capture.xml`をそのままコピペするとプロジェクトパスがサンプルのままになっているので、書き換えること。

