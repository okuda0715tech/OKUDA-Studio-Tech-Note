<!-- TOC START min:1 max:3 link:true asterisk:false update:true -->
- [新しいテーブルを作成する](#新しいテーブルを作成する)
  - [概要](#概要)
  - [自動的にテーブルが作成されるケース](#自動的にテーブルが作成されるケース)
  - [自分でテーブル作成の CREATE 文を用意するケース](#自分でテーブル作成の-create-文を用意するケース)
<!-- TOC END -->


# 新しいテーブルを作成する

## 概要

テーブルの作成方法は、状況に応じて異なり、以下の 2 つのケースに分類されます。

- 自動的にテーブルが作成されるケース
- 自分でテーブル作成の `CREATE` 文を用意するケース


## 自動的にテーブルが作成されるケース

アプリに `Room` データベースを初めて導入する場合は、明示的なテーブルの作成作業は必要ありません。

`Entity` クラス (テーブル定義を表すクラス) を作成するだけで、自動的に作成されます。


## 自分でテーブル作成の CREATE 文を用意するケース

アプリに既に `Room` データベースが導入されており、 `RoomDatabase` のバージョン 1 が既に  
ユーザーによって利用されている可能性がある場合は、 `CREATE` 文を用意して、自分でテーブル  
を作成する必要があります。

その際、データベースのバージョンを一つ上げる必要があります。

実装例を以下に示します。  
以下の例は、データベースのバージョンを 1 から 2 へと上げて、新しいテーブルを作成します。

```Java
public class AppDatabaseSingleton {

    private static AppDatabase database;

    private AppDatabaseSingleton() {
        // do nothing.
    }

    public static AppDatabase getInstance(Context context) {
        if (database == null) {
            database = Room.databaseBuilder(context, AppDatabase.class, "restaurant-seats-manager-db")
                    .addMigrations(MIGRATION_1_2)
                    .build();
        }
        return database;
    }

    static final Migration MIGRATION_1_2 = new Migration(1, 2) {
        @Override
        public void migrate(SupportSQLiteDatabase database) {
            // 実際の CREATE 文は、自分で作成しなくても、ビルドした時に？作成されているものを
            // コピペすると便利である。
            // Android Studio で 「Ctrl + Shift + F」 で、文字列 CREATE TABLE を検索すると、
            // 自動生成された CREATE 文を見つけることができます。
            // ちなみに、その CREATE 文は、スキーマ定義ファイル {DBのバージョン番号.json} に記述されています。
            database.execSQL(
                    "CREATE TABLE IF NOT EXISTS `TweetExeSchedule` (" +
                    "`id` INTEGER, " +
                    "`unixEpochTime` INTEGER, " +
                    "`year` INTEGER, " +
                    "`month` INTEGER, " +
                    "`day` INTEGER, " +
                    "`hour` INTEGER, " +
                    "`minute` INTEGER, " +
                    "PRIMARY KEY(`id`))"
            );
        }
    };

}
```

```Java
@Database(entities = {MatrixViewItemBaseModel.class, UseStatusModel.class, TweetExeSchedule.class}, version = 2)
@TypeConverters({Converters.class})
public abstract class AppDatabase extends RoomDatabase {

    public abstract MatrixViewItemDao matrixViewItemDao();

    public abstract UseStatusDao useStatusDao();

    public abstract TweetExeScheduleDao tweetExeScheduleDao();

}
```
