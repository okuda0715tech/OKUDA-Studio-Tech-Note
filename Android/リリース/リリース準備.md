<!-- TOC START min:1 max:3 link:true asterisk:false update:true -->
- [リリース準備](#リリース準備)
	- [デバッグビルドとリリースビルドでアプリ名を変更する](#デバッグビルドとリリースビルドでアプリ名を変更する)
	- [バージョンコードとバージョンネームを設定する](#バージョンコードとバージョンネームを設定する)
		- [バージョンコード](#バージョンコード)
		- [バージョンネーム](#バージョンネーム)
			- [方法１](#方法１)
			- [方法２](#方法２)
		- [バージョンネームをリソースとして定義する方法](#バージョンネームをリソースとして定義する方法)
		- [【注意】クリーンプロジェクトを忘れないこと](#注意クリーンプロジェクトを忘れないこと)
	- [Play Store 用の画像の準備](#play-store-用の画像の準備)
		- [Play Store 用アプリアイコン画像の準備](#play-store-用アプリアイコン画像の準備)
			- [アイコンの形状が重要な場合](#アイコンの形状が重要な場合)
			- [参考](#参考)
			- [正方形にしても正しく角の丸みつかない場合](#正方形にしても正しく角の丸みつかない場合)
			- [高解像度アイコンが1.05MBを超えてアップロードできない](#高解像度アイコンが105mbを超えてアップロードできない)
		- [スクリーンショット 2 枚以上取得](#スクリーンショット-2-枚以上取得)
		- [フィーチャーグラフィックの作成](#フィーチャーグラフィックの作成)
			- [作成方法（例 1 ）](#作成方法例-1-)
			- [作成方法（例 1 ）](#作成方法例-1--1)
	- [Google Play Console での作業](#google-play-console-での作業)
		- [基本はアプリ登録後、サイドメニューにチェックマークが付いているメニューを登録する](#基本はアプリ登録後サイドメニューにチェックマークが付いているメニューを登録する)
		- [内部テスト版アプリの公開手順](#内部テスト版アプリの公開手順)
			- [Google Play Console 側の設定](#google-play-console-側の設定)
			- [端末側の設定](#端末側の設定)
		- [テスト版アプリのテスター登録](#テスト版アプリのテスター登録)
			- [テスターリストを作成する](#テスターリストを作成する)
	- [参考URL](#参考url)
<!-- TOC END -->


# リリース準備

## デバッグビルドとリリースビルドでアプリ名を変更する

アプリ名は通常、以下の strings.xml ファイルに記載されている。

`app/src/main/res/values/strings.xml`

デバッグビルドの場合のみ別のリソースファイルを参照するように、以下のディレクトリに strings.xml を作成する。

`app/src/debug/res/values/strings.xml`

デバッグ用リソースファイル内でアプリ名をオーバーライドする。  
名前の先頭に debug などをつけ、区別できるようにする。

```xml
<resources>
  <string name="app_name">debug アプリ名</string>
</resources>
```

変更後のアプリ名は起動用アイコン名に設定されるが、  
設定画面などでも見られるようにすると良い。

**注意**  
多言語対応を行なった場合、例えば、 `main/res/values-ja` ディレクトリを作成して、そこにも `strings.xml` を配置した場合は、この `app/src/debug/res/values/strings.xml` が効かなくなるため、注意してください。


## バージョンコードとバージョンネームを設定する

### バージョンコード

アプリの新旧判定用のバージョンです。  
整数である必要があります。  
通常は、「1」から一つずつ増やします。  
Developer Console 側でアプリを管理する番号です。  
Developer Console にアプリをアップロードする度に値をインクリメントする必要があり、  
重複する場合はアップロードができません。


### バージョンネーム

主にユーザに提示するバージョンです。  
Developer Console にアプリをアップロードする度に値をインクリメントする必要はありませんが、テスト時にアプリの画面上でそのバージョンを確認するために、リリースごとにバージョンを上げることをおすすめします。

バージョンネームの管理ルールとして、おすすめの方法を 2 つ例示します。方法１は少し複雑に感じるので、方法２がおすすめ。

#### 方法１

フォーマットは `X.Y.Z` とする。

- `X` は、新機能を追加するごとにインクリメントする。
- `Y` は、バグ修正 or 仕様変更 or UI 修正ごとにインクリメントする。
  -	ただし、 `X` がインクリメントされたら、バグ修正等があっても `Y` は、一度 `0` にする。
- `Z` は、テスト版リリース中に新たなバグを発見し、改修を行った場合にインクリメントする。
  - 本番リリース前に発見したバグの改修の場合のみインクリメントする。
  - 本番リリース済みのものにバグが発見された場合には、 `Y` をインクリメントしたバージョンを作成する。
  - `X` or `Y` がインクリメントされたら、一度 `0` にする。


#### 方法２

フォーマットは `X.Y.Z` とする。

- `X` は、以前のバージョンからマイグレーションが必要な更新の場合にインクリメントする。
- `Y` は、以前のバージョンからマイグレーションが不要な更新の場合にインクリメントする。
- `Z` は、正式リリースする前の段階で、テスト版をリリースした後に不具合が発覚し、修正を行った場合にインクリメントする。
- `X` がインクリメントされたら、 `Y` と `Z` はリセットする。
- `Y` がインクリメントされたら、 `Z` はリセットする。


### バージョンネームをリソースとして定義する方法

以下を参照

[バージョンネームをxml内で取得可能にする.md](../ビルド/build.gradle/バージョンネームをxml内で取得可能にする.md)


### 【注意】クリーンプロジェクトを忘れないこと

バージョンネームをリソースとして定義する方法を使用した場合、バージョンネームが変更されても、  
以前のバージョンネームが残ってしまっていることがあった。

クリーンプロジェクトを実行してから再度ビルドしたら、新しいバージョンネームが適用されていたため、  
リリース前に一度クリーンプロジェクトをした方が良い。


## Play Store 用の画像の準備

### Play Store 用アプリアイコン画像の準備

アプリアイコンは `512 * 512` ピクセルの正方形の画像である必要があります。  
正方形の画像をアップロードすると、サーバ側で角丸とドロップシャドウの加工を行います。

`Image Asset Studio` を使用して `Play Store` 用アイコンを生成した場合、  
`Google Play Store` 用アイコンは、 `プロジェクト名\app\src\main` フォルダ内に生成されます。


#### アイコンの形状が重要な場合

形状がアプリのブランドとして重要な場合は、正方形の背景の上にそのアイコンを配置した画像を作成します。  
その場合、背景色は透明以外が推奨されます。  
透明の場合は、アイコンの背景が透けて Play Store の背景が見えます。それにもかかわらず、  
アイコンの周りにドロップシャドウが表示されるため、不自然なアイコンになる可能性があります。


#### 参考

[Google Play アイコンのデザイン仕様](https://developer.android.com/google-play/resources/icon-design-specifications)


#### 正方形にしても正しく角の丸みつかない場合

512 × 512 の画像の周りに透明な背景が存在している可能性がある。  
Google Play Console に画像をアップロードしてみて、`高解像度アイコン`にプレビューされる画像の周りに  
背景のネズミ色が見えている場合は、見えない余白が存在している。

**対応方法**  
Macのプレビューで開き、トリミングする。  
サイズが一時的に小さくなるので、png画像をダブルクリックで開き、サイズを `512 × 512` にリサイズする。

#### 高解像度アイコンが1.05MBを超えてアップロードできない

PNG画像なら、`ImageOptim`というツールを使って圧縮する。  
その他のツールで圧縮すると、32ビット画像が8ビットや24ビット画像に変換されているようで、  
アップロードすると「画像が無効です」というエラーになる。


### スクリーンショット 2 枚以上取得

### フィーチャーグラフィックの作成

フィーチャーグラフィックとは、 Play Store でアプリの詳細画面を表示した時に、一番上のヘッダ領域に  
横長で表示される画像のこと

以下の条件の画像を用意する必要あり。

- 横 1,024 x 縦 500
- JPG または 24 ビット PNG（アルファなし）


#### 作成方法（例 1 ）

- 使用するツール
	- PIXLR
- 使用方法
	- スクリーンショットしたPNG画像をJGPに変換する
	- 指定のサイズにトリミングする

#### 作成方法（例 1 ）

- 使用するツール
  - Adobe Express (ブラウザ版)
- 使用方法
  - google の tech アカウントでログインする
  - カスタマイズサイズのプロジェクトを新規作成し、横 1,024 x 縦 500 のビューを作る
  - 「写真」 タブから、 「無料の写真を検索」 というメニューを選択して、ほしい画像を検索して使用する


## Google Play Console での作業

### 基本はアプリ登録後、サイドメニューにチェックマークが付いているメニューを登録する

チェックマークが全て緑色になったらOK。  
必須項目に入力漏れがあると、保存はできるが、チェックマークが緑色にならないので、注意する。


### 内部テスト版アプリの公開手順

#### Google Play Console 側の設定

サイドメニュー -> リリース管理 -> アプリのリリース -> 内部テスト版トラック へ進む

`内部テスト版`と`内部アプリ共有`という２つのエリアがあるが、それぞれは別物だと思われる。  
`内部テスト版`はPlay Storeに公開するところまでやってくれていると思うが、 `内部アプリ共有` は、  
URLベースのアプリダウンロードのみでPlay Storeには公開していないと思われる。

`内部テスト版`も結局は、URLからジャンプしてダウンロードするので、やっていることはあまり変わらない気もするが...。

ただし、`内部アプリ共有`では、うまくアプリのダウンロードができなかったので、今後やるときは、  
`内部テスト版`でアプリを公開した方が良いと思われる。


#### 端末側の設定

1. 内部アプリ共有を有効にする
	1. Google Play ストア アプリ Google Play を起動します。
	2. メニュー アイコン メニュー > [設定] をタップします。
	3. [概要] セクションで Play ストアのバージョンを 7 回タップします。
	4. [内部アプリ共有] の設定が表示されたら、内部アプリ共有のスイッチをタップしてオンにします。
	5. [オンにする] をタップします。


### テスト版アプリのテスター登録

#### テスターリストを作成する

1. テスターをテスターグループに登録する（このグループをテスターリストと呼ぶ）
	1. テスターリストにはテスターのメールアドレスを登録する
2. アプリにテスターリストを登録する


## 参考URL

[オープンテスト版、クローズド テスト版、内部テスト版をセットアップする](https://support.google.com/googleplay/android-developer/answer/3131213?hl=ja)
