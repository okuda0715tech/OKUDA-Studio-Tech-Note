- [ライブラリのバージョン競合時の対応方法](#ライブラリのバージョン競合時の対応方法)
  - [1. 依存関係のツリーを確認する](#1-依存関係のツリーを確認する)
  - [2. バージョンの強制指定（force）](#2-バージョンの強制指定force)
  - [3. resolutionStrategy での調整](#3-resolutionstrategy-での調整)
  - [4. ライブラリのバージョン統一（BOM の活用）](#4-ライブラリのバージョン統一bom-の活用)
  - [5. 不要な依存を排除（exclude）](#5-不要な依存を排除exclude)
  - [6. ライブラリの更新を検討](#6-ライブラリの更新を検討)
  - [7. Gradle Doctor の活用（必要に応じて）](#7-gradle-doctor-の活用必要に応じて)
  - [まとめ：対処の流れ（おすすめ）](#まとめ対処の流れおすすめ)
  - [引用元資料](#引用元資料)


# ライブラリのバージョン競合時の対応方法

## 1. 依存関係のツリーを確認する

まずはどのライブラリがどのバージョンを引き込んでいるかを把握する。

- コマンド:

```bash
./gradlew dependencies
```

もしくは特定のモジュールで:

```bash
./gradlew app:dependencies
```

- 目的: 依存ツリーを見て、どこでバージョンの食い違いが起きているか確認。


## 2. バージョンの強制指定（force）

依存関係に特定のバージョンを明示的に指定して統一する。

```kotlin
configurations.all {
    resolutionStrategy {
        force("com.squareup.okhttp3:okhttp:4.12.0")
    }
}
```

- 注意点: 強制的に下位のバージョンを使うと、依存元が想定している API が無くてクラッシュする可能性があるので、慎重に。


## 3. resolutionStrategy での調整

force 以外にも resolutionStrategy.eachDependency を使って細かく制御できる。

```kotlin
configurations.all {
    resolutionStrategy.eachDependency {
        if (requested.group == "androidx.lifecycle") {
            useVersion("2.6.2")
        }
    }
}
```


## 4. ライブラリのバージョン統一（BOM の活用）

Google が提供している BOM（Bill of Materials）を使うと、安全な組み合わせで依存関係を管理できる。

```kotlin
dependencies {
    implementation(platform("androidx.compose:compose-bom:2024.04.00"))
    implementation("androidx.compose.material3:material3")
    implementation("androidx.compose.ui:ui-tooling")
}
```

- 対象ライブラリ: Compose, Firebase, Kotlinx Coroutines など一部のみ。


## 5. 不要な依存を排除（exclude）

不要な間接依存を除外することで、競合を避けられる。

```kotlin
implementation("some.library") {
    exclude(group = "org.jetbrains.kotlin", module = "kotlin-stdlib-jdk7")
}
```


## 6. ライブラリの更新を検討

競合が発生する原因の多くは、古いライブラリを使っていることです。

- ライブラリの最新バージョンを調査し、統一できるようアップデートするのが理想。
- 複数のライブラリが共通依存を持つ場合、それに合わせて自分の依存バージョンも調整する。


## 7. Gradle Doctor の活用（必要に応じて）

依存関係の問題を明確に可視化できるツール。

- [Gradle Doctor](https://runningcode.github.io/gradle-doctor/)
- [Gradle Versions Plugin](https://github.com/ben-manes/gradle-versions-plugin)


## まとめ：対処の流れ（おすすめ）

1. `./gradlew dependencies` で競合を確認
2. 原因となる依存関係を特定
3. 最新バージョンに統一可能ならする
4. 難しい場合は force や exclude 、 resolutionStrategy で調整
5. BOM が使えるなら積極的に使う


## 引用元資料

- ChatGPT




