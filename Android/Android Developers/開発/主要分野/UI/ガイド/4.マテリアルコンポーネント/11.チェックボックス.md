- [チェックボックス](#チェックボックス)
  - [チェックボックスの構造](#チェックボックスの構造)
  - [チェックボックスの状態](#チェックボックスの状態)
  - [実装](#実装)
    - [解説](#解説)
    - [結果](#結果)
  - [タップイベントを親コンテナで処理する方法](#タップイベントを親コンテナで処理する方法)
  - [高度な例](#高度な例)
    - [解説](#解説-1)
    - [結果](#結果-1)
  - [参考情報](#参考情報)


# チェックボックス

チェックボックスを使用すると、ユーザーはリストから 1 つ以上の項目を選択できます。チェックボックスを使用すると、ユーザーは次の操作を実行できます。

- 項目をオンまたはオフにする。
- リスト内の複数のオプションから選択する。
- 同意や承諾を示す。


## チェックボックスの構造

チェックボックスは次の要素で構成されます。

- **ボックス**: チェックボックスのコンテナです。
- **チェック**: チェックボックスが選択されているかどうかを示す視覚的なインジケータです。
- **ラベル**: チェックボックスを説明するテキストです。


## チェックボックスの状態

チェックボックスは、次の 3 つの状態のいずれかになります。

- **未選択**: チェックボックスは選択されていません。ボックスは空です。

- **不確定**: チェックボックスは不確定な状態です。ボックスにはダッシュが含まれています。

- **選択**: チェックボックスが選択されています。ボックスにはチェックマークが含まれています。

次の画像は、チェックボックスの 3 つの状態を示しています。

<img src="./画像/チェックボックスの 3 つの状態.svg" width="600">

不確定チェックボックスは、複数のチェックボックスをまとめて設定する親に対して使用されます。子チェックボックスがすべて同じ状態でなければ、親チェックボックスは不確定の状態にします。

https://youtu.be/sy9GqYfqmqo


## 実装

[Checkbox](https://developer.android.com/reference/kotlin/androidx/compose/material3/package-summary?hl=ja&_gl=1*111cz49*_up*MQ..*_ga*NTY3MDY5MDA1LjE3MjQ2NTg1MjY.*_ga_6HH9YJMN9M*MTcyNTM0NjAyMy42LjAuMTcyNTM0NjAyMy4wLjAuMA..#Checkbox(kotlin.Boolean,kotlin.Function1,androidx.compose.ui.Modifier,kotlin.Boolean,androidx.compose.material3.CheckboxColors,androidx.compose.foundation.interaction.MutableInteractionSource)) コンポーザブルを使用して、アプリ内にチェックボックスを作成できます。覚えておくべき重要なパラメータがいくつかあります:

- `checked`: チェックボックスがオンかオフかを取得するブール値。

- `onCheckedChange`: ユーザーがチェックボックスをタップしたときに呼び出される関数。

次のスニペットは、Checkbox コンポーザブルの使用方法を示しています。

```kotlin
@Composable
fun CheckboxMinimalExample() {
    var checked by remember { mutableStateOf(true) }

    Row(
        verticalAlignment = Alignment.CenterVertically,
    ) {
        Text(
            "Minimal checkbox"
        )
        Checkbox(
            checked = checked,
            onCheckedChange = { checked = it }
        )
    }

    Text(
        if (checked) "Checkbox is checked" else "Checkbox is unchecked"
    )
}
```


### 解説

このコードは、最初はチェック済みのチェックボックスを作成します。ユーザーがチェックボックスをクリックすると、onCheckedChange ラムダがチェック状態を更新します。


### 結果

オフにした場合は、次のように表示されます。

<img src="./画像/OFF 状態のチェックボックス.png" width="300">

オンにした場合は、次のように表示されます。

<img src="./画像/ON 状態のチェックボックス.png" width="300">


## タップイベントを親コンテナで処理する方法

[タップイベントを親コンテナで処理する方法](../9.ユーザー補助/2.主な手順.md/#タップイベントを親コンテナで処理する場合) については、リンクを参照してください。

上記の例に従うと、例えば、 Text と Checkbox を Row の要素内に配置して、 Row をクリック可能にすることができます。


## 高度な例

以下は、アプリでチェックボックスを実装する方法のより複雑な例です。このスニペットには、親チェックボックスと一連の子チェックボックスがあります。ユーザーが親チェックボックスをタップすると、アプリはすべての子チェックボックスをオンにします。

```kotlin
@Composable
fun CheckboxParentExample() {

    // 子チェックボックスの初期化
    val childCheckedStates = remember { mutableStateListOf(false, false, false) }

    // 親チェックボックスの状態を算出する。
    // 親の状態は 3 状態存在するため、 Boolean 型ではなく、
    // ToggleableState を使用する。
    val parentState = when {
        // all 関数は、 ラムダ式の結果がすべて true の場合は true を返す関数です。
        childCheckedStates.all { it } -> ToggleableState.On
        // none 関数は、 ラムダ式の結果がすべて false の場合は true を返す関数です。
        childCheckedStates.none { it } -> ToggleableState.Off
        else -> ToggleableState.Indeterminate
    }

    Column {
        // 親チェックボックス
        Row(
            verticalAlignment = Alignment.CenterVertically,
        ) {
            Text("Select all")
            TriStateCheckbox(
                state = parentState,
                onClick = {
                    // 現在の状態に応じて、タップ後の状態を生成する。
                    val newState = parentState != ToggleableState.On
                    // 親の状態を子に反映する。
                    childCheckedStates.forEachIndexed { index, _ ->
                        childCheckedStates[index] = newState
                    }
                }
            )
        }

        // 子チェックボックス
        // チェックボックスの状態が変われば、そのチェックボックスのみ
        // 再コンポーズの対象となり、画面が更新される。
        childCheckedStates.forEachIndexed { index, checked ->
            Row(
                verticalAlignment = Alignment.CenterVertically,
            ) {
                Text("Option ${index + 1}")
                Checkbox(
                    checked = checked,
                    onCheckedChange = { isChecked ->
                        // 子の状態を更新する。
                        childCheckedStates[index] = isChecked
                    }
                )
            }
        }
    }

    if (childCheckedStates.all { it }) {
        Text("All options selected")
    }
}
```


### 解説

この例から注目すべき点をいくつか示します。

- **状態管理**:

  - `childCheckedStates`: mutableStateListOf() を使用して各子チェックボックスのチェック状態を追跡するブール値のリスト。

  - `parentState`: 子チェックボックスの状態から値が派生する ToggleableState。

- **UI コンポーネント**:

  - `TriStateCheckbox`: 親チェックボックスには状態パラメータがあり、不確定に設定できるため必要です。

  - `Checkbox`: 各子チェックボックスに使用され、その状態は childCheckedStates の対応する要素にリンクされます。

- **ロジック**:

  - 親チェックボックスの onClick は、すべての子チェックボックスを現在の親の状態の反対に更新します。

  - 各子チェックボックスの onCheckedChange は、childCheckedStates リスト内の対応する状態を更新します。

  - すべての子チェックボックスがチェックされている場合、コードは「すべてのオプションを選択」と表示します。

**注**: 不確定な状態のチェックボックスが必要な場合は、TriStateCheckbox を使用する必要があります。これは、TriStateCheckbox には ToggleState 型の状態パラメータがあるのに対し、Checkbox にはそれがないためです。


### 結果

すべてのチェックボックスが OFF になっている場合は、次のような結果になります。

<img src="./画像/すべてのチェックボックスが OFF.png" width="200">

すべてのチェックボックスが ON になっている場合は、次のような結果になります。

<img src="./画像/すべてのチェックボックスが ON.png" width="200">

一部のチェックボックスが ON になっている場合は、次のような結果になります。

<img src="./画像/一部のチェックボックスが ON.png" width="200">



## 参考情報

- [マテリアル デザインのチェックボックス](https://m3.material.io/components/checkbox/overview)

