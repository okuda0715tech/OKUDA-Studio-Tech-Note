- [進行状況インジケーター](#進行状況インジケーター)
  - [API サーフェス](#api-サーフェス)
  - [確定インジケーター](#確定インジケーター)
  - [不確定インジケーター](#不確定インジケーター)
  - [参考情報](#参考情報)


# 進行状況インジケーター

進行状況インジケーターは、操作のステータスを視覚的に表示します。データの読み込みや処理など、プロセスが完了に近づいていることをモーションでユーザーに知らせます。また、完了に近づいているかどうかに関係なく、処理が行われていることを示すこともできます。

進行状況インジケーターを使用する可能性がある次の 3 つのユースケースを検討してください。

- **コンテンツの読み込み**: ユーザー プロファイルの画像やデータを読み込むなど、ネットワークからコンテンツを取得しているとき。

- **ファイルのアップロード**: アップロードにかかる時間をユーザーにフィードバックします。

- **長時間処理**: アプリが大量のデータを処理しているときに、全体のうちどれくらい完了しているかをユーザーに伝えます。

マテリアル デザインには、2 種類の進行状況インジケーターがあります。

- **確定**: 進行状況を正確に表示します。

- **不確定**: 進行状況に関係なく継続的にアニメーションします。

同様に、進行状況インジケーターは次の 2 つの形式のいずれかになります。

- **線形**: 左から右に塗りつぶされる水平バー。
- **円形**: 線の長さが次第に長くなり、円周全体を囲む円。

<img src="./画像/2 種類の進行状況インジケーター.svg" width="300">


## API サーフェス

マテリアル デザインと一致する進行状況インジケーターを作成するために使用できるコンポーザブルはいくつかありますが、それらのパラメーターはそれほど大きくは変わりません。覚えておくべき重要なパラメーターは次のとおりです。

- **progress**: インジケーターが表示する現在の進行状況。0.0 から 1.0 の間の Float を渡します。
- **color**: 実際のインジケーターの色。つまり、進行状況を反映し、進行状況が完了したときにコンポーネントを完全に囲むコンポーネントの部分です。
- **trackColor**: インジケーターが描画されるトラック (塗りつぶされる前) の色。

注: LinearProgressIndicator と CircularProgressIndicator の API は基本的に同じであり、どちらの使用方法も同じです。どちらにも以下で説明するスニペットを使用できます。


## 確定インジケーター

確定インジケーターは、アクションがどの程度完了したかを正確に反映します。 [LinearProgressIndicator](https://developer.android.com/reference/com/google/android/material/progressindicator/LinearProgressIndicator?hl=ja&_gl=1*1pqshh3*_up*MQ..*_ga*NTY3MDY5MDA1LjE3MjQ2NTg1MjY.*_ga_6HH9YJMN9M*MTcyNTI0Njg0NC41LjAuMTcyNTI0Njg0NC4wLjAuMA..) または [CircularProgressIndicator](https://developer.android.com/reference/com/google/android/material/progressindicator/CircularProgressIndicator?hl=ja&_gl=1*1pqshh3*_up*MQ..*_ga*NTY3MDY5MDA1LjE3MjQ2NTg1MjY.*_ga_6HH9YJMN9M*MTcyNTI0Njg0NC41LjAuMTcyNTI0Njg0NC4wLjAuMA..) コンポーザブルのいずれかを使用して、進行状況パラメータの値を渡します。

次のスニペットは、比較的詳細な例を示しています。ユーザーがボタンを押すと、アプリは進行状況インジケーターを表示し、進行状況の値を徐々に増やすコルーチンを起動します。これにより、進行状況インジケーターが順に反復されます。

注: 次の例では、コルーチンを使用して進行状況値を反復処理します。そうしないと、UI スレッドがブロックされるためです。

```kotlin
@Composable
fun LinearDeterminateIndicator() {
    var currentProgress by remember { mutableStateOf(0f) }
    var loading by remember { mutableStateOf(false) }
    val scope = rememberCoroutineScope() // Create a coroutine scope

    Column(
        verticalArrangement = Arrangement.spacedBy(12.dp),
        horizontalAlignment = Alignment.CenterHorizontally,
        modifier = Modifier.fillMaxWidth()
    ) {
        Button(onClick = {
            loading = true
            scope.launch {
                loadProgress { progress ->
                    currentProgress = progress
                }
                loading = false // Reset loading when the coroutine finishes
            }
        }, enabled = !loading) {
            Text("Start loading")
        }

        if (loading) {
            LinearProgressIndicator(
                progress = { currentProgress },
                modifier = Modifier.fillMaxWidth(),
            )
        }
    }
}

/** Iterate the progress value */
suspend fun loadProgress(updateProgress: (Float) -> Unit) {
    for (i in 1..100) {
        updateProgress(i.toFloat() / 100)
        delay(100)
    }
}
```

上記の実装は、以下の動作になります。

https://youtu.be/3jNDS3oYOeo

円形の場合は以下の動作になります。

https://youtu.be/5-h6oq4CYTI



## 不確定インジケーター

不確定インジケーターは、操作が完了にどれだけ近いかを反映しません。つまり、モーションを使用して、処理が進行中であることをユーザーに示しますが、完了の度合いは指定しません。

不確定進行状況インジケーターを作成するには、LinearProgressIndicator または CircularProgressIndicator コンポーザブル (確定インジケーターと同じ) を使用しますが、進行状況の値を渡さないでください。次の例は、ボタンを押すことで不確定インジケーターを切り替える方法を示しています。

この例では、インジケーターの外観をカスタマイズするために color および trackColor パラメータの値を渡せる方法も示しています。

```kotlin
@Composable
fun IndeterminateCircularIndicator() {
    var loading by remember { mutableStateOf(false) }

    Button(onClick = { loading = true }, enabled = !loading) {
        Text("Start loading")
    }

    if (!loading) return

    CircularProgressIndicator(
        modifier = Modifier.width(64.dp),
        color = MaterialTheme.colorScheme.secondary,
        trackColor = MaterialTheme.colorScheme.surfaceVariant,
    )
}
```

上記の実装は、以下の動作になります。

https://youtu.be/iQ3ls0Ia0rI

線形の場合は以下の動作になります。

https://youtu.be/lsE4Z4nbsS4


## 参考情報

- [マテリアル UI のドキュメント](https://m3.material.io/components/progress-indicators/overview)


