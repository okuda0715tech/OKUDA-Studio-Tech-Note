- [絵文字を表示する](#絵文字を表示する)
  - [相互運用性](#相互運用性)
    - [ComponentActivity から拡張しています](#componentactivity-から拡張しています)
    - [AppCompatActivity からの拡張](#appcompatactivity-からの拡張)
  - [トラブルシューティング](#トラブルシューティング)


# 絵文字を表示する

絵文字の使用はあらゆる種類のアプリで急速に増加しているため、絵文字の標準セットは [Unicode によって毎年更新](https://emojipedia.org/new) されます。

アプリでインターネット コンテンツを表示したり、テキスト入力を提供したりする場合は、最新の絵文字フォントをサポートすることを強くお勧めします。そうしないと、新しい絵文字が豆腐 (☐) と呼ばれる小さな四角いボックスとして表示されたり、他の正しくレンダリングされない絵文字シーケンスとして表示されたりする可能性があります。

Android バージョン 11 (API レベル 30) 以下では絵文字フォントを更新できないため、これらのバージョンで絵文字を表示するアプリは手動で更新する必要があります。

以下は最新の絵文字の例です。

| 例                                       | バージョン            |
| ---------------------------------------- | --------------------- |
| 🫠 🫱🏼‍🫲🏿 🫰🏽                 | 14.0 (September 2021) |
| 😶‍🌫️ 🧔🏻‍♀️ 🧑🏿‍❤️‍🧑🏾 | 13.1 (September 2020) |
| 🥲 🥷🏿 🐻‍❄️                      | 13.0 (March 2020)     |
| 🧑🏻‍🦰 🧑🏿‍🦯 👩🏻‍🤝‍👩🏼  | 12.1 (October 2019)   |
| 🦩 🦻🏿 👩🏼‍🤝‍👩🏻             | 12.0 (February 2019)  |
	
BOM 2023 年 3 月 ( [Compose UI 1.4](https://developer.android.com/jetpack/androidx/releases/compose-ui?_gl=1*w3rzor*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5#version_14_2))) では、API 21 までの古い Android バージョンとの下位互換性を含む、 [最新の絵文字バージョン](https://developer.android.com/develop/ui/views/text-and-emoji/emoji2?_gl=1*113r7ue*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5) がサポートされます。

このサポートではアプリを変更する必要はありません。Text と TextField (Material 2 または Material 3)、または BasicText と BasicTextField を使用している場合は、最新の絵文字サポートをすぐに利用できます。

アプリで [最新の絵文字](https://unicode.org/emoji/charts/emoji-versions.html) をテストする最適な方法は、API 30 以下で実際のデバイスを使用することです。

カスタム絵文字ソリューションを使用している場合、またはその他の理由で Compose のデフォルトの絵文字解像度を無効にする必要がある場合は、 [PlatformTextStyle(emojiSupportMatch)](https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:compose/ui/ui-text/src/androidMain/kotlin/androidx/compose/ui/text/AndroidTextStyle.android.kt;l=85?q=emojisupportmatch) を使用できます。

```kotlin
Text(
    text = "Hello $EMOJI_TEXT",
    style = TextStyle(
        platformStyle = PlatformTextStyle(
            emojiSupportMatch = EmojiSupportMatch.None
        )/* ... */
    )
)
```


## 相互運用性

アプリが同じアクティビティで Views と Compose の両方を使用する場合は、適切な API を使用して絵文字を正しく構成していることを確認してください。次のセクションでは、各 API をいつ使用するかについて説明します。


### ComponentActivity から拡張しています

アクティビティが [AppCompatActivity](https://developer.android.com/reference/androidx/appcompat/app/AppCompatActivity?_gl=1*cdnzj6*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5) ではなく Compose の [ComponentActivity](https://developer.android.com/reference/androidx/activity/ComponentActivity?_gl=1*cdnzj6*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5) から拡張されている場合は、 [AppCompat なしで絵文字をサポートする手順](https://developer.android.com/develop/ui/views/text-and-emoji/emoji2?_gl=1*wi4oq7*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5#support-without-appcompat) に従ってください。

AppCompatActivity を拡張していないため、次のスニペットに示すように、依存関係に [Emoji2 ライブラリ](https://developer.android.com/jetpack/androidx/releases/emoji2?_gl=1*1fn9te4*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5) を追加し、ビューで [TextView](https://developer.android.com/reference/android/widget/TextView?_gl=1*1fn9te4*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5) ウィジェットではなく [EmojiTextView](https://developer.android.com/reference/androidx/emoji/widget/EmojiTextView?_gl=1*1fn9te4*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5) を使用します。

```kotlin
class MainActivity : ComponentActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        val emojiTextView: EmojiTextView = findViewById(R.id.emoji_text_view)
        emojiTextView.text = getString(R.string.emoji_text_view, EMOJI_TEXT)

        val composeView: ComposeView = findViewById(R.id.compose_view)

        composeView.apply {
            setContent {
                // compose code
            }
        }
    }
}
```

XML ファイルは以下のようにします。

```xml
<androidx.emoji2.widget.EmojiTextView
    android:id="@+id/emoji_text_view"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    />
```


### AppCompatActivity からの拡張

Activity が AppCompatActivity から拡張されている場合、 [ComposeView](https://developer.android.com/reference/kotlin/androidx/compose/ui/platform/ComposeView?_gl=1*11gbe7v*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5) を使用してコンポーザブル関数を呼び出すことができます。 Text コンポーザブルを使用すると、Android のバージョン間で絵文字が正しくレンダリングされます。

AppCompatActivity から拡張している場合は、XML から TextView をインフレートして絵文字が正しくレンダリングされるようにします。

これは、XML をインフレートする場合に適用されます:

- ComposeView の外部、Activity 内。次のスニペットで AppCompatActivity と TextView が使用されていることに注意してください。

```kotlin
class MyActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        val emojiTextView: TextView = findViewById(R.id.emoji_text_view)
        emojiTextView.text = getString(R.string.emoji_text_view, EMOJI_TEXT)

        val composeView: ComposeView = findViewById(R.id.compose_view)

        composeView.apply {
            setContent {
                // compose code
            }
        }
    }
}
```

- ComposeView 内で、AndroidViewBinding を使用したビュー バインディングを介して、次のスニペットのように実行します。

```kotlin
class MyActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        setContentView(
            ComposeView(this).apply {
                setContent {
                    Column {
                        Text(EMOJI_TEXT)

                        AndroidViewBinding(ExampleViewBinding::inflate) {
                            emojiTextView.text = EMOJI_TEXT
                        }
                    }
                }
            }
        )
    }
}
```

ComposeView 内で AndroidView を使用してテキストを膨張させるには、AppCompatTextView を使用して絵文字を適切にレンダリングします。

```kotlin
class MyActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        setContentView(
            ComposeView(this).apply {
                setContent {
                    Column {
                        Text(EMOJI_TEXT)

                        AndroidView(
                            factory = { context -> AppCompatTextView(context) },
                            update = { it.text = EMOJI_TEXT }
                        )
                    }
                }
            }
        )
    }
}
```

Compose と View の相互運用に関する詳細については、 [相互運用性 API のドキュメント](https://developer.android.com/develop/ui/compose/migrate/interoperability-apis?_gl=1*jvellp*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5) を参照してください。


## トラブルシューティング

絵文字の代わりに豆腐 (☐) が表示される場合は、まず、問題が特定のテスト デバイスにあるかどうかを確認してください。確認できる主な点は次のとおりです。

- [最近フラッシュしたデバイスまたは新しいエミュレータ](https://developer.android.com/develop/ui/views/text-and-emoji/emoji2?_gl=1*i1vc0p*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5#appcompat-displays-tofu-new-or-flashed-device) を使用している可能性があります。可能であれば、Google アカウントにログインしている、よく使用する別の実際のテスト デバイスを試してください。絵文字が正しいバージョンで機能するようにするには、API を 30 以下にする必要があることに注意してください。

- [テストフォンは、ダウンロード可能なフォントをサポートしていません。](https://developer.android.com/develop/ui/views/text-and-emoji/emoji2?_gl=1*1nui8tz*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5#appcompat-displays-tofu-no-downloadable-font-support)

- [正しい Google Play サービスのバーション](https://developer.android.com/develop/ui/views/text-and-emoji/emoji2?_gl=1*1es31xg*_up*MQ..*_ga*OTU2NjI5OTY2LjE3MjYzOTgxODU.*_ga_6HH9YJMN9M*MTcyNjQ2ODM2MS4yLjAuMTcyNjQ2ODM2MS4wLjAuMzU0MDU5MDk5#appcompat-displays-tofu-earlier-emulator-has-early-google-play-services) を確認してください。

