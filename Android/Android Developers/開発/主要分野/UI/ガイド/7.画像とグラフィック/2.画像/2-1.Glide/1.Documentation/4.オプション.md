- [オプション](#オプション)
  - [RequestBuilder を使用したオプションの指定方法](#requestbuilder-を使用したオプションの指定方法)
  - [RequestOptions を使用したオプションの指定方法](#requestoptions-を使用したオプションの指定方法)
  - [TransitionOptions で切り替わりのオプションを指定する](#transitionoptions-で切り替わりのオプションを指定する)
  - [RequestBuilder](#requestbuilder)
    - [リソースタイプを選択する](#リソースタイプを選択する)
    - [RequestOptions を利用する方法](#requestoptions-を利用する方法)
    - [サムネイルリクエスト](#サムネイルリクエスト)
      - [thumbnail() API の概要](#thumbnail-api-の概要)
      - [thumbnail() API の使用方法](#thumbnail-api-の使用方法)
    - [失敗時に新しいリクエストを開始する](#失敗時に新しいリクエストを開始する)
  - [Glide コンポーネントのオプション指定](#glide-コンポーネントのオプション指定)


# オプション

## RequestBuilder を使用したオプションの指定方法

Glide のほとんどのオプションは、 Glide.with() によって返される [RequestBuilder](https://bumptech.github.io/glide/javadocs/400/com/bumptech/glide/request/RequestOptions.html) オブジェクトに直接適用できます

使用可能なオプションには、次のものがあります (他にもいくつかあります):

- プレースホルダー
- 変換
- キャッシュ戦略
- エンコード品質やデコード ビットマップ構成などのコンポーネント固有のオプション。

たとえば、 [CenterCrop](https://bumptech.github.io/glide/javadocs/400/com/bumptech/glide/load/resource/bitmap/CenterCrop.html) の [変換 ( Transformation )](https://bumptech.github.io/glide/javadocs/400/com/bumptech/glide/load/Transformation.html) を適用するには、次のコードを使用します。

```java
Glide.with(fragment)
    .load(url)
    .centerCrop()
    .into(imageView);
```

## RequestOptions を使用したオプションの指定方法

アプリのさまざまな部分にわたるロードでオプションを一貫して共有したい場合は、新しい `RequestOptions` オブジェクトをインスタンス化し、 [apply()](https://bumptech.github.io/glide/javadocs/400/com/bumptech/glide/RequestBuilder.html#apply-com.bumptech.glide.request.RequestOptions-) メソッドを使用して各ロードに渡すこともできます。

```java
RequestOptions cropOptions = new RequestOptions().centerCrop(context);
...
Glide.with(fragment)
    .load(url)
    .apply(cropOptions)
    .into(imageView);
```

apply() は複数回呼び出すことができるため、RequestOptions を合成できます。2 つの RequestOptions オブジェクトに競合する設定が含まれている場合、ロードに適用された最後の RequestOptions が優先されます。


## TransitionOptions で切り替わりのオプションを指定する

[TransitionOptions](https://bumptech.github.io/glide/javadocs/400/com/bumptech/glide/TransitionOptions.html) は、要求されたロードが完了したときに何が起こるかを決定します。

以下を適用するために、 `TransitionOptions` を使用します。

- ビューのフェードイン
- プレースホルダーからのクロスフェード
- トランジションなし

トランジションがない場合、画像が所定の位置にポップインし、すぐに前の画像と置き換わります。突然の変化を避けるには、TransitionOptions を使用してビューをフェードインするか、Drawable 間でクロスフェードすることができます。

たとえば、クロスフェードを適用するには:

```java
import static com.bumptech.glide.load.resource.drawable.DrawableTransitionOptions.withCrossFade;

Glide.with(fragment)
    .load(url)
    .transition(withCrossFade())
    .into(view);
```

RequestOptions とは異なり、TransitionOptions はタイプ固有であり、Glide にロードするように要求するリソースのタイプに関連付けられています。

その結果、 Bitmap を要求する場合は、 [DrawableTransitionOptions](https://bumptech.github.io/glide/javadocs/400/com/bumptech/glide/load/resource/drawable/DrawableTransitionOptions.html) ではなく [BitmapTransitionOptions](https://bumptech.github.io/glide/javadocs/400/com/bumptech/glide/load/resource/bitmap/BitmapTransitionOptions.html) を使用する必要があります。その結果、 Bitmap を要求する場合は、クロス フェードではなく単純なフェード インを実行する必要がある場合があります。


## RequestBuilder

RequestBuilder は Glide のサーバーリクエストのバックボーンであり、要求された URL またはモデルとオプションをまとめて新しいロードを開始する役割を担います。

RequestBuilder を使用して、次の項目を指定します:

- ロードするリソースのタイプ (Bitmap、Drawable など)
- リソースをロードする URL/モデル
- リソースをロードするビュー
- 適用する RequestOption オブジェクト
- 適用する TransitionOption オブジェクト
- ロードするサムネイル ( `thumbnail()` API については [サムネイルリクエスト](#サムネイルリクエスト) セクションを参照してください。 )

Glide.with() を呼び出し、次に as メソッド ( [詳細は次のセクションを参照](#リソースタイプを選択する) ) のいずれかを呼び出すと、RequestBuilder を取得できます:

```java
RequestBuilder<Drawable> requestBuilder = Glide.with(fragment).asDrawable();
```

もしくは、 Glide.with() を実行して、その後 load() を実行します。

```java
RequestBuilder<Drawable> requestBuilder = Glide.with(fragment).load(url);
```


### リソースタイプを選択する

RequestBuilder は、ロードするリソースのタイプに固有です。デフォルトでは、Drawable RequestBuilder が取得されます。asXxxx メソッドを使用して、要求されたタイプを変更できます。たとえば、asBitmap() を呼び出すと、代わりに Bitmap RequestBuilder が取得されます。

```java
RequestBuilder<Bitmap> requestBuilder = Glide.with(fragment).asBitmap();
```

asXxxx メソッドには以下のものがあります。

- asDrawable
- asBitmap
- asFile
- asGif
- as(Class<ResourceType>)


### RequestOptions を利用する方法

前述のように、RequestOptions は apply() メソッドで適用し、TransitionOptions は transition() メソッドで適用します。

```java
RequestBuilder<Drawable> requestBuilder = Glide.with(fragment).asDrawable();
requestBuilder.apply(requestOptions);
requestBuilder.transition(transitionOptions);
```

RequestBuilders は複数のロードを開始するために再利用することもできます。

```java
RequestBuilder<Drawable> requestBuilder =
    Glide.with(fragment)
        .asDrawable()
        .apply(requestOptions);

for (int i = 0; i < numViews; i++) {
    ImageView view = viewGroup.getChildAt(i);
    String url = urls.get(i);
    requestBuilder.load(url).into(view);
}
```


### サムネイルリクエスト

#### thumbnail() API の概要

Glide の [thumbnail()](https://bumptech.github.io/glide/javadocs/400/com/bumptech/glide/RequestBuilder.html#thumbnail-com.bumptech.glide.RequestBuilder-) API を使用すると、フル品質の画像を読み込みながら、低解像度バージョンの画像を簡単にすばやく読み込むことができるため、ユーザーが読み込みインジケーターを見つめる時間が短縮されます。

thumbnail() API は、ポイントは以下になります。

- メインリクエストと並行して開始する RequestBuilder を指定できます。
- サムネイルは、プライマリリクエストの読み込み中に表示されます。
- プライマリリクエストの画像の取得が完了すると、サムネイルが置き換えられます。
- プライマリリクエストがサムネイルリクエストの前に完了した場合、サムネイルリクエストの画像は表示されません。
- サムネイルの読み込み対象は、ローカル画像とリモート画像の両方に対応しています。


#### thumbnail() API の使用方法

thumbnail() API は比較的簡単に使用できます。

```java
Glide.with(fragment)
    .load(url)
    .thumbnail(
        Glide.with(fragment)
            .load(thumbnailUrl))
    .into(imageView);
```

これは、thumbnailUrl がプライマリ URL よりも解像度の低い画像を指している場合に有効です。多くの画像読み込み API では、URL で必要な画像のサイズを指定する方法が提供されており、これは特に、thumbnail() API で有効です。

ローカル画像を読み込むだけの場合、またはリモート URL が 1 つしかない場合でも、Glide の [override()](https://bumptech.github.io/glide/javadocs/430/com/bumptech/glide/request/RequestOptions.html#override-int-int-) または [sizeMultiplier()](https://bumptech.github.io/glide/javadocs/420/com/bumptech/glide/request/RequestOptions.html#sizeMultiplier-float-) API を使用してサムネイル リクエストで Glide に低解像度の画像を読み込むように強制することで、サムネイル API のメリットを活用できます。

```java
int thumbnailSize = ...;
Glide.with(fragment)
    .load(localUri)
    .thumbnail(
        Glide.with(fragment)
            .load(localUri)
            .override(thumbnailSize))
    .into(view);
```

View または Target のサイズの何パーセントかで同じモデルをロードしたいだけの場合は、sizeMultiplier を受け取る便利な thumbnail() メソッドがあります。

```java
Glide.with(fragment)
    .load(localUri)
    .thumbnail(/*sizeMultiplier=*/ 0.25f)
    .into(imageView);
```


### 失敗時に新しいリクエストを開始する

Glide 4.3.0 以降では、 [error()](https://bumptech.github.io/glide/javadocs/430/com/bumptech/glide/RequestBuilder.html#error-com.bumptech.glide.RequestBuilder-) API を使用してメイン リクエストが失敗した場合に新しいロードを開始するために使用する RequestBuilder を簡単に指定できるようになりました。たとえば、 `primaryUrl` のリクエストが失敗した場合に `fallbackUrl` をロードするには、次のようになります:

```java
Glide.with(fragment)
    .load(primaryUrl)
    .error(
        Glide.with(fragment)
            .load(fallbackUrl))
    .into(imageView);
```

メイン リクエストが正常に完了した場合、エラー RequestBuilder は開始されません。

thumbnail() と error() の両方の RequestBuilder を指定した場合、サムネイル リクエストが成功しても、プライマリ リクエストが失敗するとエラー RequestBuilder が開始されます。


## Glide コンポーネントのオプション指定

[Option](https://bumptech.github.io/glide/javadocs/400/com/bumptech/glide/load/Option.html) クラスは、ModelLoaders、ResourceDecoders、ResourceEncoders、Encoders などの Glide のコンポーネントにパラメータを追加する一般的な方法です。Glide の組み込みコンポーネントの一部にはオプションが含まれており、オプションはカスタム コンポーネントにも追加できます。

```java
Glide.with(context)
    .load(url)
    .option(MyCustomModelLoader.TIMEOUT_MS, 1000L)
    .into(imageView);
```

新しい RequestOptions オブジェクトを作成することもできます。

```java
RequestOptions options = 
    new RequestOptions()
        .set(MyCustomModelLoader.TIMEOUT_MS, 1000L);

Glide.with(context)
    .load(url)
    .apply(options)
    .into(imageView);
```

