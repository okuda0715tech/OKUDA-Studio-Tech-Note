<!-- TOC START min:1 max:3 link:true asterisk:false update:true -->
- [Build Gradleについて](#build-gradleについて)
  - [defaultConfig について](#defaultconfig-について)
  - [ビルドタイプについて](#ビルドタイプについて)
    - [初期値](#初期値)
    - [使い分けの例](#使い分けの例)
  - [プロダクトフレーバーについて](#プロダクトフレーバーについて)
    - [初期値](#初期値-1)
    - [使用例](#使用例)
  - [マニフェストエントリ](#マニフェストエントリ)
  - [依存関係](#依存関係)
  - [署名](#署名)
  - [ProGuard](#proguard)
    - [参考](#参考)
  - [ソースセットの作成](#ソースセットの作成)
    - [フォルダの作成方法](#フォルダの作成方法)
    - [ソースセットの優先順位](#ソースセットの優先順位)
<!-- TOC END -->


# Build Gradleについて

## defaultConfig について

`defaultConfig` は、 `ProductFlavor` クラスに属しています。

`defaultConfig` ブロックですべてのプロダクトフレーバーに共通の設定を行い、  
各フレーバーによって独自の値を設定したい場合は、設定し上書きします。


## ビルドタイプについて

### 初期値

「リリース」、「デバッグ」の２タイプが生成される。

### 使い分けの例

- リリース
  - クラスファイルの圧縮＆難読化
  - リリースキーでAPKに署名する
- デバッグ
  - デバッグオプションが有効化される
  - デバッグツールが含まれている
  - デバッグキーでAPKに署名する

## プロダクトフレーバーについて

各フレーバーのアプリは独自のアプリケーション ID を指定するので、それらは Google Play ストア  
または Android デバイスに同時に存在できます。

プロダクトフレーバーのフレーバーの数だけ、ソースコードが存在することになる？

### 初期値

- デフォルトでは生成されないため、自分で設定する必要がある。

### 使用例

- 「有償版」と「無償版」や「開発版」と「商用版」のアプリを作るなど、多くの共通部分を再利用して、別々のAPKを作成する。


## マニフェストエントリ

- ビルドバリアントの設定により、 AndroidManifest.xml の内容を一部書き換えることができる。
- そのような属性のことをマニフェストエントリと呼ぶのだろう。

## 依存関係

- ライブラリを別途ダウンロードしてプロジェクトに追加しなくても、Gradleにリモートリポジトリを指定するだけで、ビルド時にダウンロードしてくれる。

## 署名

- ビルド中に自動的にAPKに署名することができる。

## ProGuard

- ビルド中にクラスを圧縮、難読化してくれるツールのこと。

### 参考

[Android Proguardによるソースコード難読化まとめ](http://gtech.hatenablog.com/entry/2017/12/05/110229)

## ソースセットの作成

ビルドタイプ、プロダクトフレーバー、ビルドバリアントごとに異なるソースを使用することができる。  
各ソースセットフォルダを作成することで、ビルドシステムが自動的にソースを選択してビルドします。

### フォルダの作成方法

src/main/  
このソースセットには、すべてのビルド バリアントに共通するコードとリソースが含まれています。  
src/buildType/  
特定のビルドタイプ用のコードとリソースのみを含めるには、このソースセットを作成します。  
src/productFlavor/  
特定のプロダクトフレーバー用のコードとリソースのみを含めるには、このソースセットを作成します。  
src/productFlavor1ProductFlavor2/  
フレーバーディメンションで複数のプロダクトフレーバーを作成した場合、  
productFlavor1 と ProductFlavor2 が掛け合わされたビルドバリアントにおいては、  
productFlavor1 単体のソースや productFlavor2 単体のソースよりも、この掛け合わせの  
ソースが優先的に使用されます。
src/productFlavorBuildType/  
特定のビルドバリアント用のコードとリソースのみを含めるには、このソースセットを作成します。


### ソースセットの優先順位

ビルドシステムはビルド時に各ソースセットの内容を統合します。  
統合時の優先順位は以下の通りです。  
左側のソースセットが右側のソースセットのファイルと設定をオーバーライドします。

ビルド バリアント > ビルドタイプ > プロダクト フレーバー > メイン ソースセット > ライブラリの依存関係

（疑問）  
複数のプロダクトフレーバーで同一のリソースを修正した場合はどちらが優先される？
