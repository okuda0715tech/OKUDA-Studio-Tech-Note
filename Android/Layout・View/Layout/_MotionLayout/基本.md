<!-- TOC START min:1 max:3 link:true asterisk:false update:true -->
- [基本](#基本)
	- [概要](#概要)
	- [属性の概要](#属性の概要)
	- [属性](#属性)
	- [KeyAttribute](#keyattribute)
	- [CustomAttribute](#customattribute)
<!-- TOC END -->


# 基本

## 概要

- Gradleの関連付けで`constraintlayout`のバージョン`2.0.0`以上を使用する必要あり。
  - 現時点（2020年7月31日）ではまだベータ8版しか出ていない。
- ボタンやタイトルバーなど、ユーザーが操作する UI 要素を移動、サイズ変更、アニメーション化することができる。
- ConstrainLayoutを継承している。
- どのような遷移もどれほど複雑でもxmlで記述することができる。
- Activityの遷移はアニメーションできない。
- MotionLayoutの直接の子Viewのみをモーションの対象とする。


## 属性の概要

```xml
<MotionScene xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:motion="http://schemas.android.com/apk/res-auto">

	<!-- モーションシーケンスの開始と中間と終了の状態を指定します。 -->
	<!-- シーケンスをトリガーするユーザー操作を指定します。 -->
    <Transition
        motion:constraintSetEnd="@id/end"
        motion:constraintSetStart="@id/start"
        motion:duration="1000"
        motion:motionInterpolator="linear">
        <OnSwipe
            motion:dragDirection="dragRight"
            motion:touchAnchorId="@id/button"
            motion:touchAnchorSide="right" />
		<OnClick />

		<!-- 中間フレームを追加する場合に定義します。 -->
		<!-- モーションシーケンス内のビューの位置と属性を指定します。 -->
		<!-- framePosition は、開始時が 0 で、終了時が 100 になります。 -->
        <KeyFrameSet>
			<!-- モーションシーケンスの特定の時点におけるビュー属性を指定します。 -->
            <KeyAttribute
                android:rotation="-45"
                android:scaleX="2"
                android:scaleY="2"
                motion:framePosition="50"
                motion:motionTarget="@id/button" />
			<!-- モーションシーケンスの特定の時点におけるビュー位置を指定します。 -->
            <KeyPosition
                motion:framePosition="50"
                motion:keyPositionType="pathRelative"
                motion:motionTarget="@id/button"
                motion:percentY="-0.3" />
			<!-- 属性の変化を繰り返す場合に指定します。 -->
			<KeyCycle />
        </KeyFrameSet>
    </Transition>

	<!-- モーションシーケンス内の開始、終了時点での、すべてのビューの位置と属性を指定します。 -->
    <ConstraintSet android:id="@+id/start">
		<!-- モーションシーケンス内の要素の位置と属性を指定します。 -->
        <Constraint
            android:id="@id/button"
            android:layout_width="64dp"
            android:layout_height="64dp"
            android:layout_marginStart="8dp"
            motion:layout_constraintBottom_toBottomOf="parent"
            motion:layout_constraintStart_toStartOf="parent"
            motion:layout_constraintTop_toTopOf="parent">
            <CustomAttribute
                motion:attributeName="BackgroundColor"
                motion:customColorValue="#D81B60" />
        </Constraint>
    </ConstraintSet>

    <ConstraintSet android:id="@+id/end">
        <Constraint
            android:id="@id/button"
            android:layout_width="64dp"
            android:layout_height="64dp"
            android:layout_marginEnd="8dp"
            motion:layout_constraintBottom_toBottomOf="parent"
            motion:layout_constraintEnd_toEndOf="parent"
            motion:layout_constraintTop_toTopOf="parent">
            <CustomAttribute
                motion:attributeName="BackgroundColor"
                motion:customColorValue="#9999FF" />
        </Constraint>
    </ConstraintSet>
</MotionScene>
```


## 属性

```xml
<OnSwipe
		motion:touchAnchorId="@id/button"
		motion:touchAnchorSide="right"
		motion:dragDirection="dragRight" />
```

`touchAnchorId` は、アニメーションさせたい View の ID を指定する。

`touchAnchorSide` は、アニメーションさせたい View の四方のうち、どの部分と指との距離を保つかを指定する。  
MotionLayout では、指と `touchAnchorSide` との距離を一定に保とうとする。

`dragDirection` は、どっち方向のドラッグ (スワイプ) に対してアニメーションを行うかを指定する。  
この値は、 `dragRight/dragLeft/dragUp/dragDown` から成るが、 `right と left` 、  
`up と down` はセットになっており、セットのうちのどちらを指定しても特に違いはないようだ。  
このパラメータは、任意パラメータとなっており、省略可能である。ただし、デフォルト値は、  
`up もしくは down` になっているようなので、左右のスワイプでアニメーションを実行したい場合には、  
必ず指定する必要がある。


## KeyAttribute

指定可能な属性は以下の通りです。

```
android:visibility, android:alpha, android:elevation, 
android:rotation, android:rotationX, android:rotationY, 
android:scaleX, android:scaleY, 
android:translationX, android:translationY, android:translationZ
```

上記以外の属性を指定したい場合は、以下の `CustomAttribute` を使用します。


## CustomAttribute

`CustomAttribute` タグは、 `KeyAttribute` タグ内や `Constraint` タグ内で使用することが可能です。

次の例をもとに説明します。

```xml
    <ConstraintSet android:id="@+id/start">
        <Constraint
            android:id="@id/button">
            <CustomAttribute
                motion:attributeName="BackgroundColor"
                motion:customColorValue="#D81B60" />
        </Constraint>
    </ConstraintSet>
```

`motion:attributeName` 属性には、 getter / setter から get / set を除いた名前を指定します。
