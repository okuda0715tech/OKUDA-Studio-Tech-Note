- [Singleton パターン](#singleton-パターン)
  - [役割](#役割)
  - [実装方法](#実装方法)
    - [基本形](#基本形)
    - [DI（依存性注入）と組み合わせた Singleton の例](#di依存性注入と組み合わせた-singleton-の例)
    - [初期化処理を含む Singleton の例](#初期化処理を含む-singleton-の例)
    - [Android Context を使う Singleton の例（ApplicationContext を使う）](#android-context-を使う-singleton-の例applicationcontext-を使う)
  - [使いどころ](#使いどころ)
    - [データベースマネージャーやネットワークマネージャーの保持](#データベースマネージャーやネットワークマネージャーの保持)
    - [アプリ全体で共有したいメモリ上のデータの保持するリポジトリ](#アプリ全体で共有したいメモリ上のデータの保持するリポジトリ)
    - [何かのインスタンスを生成する Creator 役のクラスを作る場合](#何かのインスタンスを生成する-creator-役のクラスを作る場合)


# Singleton パターン

## 役割

インスタンスを一つだけ作成する。


## 実装方法

### 基本形

Kotlin では、 object キーワードを使うことで、非常に簡単にシングルトンパターンを実装できます。

```kotlin
object MySingleton {
    var count = 0

    fun doSomething() {
        count++
        println("Doing something... Count: $count")
    }
}
```

```kotlin
// 使用する側
fun main() {
    MySingleton.doSomething()  // → Doing something... Count: 1
    MySingleton.doSomething()  // → Doing something... Count: 2

    println(MySingleton.count) // → 2
}
```

- object を使うことで、クラスのインスタンスは一つだけ。
- スレッドセーフで、初期化は遅延される（lazy）。
- MySingleton はどこからでもアクセス可能。


### DI（依存性注入）と組み合わせた Singleton の例

```kotlin
@Singleton
class UserRepository @Inject constructor(
    private val apiService: ApiService
) {
    fun fetchUser() {
        // API 呼び出しなど
    }
}
```

```kotlin
@HiltAndroidApp
class MyApp : Application()
```

```kotlin
@AndroidEntryPoint
class MainActivity : AppCompatActivity() {
    @Inject lateinit var userRepository: UserRepository

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        userRepository.fetchUser()
    }
}
```

この場合、 UserRepository はアプリ全体で 1 つのインスタンスになります。


### 初期化処理を含む Singleton の例

object の init ブロックを使って初期化処理を行います。

```kotlin
object ConfigManager {
    private lateinit var config: String

    init {
        // 初期化処理（ファイル読み込み、設定取得など）
        config = loadConfig()
        println("ConfigManager initialized with config: $config")
    }

    private fun loadConfig(): String {
        // 仮の初期化処理
        return "DefaultConfig"
    }

    fun getConfig(): String = config
}
```


### Android Context を使う Singleton の例（ApplicationContext を使う）

```kotlin
object PreferencesManager {
    private lateinit var preferences: SharedPreferences

    fun init(context: Context) {
        preferences = context.applicationContext.getSharedPreferences("my_prefs", Context.MODE_PRIVATE)
    }

    fun saveValue(key: String, value: String) {
        preferences.edit().putString(key, value).apply()
    }

    fun getValue(key: String): String? = preferences.getString(key, null)
}
```

```kotlin
class MyApp : Application() {
    override fun onCreate() {
        super.onCreate()
        PreferencesManager.init(this)
    }
}
```


## 使いどころ

### データベースマネージャーやネットワークマネージャーの保持

省略


### アプリ全体で共有したいメモリ上のデータの保持するリポジトリ

省略


### 何かのインスタンスを生成する Creator 役のクラスを作る場合

省略

