- [Memento パターン](#memento-パターン)
  - [役割](#役割)
  - [実装方法](#実装方法)
  - [使いどころ](#使いどころ)
    - [状態の Undo / Redo](#状態の-undo--redo)
    - [ViewModel の状態スナップショット](#viewmodel-の状態スナップショット)


# Memento パターン

Memento には、「思い出の種」という意味があります。


## 役割

オブジェクトの内部状態を保存・復元します。内部状態を更新できるのは、オブジェクト本人だけに限定し、データが意図せず破壊されるのを防ぎます。


## 実装方法

可視性修飾子やネストされたクラスを使用して、 Mement の状態を更新できるオブジェクトを限定します。

```kotlin
// Originator
class Editor {
    var text: String = ""

    fun save(): Any = Memento(text)

    fun restore(memento: Any) {
        if (memento is Memento) {
            text = memento.text
        } else {
            throw IllegalArgumentException("Invalid memento")
        }
    }

    fun getText() = text

    // private にすることで、外部のクラスから、
    // Mement に保存した状態が更新されるのを防ぎます。
    private class Memento(val text: String)
}


// Caretaker
fun main() {
    val editor = Editor()
    editor.text = "Hello"
    val saved = editor.save()

    editor.text = "Goodbye"
    println(editor.text) // Goodbye

    editor.restore(saved)
    println(editor.text) // Hello
}
```


## 使いどころ

### 状態の Undo / Redo

アプリ内で「取り消し・やり直し」機能を実装する場合、過去の状態を保存しておく必要があるため、Memento パターン的な構造が役立ちます。

- 例
  - お絵かきアプリでの筆跡の巻き戻し
  - テキストエディタでの元に戻す

→ このとき、状態（CanvasのBitmapやテキストなど）を Memento に保存しておく。


### ViewModel の状態スナップショット

```kotlin
data class UiState(val text: String, val counter: Int)

class MyViewModel : ViewModel() {
    private var savedState: UiState? = null

    var currentState = UiState("", 0)
        private set

    fun saveState() {
        savedState = currentState.copy()
    }

    fun restoreState() {
        savedState?.let {
            currentState = it
        }
    }
}
```



