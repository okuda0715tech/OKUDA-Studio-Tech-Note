- [Proxy ãƒ‘ã‚¿ãƒ¼ãƒ³](#proxy-ãƒ‘ã‚¿ãƒ¼ãƒ³)
  - [å½¹å‰²](#å½¹å‰²)
  - [å®Ÿè£…æ–¹æ³•](#å®Ÿè£…æ–¹æ³•)
    - [Kotlin ã‚’ç”¨ã„ãŸå®Ÿè£…æ–¹æ³•](#kotlin-ã‚’ç”¨ã„ãŸå®Ÿè£…æ–¹æ³•)
      - [é–¢æ•°ã‚’ç›´æ¥ãƒ©ãƒƒãƒ—ã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ](#é–¢æ•°ã‚’ç›´æ¥ãƒ©ãƒƒãƒ—ã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ)
      - [ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆçµŒç”±ã§é–¢æ•°ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ](#ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆçµŒç”±ã§é–¢æ•°ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ)
  - [ä½¿ã„ã©ã“ã‚](#ä½¿ã„ã©ã“ã‚)
    - [API é€šä¿¡ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã«ä½¿ã†ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ­ã‚°ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰](#api-é€šä¿¡ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã«ä½¿ã†ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°ã‚­ãƒ£ãƒƒã‚·ãƒ¥)
      - [ğŸ¯ ç›®çš„](#-ç›®çš„)
      - [ğŸ’¡ ä½¿ã„ã©ã“ã‚](#-ä½¿ã„ã©ã“ã‚)
    - [ViewModel â†’ Repository é–“ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ»ãƒªãƒˆãƒ©ã‚¤åˆ¶å¾¡ãªã©ã«](#viewmodel--repository-é–“ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒªãƒˆãƒ©ã‚¤åˆ¶å¾¡ãªã©ã«)
      - [ğŸ¯ ç›®çš„](#-ç›®çš„-1)
      - [ğŸ’¡ ä¾‹](#-ä¾‹)
    - [é‡ã„å‡¦ç†ã®é…å»¶åˆæœŸåŒ–ï¼ˆVirtual Proxyï¼‰](#é‡ã„å‡¦ç†ã®é…å»¶åˆæœŸåŒ–virtual-proxy)
      - [ğŸ¯ ç›®çš„](#-ç›®çš„-2)
    - [ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯å·®ã—æ›¿ãˆ](#ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯å·®ã—æ›¿ãˆ)
      - [ğŸ¯ ç›®çš„](#-ç›®çš„-3)
      - [ğŸ’¡ ä¾‹](#-ä¾‹-1)


# Proxy ãƒ‘ã‚¿ãƒ¼ãƒ³

Proxy ã«ã¯ã€ã€Œä»£ç†äººã€ã¨ã„ã†æ„å‘³ãŒã‚ã‚Šã¾ã™ã€‚


## å½¹å‰²

ç‰¹å®šã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹éš›ã«ã€å…ˆã«ä»£ç†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€æœ¬ç‰©ã®æ©Ÿèƒ½ã®å‰å¾Œã«ä½•ã‚‰ã‹ã®å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆãƒ€ãƒ–ãƒ«ã®ä¸€ç¨®ã§ã‚ã‚‹ ã€Œã‚¹ãƒ‘ã‚¤ã€ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ã“ã® Proxy ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¦å®Ÿç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚


## å®Ÿè£…æ–¹æ³•

### Kotlin ã‚’ç”¨ã„ãŸå®Ÿè£…æ–¹æ³•

Kotlin ã§ã¯é–¢æ•°ã‚’ä¸€ç´šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æ‰±ãˆã‚‹ãŸã‚ã€ Proxy ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒãŒã‚·ãƒ³ãƒ—ãƒ«ã«å®Ÿç¾ã§ãã¾ã™ã€‚

#### é–¢æ•°ã‚’ç›´æ¥ãƒ©ãƒƒãƒ—ã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

```kotlin
// å®Ÿéš›ã®å‡¦ç†ï¼ˆæœ¬ä½“ï¼‰
fun fetchData(): String {
    println("Fetching data...")
    return "data"
}

// é–¢æ•°å‹ Proxyï¼ˆå‰å¾Œã«å‡¦ç†ã‚’æŒŸã‚€ï¼‰
fun <T> proxy(action: () -> T): T {
    println("Before action")
    val result = action()
    println("After action")
    return result
}

// ä½¿ç”¨ä¾‹
fun main() {
    val result = proxy { fetchData() }
    println("Result: $result")
}
```


#### ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆçµŒç”±ã§é–¢æ•°ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

```kotlin
interface Service {
    fun execute()
}

class RealService : Service {
    override fun execute() {
        println("RealService: Executing")
    }
}

// Proxy ã‚’é–¢æ•°ã§ãƒ©ãƒƒãƒ—
fun proxy(service: Service): Service = object : Service {
    override fun execute() {
        println("Proxy: Before execute")
        service.execute()
        println("Proxy: After execute")
    }
}

// ä½¿ç”¨ä¾‹
fun main() {
    val real = RealService()
    val proxied = proxy(real)
    proxied.execute()
}
```


## ä½¿ã„ã©ã“ã‚

### API é€šä¿¡ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã«ä½¿ã†ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ­ã‚°ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰

#### ğŸ¯ ç›®çš„

- API ã®å‰å¾Œã§ãƒ­ã‚°ã‚’å–ã‚‹
- ç‰¹å®šã®æ¡ä»¶ï¼ˆä¾‹ï¼šæœªãƒ­ã‚°ã‚¤ãƒ³ï¼‰ã§ã¯ API ã‚’å‘¼ã°ãªã„
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚‹å ´åˆã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡ã‚’ã‚¹ã‚­ãƒƒãƒ—


#### ğŸ’¡ ä½¿ã„ã©ã“ã‚

ä¾‹ãˆã°ã€UserApi ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å‰ã«ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯ã‚’æŒŸã¿ãŸã„ã¨ãï¼š

```kotlin
interface UserApi {
    suspend fun getUserProfile(): UserProfile
}

class RealUserApi : UserApi {
    override suspend fun getUserProfile(): UserProfile {
        // Retrofitãªã©ã‚’ä½¿ã£ãŸå®Ÿéš›ã®APIé€šä¿¡
    }
}

class UserApiProxy(
    private val realApi: RealUserApi,
    private val sessionManager: SessionManager
) : UserApi {
    override suspend fun getUserProfile(): UserProfile {
        if (!sessionManager.isLoggedIn()) {
            throw IllegalStateException("ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™")
        }
        println("UserApiProxy: APIå‘¼ã³å‡ºã—å‰ã«ãƒ­ã‚°ã‚’è¨˜éŒ²")
        return realApi.getUserProfile()
    }
}
```


### ViewModel â†’ Repository é–“ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ»ãƒªãƒˆãƒ©ã‚¤åˆ¶å¾¡ãªã©ã«

#### ğŸ¯ ç›®çš„

- ãƒªãƒˆãƒ©ã‚¤å‡¦ç†
- ãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•æ›´æ–°
- çµ±ä¸€çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°


#### ğŸ’¡ ä¾‹

```kotlin
interface MyRepository {
    suspend fun fetchData(): Result<String>
}

class MyRepositoryImpl : MyRepository {
    override suspend fun fetchData(): Result<String> {
        // é€šå¸¸ã®å‡¦ç†
    }
}

class MyRepositoryProxy(
    private val real: MyRepositoryImpl,
    private val retryPolicy: RetryPolicy
) : MyRepository {
    override suspend fun fetchData(): Result<String> {
        return retryPolicy.runWithRetry {
            real.fetchData()
        }
    }
}
```


### é‡ã„å‡¦ç†ã®é…å»¶åˆæœŸåŒ–ï¼ˆVirtual Proxyï¼‰

#### ğŸ¯ ç›®çš„

- å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚„ç”»åƒã®ãƒ­ãƒ¼ãƒ‰ã‚’é…å»¶ã™ã‚‹
  - å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§ã€ã‚·ãƒãƒ¼ï¼ˆShimmerï¼‰ã‚’è¡¨ç¤ºã™ã‚‹ç­‰
    - ã‚·ãƒãƒ¼ã¨ã¯ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„ã¨ãã«ã€èª­ã¿è¾¼ã¾ã‚Œã‚‹äºˆå®šã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å½¢ï¼ˆãŸã¨ãˆã°ç”»åƒã‚„ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ–ãƒ­ãƒƒã‚¯ãªã©ï¼‰ã«æ²¿ã£ã¦é…ç½®ã•ã‚Œã‚‹ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã§ã™ã€‚
    - ã‚­ãƒ©ã‚­ãƒ©ã¨å…‰ãŒæµã‚Œã‚‹ã‚ˆã†ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒä»˜ã„ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã€Œä»Šãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã‚ˆã€ã¨ã„ã†ã“ã¨ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¦–è¦šçš„ã«ä¼ã‚ã‚Šã¾ã™ã€‚
- åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ã¿åˆæœŸåŒ–

```kotlin
interface ImageLoader {
    fun loadImage(view: ImageView)
}

class RealImageLoader(private val url: String) : ImageLoader {
    override fun loadImage(view: ImageView) {
        Glide.with(view).load(url).into(view)
    }
}

class LazyImageLoaderProxy(private val url: String) : ImageLoader {
    private var realLoader: RealImageLoader? = null

    override fun loadImage(view: ImageView) {
        if (realLoader == null) {
            // åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ã¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
            realLoader = RealImageLoader(url)
        }
        realLoader?.loadImage(view)
    }
}
```

ä¸Šè¨˜ã®ã‚ˆã†ã«å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€ loadImage ã‚’å‘¼ã³å‡ºã—ãŸã„ã¨ãã«ã€æ¯å› ImageLoader ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã‹ã‚’æ°—ã«ã™ã‚‹ã“ã¨ãªãã€ loadImage ã‚’å‘¼ã³å‡ºã›ã¾ã™ã€‚


### ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯å·®ã—æ›¿ãˆ

#### ğŸ¯ ç›®çš„

- å®Ÿéš›ã®æ©Ÿèƒ½ã¯ãã®ã¾ã¾ä½¿ã„ãŸã„ãŒã€ä¸€éƒ¨ã ã‘å·®ã—æ›¿ãˆãŸã„ã¨ã


#### ğŸ’¡ ä¾‹

ãƒ†ã‚¹ãƒˆæ™‚ã«ã®ã¿ãƒ­ã‚°å‡ºåŠ›ã—ãŸã„å ´åˆï¼š

```kotlin
class LoggingRepositoryProxy(
    private val real: MyRepository
) : MyRepository {
    override suspend fun fetchData(): Result<String> {
        println("LoggingProxy: fetchData ãŒå‘¼ã°ã‚ŒãŸ")
        return real.fetchData()
    }
}
```

ãƒ†ã‚¹ãƒˆæ™‚ã«ã€å¼·åˆ¶çš„ã«ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ãŸã„å ´åˆï¼š

```kotlin
class TestUserRepositoryProxy(
    private val real: UserRepository
) : UserRepository {

    var forceError = false

    override suspend fun getUser(): User {
        if (forceError) {
            throw IllegalStateException("ãƒ†ã‚¹ãƒˆç”¨ã®å¼·åˆ¶ã‚¨ãƒ©ãƒ¼")
        }
        return real.getUser()
    }
}
```

```kotlin
// å‘¼ã³å‡ºã—å´

val realRepo = RealUserRepository()
val proxyRepo = LoggingUserRepositoryProxy(realRepo)

// ViewModel ã«æ¸¡ã™ã¨ã€å†…éƒ¨çš„ã«ã¯æœ¬ç‰©ã‚’ä½¿ã†ã‘ã©ãƒ­ã‚°ã‚‚å‡ºã‚‹
val viewModel = UserViewModel(proxyRepo)
```








