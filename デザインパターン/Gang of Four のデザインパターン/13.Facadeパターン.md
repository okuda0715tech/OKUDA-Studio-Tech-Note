

# Facade パターン

## 語源

Facade は、「建物の正面」という意味です。


## 役割

複雑な処理をまとめて、シンプルな呼び出しで実行できるようにします。

複雑さの隠蔽を目的としています。


## 実装方法

以下の例は、スマートホームアプリの例です。

```kotlin
// サブシステムのクラスたち
class Light {
    fun on() = println("ライト ON")
    fun off() = println("ライト OFF")
}

class AirConditioner {
    fun start() = println("エアコン 起動")
    fun stop() = println("エアコン 停止")
}

class SecuritySystem {
    fun arm() = println("セキュリティ ON")
    fun disarm() = println("セキュリティ OFF")
}

// Facade クラス
class HomeFacade(
    private val light: Light,
    private val ac: AirConditioner,
    private val security: SecuritySystem
) {
    fun leaveHome() {
        light.off()
        ac.stop()
        security.arm()
    }

    fun returnHome() {
        security.disarm()
        light.on()
        ac.start()
    }
}

// クライアントコード
fun main() {
    val home = HomeFacade(Light(), AirConditioner(), SecuritySystem())
    home.leaveHome()  // 家を出るときの一括操作
    home.returnHome() // 帰宅時の一括操作
}
```


## 使いどころ

### Repository を通して、データアクセスを隠蔽する

```kotlin
// ネットワークの API クラス（簡略）
class ApiService {
    suspend fun fetchUserFromApi(userId: String): User {
        println("APIから取得")
        return User(userId, "Remote User")
    }
}

// ローカルDB クラス（簡略）
class LocalDatabase {
    private val localCache = mutableMapOf<String, User>()

    fun getUser(userId: String): User? = localCache[userId]

    fun saveUser(user: User) {
        println("ローカルDBに保存")
        localCache[user.id] = user
    }
}

// Facade（Repository）
class UserRepository(
    private val apiService: ApiService,
    private val localDatabase: LocalDatabase
) {
    suspend fun getUser(userId: String): User {
        val localUser = localDatabase.getUser(userId)
        return if (localUser != null) {
            println("ローカルから取得")
            localUser
        } else {
            val remoteUser = apiService.fetchUserFromApi(userId)
            localDatabase.saveUser(remoteUser)
            remoteUser
        }
    }
}

// Model
data class User(val id: String, val name: String)

// ViewModel（クライアント側）
class UserViewModel(
    private val userRepository: UserRepository
) {
    suspend fun loadUser(userId: String) {
        val user = userRepository.getUser(userId)
        println("ViewModelで受け取ったユーザー: $user")
    }
}
```

UserRepository が、ネットワークやローカルDB、キャッシュの切り替えなどの複雑な処理をカプセル化して隠蔽しています。ViewModel や UI 側は「getUser だけ呼べばいい」という、シンプルなインターフェースで済みます。


### UI から複雑なビジネスロジックを隠蔽したい場合

省略


### ライブラリやフレームワークをシンプルに扱いたい場合

省略


### テストコードなどで、シンプルにインターフェースを扱いたいとき

省略


