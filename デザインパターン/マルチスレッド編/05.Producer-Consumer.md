- [Producer-Consumer](#producer-consumer)
  - [役割](#役割)
  - [実装方法](#実装方法)
    - [Kotlin の Channel を使用した方法](#kotlin-の-channel-を使用した方法)
  - [使いどころ](#使いどころ)


# Producer-Consumer

## 役割

橋渡し役を通して、プロデューサーとコンシューマーの間で安全にデータを受け渡します。

データを生成するプロデューサーと、データを利用するコンシューマーが、別々のスレッド or コルーチンで動作している場合に、橋渡し役がその間に入り、お互いの処理タイミングのずれを吸収します。


## 実装方法

### Kotlin の Channel を使用した方法

Channel がキューのような役割を果たし、プロデューサー側のコルーチンと、コンシューマー側のコルーチンの間で、データの受け渡しを行います。

```kotlin
import kotlinx.coroutines.*
import kotlinx.coroutines.channels.Channel

fun main() = runBlocking {
    val channel = Channel<Int>() // Int 型の Channel（バッファなし）

    // Producer（データを送る側）
    val producer = launch {
        for (i in 1..5) {
            println("🔵 Producing $i")
            channel.send(i)
            delay(300L)
        }
        channel.close() // 終了を伝える
    }

    // Consumer（データを受け取る側）
    val consumer = launch {
        for (value in channel) { // channel.close() までループ
            println("🟢 Consuming $value")
            delay(500L)
        }
    }

    producer.join()
    consumer.join()
}
```

- Channel はスレッドセーフで、コルーチン間で安全にデータをやり取りできる。
- send() は suspend 関数。バッファが空くまで一時停止されることもある。
- for (value in channel) は Channel が close() されるまで自動で受信。


## 使いどころ

