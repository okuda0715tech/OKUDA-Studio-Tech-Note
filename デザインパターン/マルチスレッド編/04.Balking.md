- [Balking](#balking)
  - [役割](#役割)
  - [実装方法](#実装方法)
  - [使いどころ](#使いどころ)


# Balking

## 役割

実行する必要がなければ、実行しなません。


## 実装方法

実装方法は、 Guarded Suspension パターンに非常によく似ています。これらの違いは、以下の点です。

- Guarded Suspension は、ガード条件を満たさない場合は、満たすまで待機する
- Balking は、ガード条件を満たさない場合は、実行しない (実行をキャンセルする) 。

```kotlin
import kotlinx.coroutines.*
import kotlinx.coroutines.sync.Mutex
import kotlinx.coroutines.sync.withLock

class DataSaver {
    private var isSaved = false
    private val mutex = Mutex()

    suspend fun saveData() {
        mutex.withLock {
            if (isSaved) {
                println("もう保存済みなので、スキップします")
                return
            }

            println("データを保存中...")
            delay(1000) // 擬似的な保存処理
            isSaved = true
            println("保存完了")
        }
    }
}
```

使用側：

```kotlin
fun main() = runBlocking {
    val saver = DataSaver()

    // 複数のコルーチンが同時に保存を試みる
    val jobs = List(5) {
        launch {
            // このブロック内の処理は、
            // 明示的に開始しているように見えないかもしれませんが、
            // launch が実行されるとすぐに開始されます。
            saver.saveData()
        }
    }

    jobs.forEach { it.join() }
}
```


## 使いどころ

