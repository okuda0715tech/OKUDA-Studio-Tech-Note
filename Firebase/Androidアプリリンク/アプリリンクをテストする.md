<!-- TOC START min:1 max:3 link:true asterisk:false update:true -->
- [アプリリンクをテストする](#アプリリンクをテストする)
  - [Digital Asset Links ファイルを確認する](#digital-asset-links-ファイルを確認する)
  - [URL インテントをテストする](#url-インテントをテストする)
  - [リンクポリシーをチェックする](#リンクポリシーをチェックする)
  - [アプリがすでにドメインに対して承認されているかどうかを確認する](#アプリがすでにドメインに対して承認されているかどうかを確認する)
  - [ドメイン検証プロセスを手動で有効にする](#ドメイン検証プロセスを手動で有効にする)
  - [デバイスの Android アプリリンクの状態をリセットする](#デバイスの-android-アプリリンクの状態をリセットする)
  - [ドメイン検証プロセスを呼び出す](#ドメイン検証プロセスを呼び出す)
  - [検証結果を確認する](#検証結果を確認する)
<!-- TOC END -->


# アプリリンクをテストする

## Digital Asset Links ファイルを確認する

ウェブサイトごとに、Digital Asset Links API を使用して、デジタル アセットリンク JSON ファイルが  
正しくホストされ定義されていることを確認します。

```
https://digitalassetlinks.googleapis.com/v1/statements:list?source.web.site=https://{アプリリンクのドメイン部分}&relation=delegate_permission/common.handle_all_urls

{アプリリンクのドメイン部分} には example.com などが入る。
```

## URL インテントをテストする

```
adb shell am start -W -a android.intent.action.VIEW -c android.intent.category.BROWSABLE -d "https://{アプリリンクのドメイン部分}" {アプリケーションID (パッケージ名) }
```


## リンクポリシーをチェックする

 ```
adb shell dumpsys package domain-preferred-apps
adb shell dumpsys package d
```

(注意)アプリのインストール後、システムが検証プロセスを完了するまで、少なくとも 20 秒待つようにしてください。

見方がわからない...。


## アプリがすでにドメインに対して承認されているかどうかを確認する

```
（開発中）
adb shell pm get-app-links --user cur {アプリケーションID (パッケージ名) }
（実行時）
API を使用する（詳細は公式ドキュメントを参照）
```


## ドメイン検証プロセスを手動で有効にする

```
adb shell am compat enable 175408749 {アプリケーションID (パッケージ名) }
```


## デバイスの Android アプリリンクの状態をリセットする

```
adb shell pm set-app-links --package {アプリケーションID (パッケージ名) } 0 all
```


## ドメイン検証プロセスを呼び出す

```
adb shell pm verify-app-links --re-verify {アプリケーションID (パッケージ名) }
```


## 検証結果を確認する

```
adb shell pm get-app-links {アプリケーションID (パッケージ名) }
```
