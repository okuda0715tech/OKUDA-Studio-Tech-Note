- [Functions（Cloud Functions）](#functionscloud-functions)
  - [🔧 Cloud Functions の基本ポイント](#-cloud-functions-の基本ポイント)
  - [⚡ 主なトリガーの種類](#-主なトリガーの種類)
  - [🧪 例：Firestore にドキュメントが追加されたら通知を送る](#-例firestore-にドキュメントが追加されたら通知を送る)
  - [🚀 デプロイ方法](#-デプロイ方法)
  - [🔐 認証付き API（HTTPS 関数）も作れる](#-認証付き-apihttps-関数も作れる)
  - [よく使われる用途](#よく使われる用途)
  - [引用元資料](#引用元資料)


# Functions（Cloud Functions）

Firebase の Cloud Functions は、Firebase と他の Google サービスと連携できる サーバーレスのバックエンド処理 を書くための仕組みです。イベントに応じて自動でコードを実行できます。


## 🔧 Cloud Functions の基本ポイント

- サーバーレス：インフラの準備や管理が不要。スケーラブル。
- イベントドリブン：特定のイベント（例：Firestore にデータが追加された、ユーザーが登録したなど）をトリガーにして実行。
- JavaScript / TypeScript で記述（Node.js 環境）


## ⚡ 主なトリガーの種類

- Firebase Authentication
  - ユーザーが登録・削除されたときに動作
- Cloud Firestore
  - ドキュメントが作成・更新・削除されたとき
- Realtime Database
  - データ変更に応じて実行
- Cloud Storage
  - ファイルがアップロード・削除されたとき
- HTTPS リクエスト
  - 自分でエンドポイントを作れる（API 的に使える）
- スケジュール実行（cron）
  - 毎日や毎時など、定期的に実行できる


## 🧪 例：Firestore にドキュメントが追加されたら通知を送る

```ts
import * as functions from "firebase-functions";
import * as admin from "firebase-admin";

admin.initializeApp();

export const sendNotification = functions.firestore
    .document("messages/{messageId}")
    .onCreate(async (snap, context) => {
        const newValue = snap.data();
        const message = newValue?.text;

        // ログ出力
        console.log("New message:", message);

        // 通知や他の処理をここで行う
    });
```


## 🚀 デプロイ方法

```bash
firebase deploy --only functions
```


## 🔐 認証付き API（HTTPS 関数）も作れる

```ts
export const myApi = functions.https.onRequest((req, res) => {
    res.send("Hello from Firebase Function!");
});
```


## よく使われる用途

- プッシュ通知の送信
- 課金処理（Stripe などとの連携）
- 管理者権限でのデータ書き込み
- 外部 API の呼び出し
- サーバーサイドのセキュリティチェック


## 引用元資料

- ChatGPT


