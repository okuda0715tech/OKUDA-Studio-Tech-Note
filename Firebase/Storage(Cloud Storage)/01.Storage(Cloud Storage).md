- [Storage（Cloud Storage）](#storagecloud-storage)
  - [🔧 主な特徴](#-主な特徴)
  - [📦 よく使う機能](#-よく使う機能)
  - [💡 よくある使い方の例 (Android Kotlin)](#-よくある使い方の例-android-kotlin)
    - [Firebase Storage の初期化](#firebase-storage-の初期化)
    - [ファイルのアップロード](#ファイルのアップロード)
    - [ダウンロード URL を取得](#ダウンロード-url-を取得)
    - [ファイルの削除](#ファイルの削除)
  - [🔐 セキュリティルールの設定（例）](#-セキュリティルールの設定例)
  - [💡補足：ローカル開発でもルールは使える？](#補足ローカル開発でもルールは使える)
  - [引用元資料](#引用元資料)


# Storage（Cloud Storage）

Firebase の Cloud Storage は、 Google Cloud Platform 上に構築された、強力なファイル保存サービスです。モバイルアプリやウェブアプリから、画像・動画・音声・PDF などの大きなファイルを、安全に保存・取得できます。


## 🔧 主な特徴

- 大容量対応: 数 GB ～ TB クラスのファイルも保存可能。
- セキュア: Firebase Authentication と連携して、ユーザーごとにアクセス制御ができる。
- リアルタイムアップロード: アップロード進捗を監視しながら実装可能。
- 強力なインフラ: Google Cloud のインフラで高速・信頼性が高い。


## 📦 よく使う機能

- putFile(): 端末上のファイルをアップロード
- getDownloadUrl(): アップロードしたファイルのダウンロード URL を取得
- delete(): ファイル削除
- listAll(): ディレクトリ内の全ファイルを取得


## 💡 よくある使い方の例 (Android Kotlin)

### Firebase Storage の初期化

```kotlin
val storageRef = Firebase.storage.reference
```


### ファイルのアップロード

```kotlin
val fileUri: Uri = ... // ギャラリーなどから取得した Uri
val imageRef = storageRef.child("images/${UUID.randomUUID()}.jpg")

imageRef.putFile(fileUri)
    .addOnSuccessListener {
        // アップロード成功
    }
    .addOnFailureListener {
        // エラー処理
    }
```


### ダウンロード URL を取得

```kotlin
// downloadUrl はプロパティですが、内部で getDownloadUrl() を
// 呼び出しているようなので、 downloadUrl の代わりに
// getDownloadUrl() メソッドを呼び出しても大丈夫かも。
imageRef.downloadUrl.addOnSuccessListener { uri ->
    val downloadUrl = uri.toString()
}
```


### ファイルの削除


```kotlin
imageRef.delete().addOnSuccessListener {
    // 削除成功
}
```


## 🔐 セキュリティルールの設定（例）

セキュリティルールは、 Firebase Console 上で記述します。

以下の例では、認証済ユーザーのみが自分のファイルにアクセスできるようにしています。

```plaintext
rules_version = '2';
service firebase.storage {
    match /b/{bucket}/o {
        match /userFiles/{userId}/{allPaths=**} {
            allow read, write: if request.auth != null && request.auth.uid == userId;
        }
    }
}
```


## 💡補足：ローカル開発でもルールは使える？

はい。 Firebase Emulator Suite を使えば、ローカルでもルールを適用したテストができます。

ルールのバグで「誰でも読み放題！」になってしまうリスクを避けるためにも、エミュレータでテストするのがベストです。



## 引用元資料

- ChatGPT


