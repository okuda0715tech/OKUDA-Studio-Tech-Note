- [Firestore ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰é›†](#firestore-ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰é›†)
  - [ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã®å‚ç…§ã®å–å¾—](#ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã®å‚ç…§ã®å–å¾—)
  - [ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ï¼ˆæ–°è¦ä¿å­˜ / æ›´æ–°ï¼‰](#ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜æ–°è¦ä¿å­˜--æ›´æ–°)
    - [ä¿å­˜ç³»ãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§](#ä¿å­˜ç³»ãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§)
    - [add() ã®ä½¿ç”¨ä¾‹](#add-ã®ä½¿ç”¨ä¾‹)
    - [set() ã®ä½¿ç”¨ä¾‹](#set-ã®ä½¿ç”¨ä¾‹)
    - [update() ã®ä½¿ç”¨ä¾‹](#update-ã®ä½¿ç”¨ä¾‹)
  - [ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿](#ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿)
    - [ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè¤‡æ•°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰ã®èª­ã¿è¾¼ã¿](#ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è¤‡æ•°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿)
    - [å˜ä¸€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿](#å˜ä¸€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿)
  - [ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤](#ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤)
  - [ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ã¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ](#ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ã¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ)
    - [ã‚¢ãƒ—ãƒªãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å—ã‘å–ã‚ŠãŸã„å ´åˆ](#ã‚¢ãƒ—ãƒªãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å—ã‘å–ã‚ŠãŸã„å ´åˆ)
  - [ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ](#ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ)
    - [ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³](#ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³)
      - [ðŸ”¸ Firestore ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ï¼Ÿ](#-firestore-ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯)
      - [ðŸ”¸ ã‚ˆãã‚ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹](#-ã‚ˆãã‚ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹)
      - [ðŸ”¸ ã‚µãƒ³ãƒ—ãƒ«ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒã‚¤ãƒ³ãƒˆã‚’åŠ ç®—](#-ã‚µãƒ³ãƒ—ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒã‚¤ãƒ³ãƒˆã‚’åŠ ç®—)
  - [æ¡ä»¶ä»˜ãã‚¯ã‚¨ãƒªï¼ˆWhereï¼‰ãƒ»é †åºæŒ‡å®šã‚¯ã‚¨ãƒªï¼ˆOrderByï¼‰](#æ¡ä»¶ä»˜ãã‚¯ã‚¨ãƒªwhereé †åºæŒ‡å®šã‚¯ã‚¨ãƒªorderby)
  - [å¼•ç”¨å…ƒè³‡æ–™](#å¼•ç”¨å…ƒè³‡æ–™)


# Firestore ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰é›†

## ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã®å‚ç…§ã®å–å¾—

```kotlin
FirebaseFirestore.getInstance()
    // ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®å–å¾—
    .collection("users")
    // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å–å¾—
    .document("user1")
```

- è©²å½“ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã—ãªã„å ´åˆã§ã‚‚ã€ collection() ã‚„ document() ã‚’å‘¼ã³å‡ºã—ãŸã ã‘ã§ã¯ã€ä¾‹å¤–ã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã€‚
- ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå®Ÿéš›ã«å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ã€éžåŒæœŸã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹æ“ä½œï¼ˆ get() ã‚„ addSnapshotListener() ãªã©ï¼‰ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä¾‹ãˆã°ã€ `document().get()` ã‚’ä½¿ã£ã¦ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã®å‚ç…§ã‚’å–å¾—ã—ã€ exists() ãƒ¡ã‚½ãƒƒãƒ‰ã§å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã§ãã¾ã™ã€‚

```kotlin
val docRef = FirebaseFirestore.getInstance().collection("users").document("userId123")
docRef.get().addOnSuccessListener { document ->
    if (document.exists()) {
        Log.d("Firestore", "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã—ã¾ã™: ${document.data}")
    } else {
        Log.d("Firestore", "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å­˜åœ¨ã—ã¾ã›ã‚“")
    }
}.addOnFailureListener { exception ->
    // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚„ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãªã©ã€å–å¾—ä¸å¯èƒ½ãªå ´åˆ
    Log.e("Firestore", "å–å¾—æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ", exception)
}
```


## ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ï¼ˆæ–°è¦ä¿å­˜ / æ›´æ–°ï¼‰

### ä¿å­˜ç³»ãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§

- add()
  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå˜ä½ã§ã€å¸¸ã«æ–°è¦ä½œæˆã—ã¾ã™ã€‚
- set()
  - è©²å½“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã™ã‚Œã°ã€ **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå˜ä½ã®ä¸Šæ›¸ã** or **é …ç›®å˜ä½ã®æ›´æ–°** ã‚’è¡Œã„ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã—ãªã‘ã‚Œã°ã€ **æ–°è¦ä½œæˆ** ã—ã¾ã™ã€‚
    - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ID ã§åˆ¤å®šã•ã‚Œã¾ã™ã€‚
  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä¸Šæ›¸ãã‚ªãƒ—ã‚·ãƒ§ãƒ³
    - set() ã®ç¬¬äºŒå¼•æ•°ã« `SetOptions.merge()` ã‚’æ¸¡ã™ã¨ã€æ¸¡ã•ã‚ŒãŸé …ç›®ã®ã¿ãŒä¸Šæ›¸ãã•ã‚Œã€æ¸¡ã•ã‚Œãªã‹ã£ãŸé …ç›®ã¯æ®‹ã‚Šã¾ã™ã€‚
    - `SetOptions.merge()` ã‚’æ¸¡ã•ãªã‹ã£ãŸå ´åˆã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã”ã¨ä¸Šæ›¸ãã•ã‚Œã€æ¸¡ã•ã‚Œãªã‹ã£ãŸé …ç›®ã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚
- update
  - é …ç›®å˜ä½ã§æ›´æ–°ã—ã¾ã™ã€‚
  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã—ãªã‹ã£ãŸå ´åˆã¯ã€æ›´æ–°ã«å¤±æ•—ã—ã€ä¾‹å¤–ãŒç™ºç”Ÿã—ã¾ã™ã€‚


### add() ã®ä½¿ç”¨ä¾‹

```kotlin
val db = FirebaseFirestore.getInstance()

// æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
val user = hashMapOf(
    "name" to "Hanako",
    "age" to 28
)

db.collection("users")
    .add(user)  // è‡ªå‹•ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ID ãŒè¨­å®šã•ã‚Œã‚‹ã€‚
    .addOnSuccessListener { docRef ->
        // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ID ã¯ã€ docRef.id ã§å–å¾—å¯èƒ½
        Log.d("Firestore", "Document added with ID: ${docRef.id}")
    }
    .addOnFailureListener { e ->
        Log.w("Firestore", "Error adding document", e)
    }
```


### set() ã®ä½¿ç”¨ä¾‹

```kotlin
db.collection("users")
    .document("user123")
    .set(user)  // æ—¢å­˜ãŒã‚ã‚Œã°ä¸Šæ›¸ã
```


### update() ã®ä½¿ç”¨ä¾‹

```kotlin
db.collection("users")
    .document("user123")
    .update("age", 30)
    .addOnSuccessListener {
        Log.d("Firestore", "Document successfully updated!")
    }
    .addOnFailureListener { e ->
        Log.w("Firestore", "Error updating document", e)
    }
```


## ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿

ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ã‚‚ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿ã‚‚ã€åŒã˜ get() ãƒ¡ã‚½ãƒƒãƒ‰ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚


### ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè¤‡æ•°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰ã®èª­ã¿è¾¼ã¿

```kotlin
// ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
db.collection("users")
    .get()
    .addOnSuccessListener { result ->
        for (document in result) {
            Log.d("Firestore", "${document.id} => ${document.data}")
        }
    }
    .addOnFailureListener { e ->
        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚„ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãªã©ã€å–å¾—ä¸å¯èƒ½ãªå ´åˆã§ç™ºç”Ÿ
        Log.w("Firestore", "Error getting documents.", e)
    }
```


### å˜ä¸€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿

```kotlin
db.collection("users")
    .document("user123")
    .get()
    .addOnSuccessListener { document ->
        if (document.exists()) {
            val name = document.getString("name")
            val age = document.getLong("age")
            Log.d("Firestore", "Name: $name, Age: $age")
        } else {
            Log.d("Firestore", "No such document")
        }
    }.addOnFailureListener { exception ->
        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚„ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãªã©ã€å–å¾—ä¸å¯èƒ½ãªå ´åˆã§ç™ºç”Ÿ
        Log.e("Firestore", "å–å¾—æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ", exception)
    }
```


## ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤

```kotlin
db.collection("users")
    .document("user123")
    .delete()
    .addOnSuccessListener {
        Log.d("Firestore", "Document successfully deleted!")
    }
```


## ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ã¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ

ã‚µãƒ¼ãƒãƒ¼ä¸Šã®ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚ŒãŸå ´åˆã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚¢ãƒ—ãƒªã«é€šçŸ¥ãŒå±Šãã¾ã™ã€‚é€šçŸ¥ã‚’å—ã‘å–ã‚Œã‚‹ã®ã¯ã€ã‚¢ãƒ—ãƒªã®ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã—ã¦ã„ã‚‹é–“ã®ã¿ã§ã™ã€‚ã¾ãŸã€ã‚¢ãƒ—ãƒªã®ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã—ã¦ã„ã¦ã‚‚ã€ã‚¢ãƒ—ãƒªãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«ãªã£ã¦ã„ã‚‹å ´åˆã¯ã€ OS ã«ã‚ˆã£ã¦ã€åˆ¶é™ã‚’å—ã‘ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€ onStop ç­‰ã§ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«ãªã£ãŸéš›ã«ã¯ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’è§£é™¤ã™ã‚‹ã“ã¨ãŒæŽ¨å¥¨ã•ã‚Œã¾ã™ã€‚

```kotlin
val listener = db.collection("users")
    .addSnapshotListener { snapshots, e ->
        if (e != null) {
            Log.w("Firestore", "Listen failed.", e)
            return@addSnapshotListener
        }

        for (doc in snapshots!!) {
            Log.d("Firestore", "Realtime: ${doc.id} => ${doc.data}")
        }
    }

// Activity/Fragment ã® onStop ç­‰ã§ãƒªã‚¹ãƒŠãƒ¼ã‚’è§£é™¤
listener.remove()
```


### ã‚¢ãƒ—ãƒªãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å—ã‘å–ã‚ŠãŸã„å ´åˆ

ã‚‚ã—ã‚¢ãƒ—ãƒªãŒå®Œå…¨ã«ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰çŠ¶æ…‹ã§ã‚‚æ›´æ–°ã‚’å—ã‘ãŸã„ãªã‚‰ã€ä»¥ä¸‹ã®æ–¹æ³•ãŒæ¤œè¨Žã§ãã¾ã™ï¼š

- Firestore ã®æ›´æ–°ã«å¿œã˜ã¦ **Cloud Functions** ã‚’ä½¿ã£ã¦å‡¦ç†ã‚’ãƒ•ãƒƒã‚¯
- Cloud Functions ã‹ã‚‰ **FCM** ã‚’ä½¿ã£ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’é€ä¿¡
- ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã•ã‚ŒãŸã‚‰é€šçŸ¥ã‚’ã‚¿ãƒƒãƒ—ã—ã¦è©²å½“ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€


## ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ

- è‡ªå‹•åŒæœŸ
  - é–‹ç™ºè€…ã¯ã€ add(), set(), update() ãªã©ã‚’å‘¼ã¶ã ã‘ã§ã€å¾Œã¯ Firebase SDK ãŒè‡ªå‹•çš„ã«ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ã‚µãƒ¼ãƒãƒ¼ã¸åŒæœŸã—ã¦ãã‚Œã¾ã™ã€‚
- ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½
  - add(), set(), update() ã‚’å‘¼ã¶ã¨ã€å³åº§ã«ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚
  - ãã®æ™‚ç‚¹ã§ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æŽ¥ç¶šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€æŽ¥ç¶šãŒå¾©æ—§ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€è‡ªå‹•çš„ã«ã‚µãƒ¼ãƒãƒ¼ã«åæ˜ ã•ã‚Œã¾ã™ã€‚
- å³æ™‚åŒæœŸ
  - åŸºæœ¬çš„ã«ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°ã™ã‚Œã°ã€å³åº§ã«ã‚µãƒ¼ãƒãƒ¼ã¸åŒæœŸã—ã¾ã™ã€‚
  - ãŸã ã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤šã™ãŽã¨ã€ã‚µãƒ¼ãƒãƒ¼å´ã§ä¸€æ™‚çš„ã«åˆ¶é™ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
- åŒæœŸã®å®Ÿè¡Œæ¡ä»¶
  - ã‚µãƒ¼ãƒãƒ¼ã¸ã®åŒæœŸã«ã¯ã€ã‚¢ãƒ—ãƒªã®ãƒ—ãƒ­ã‚»ã‚¹ãŒèµ·å‹•ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
    - ä¾‹ãˆã°ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã«ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°ã—ã€ã‚µãƒ¼ãƒãƒ¼ã«åŒæœŸã™ã‚‹å‰ã«ã‚¢ãƒ—ãƒªãƒ—ãƒ­ã‚»ã‚¹ãŒçµ‚äº†ã—ãŸå ´åˆã¯ã€æ¬¡å›žã€ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•ã€ã‹ã¤ã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«ãªã£ãŸéš›ã«ã€ã‚µãƒ¼ãƒãƒ¼ã¸è‡ªå‹•çš„ã«åŒæœŸã•ã‚Œã¾ã™ã€‚
- å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿ã®åˆ¶é™
  - ã‚¢ãƒ—ãƒªã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®¹é‡ã«ã¯åˆ¶é™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼š40MBï¼‰ãŒã‚ã‚‹ãŸã‚ã€è†¨å¤§ãªãƒ‡ãƒ¼ã‚¿ã‚’ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§å¤‰æ›´ã™ã‚‹ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã§ã¯èª¿æ•´ãŒå¿…è¦ãªå ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚
- ãƒ‡ãƒ¼ã‚¿ã®ç«¶åˆ
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ A ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ B ã«ã‚ˆã‚Šã€ã‚µãƒ¼ãƒãƒ¼ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã«åŒæœŸãŒç™ºç”Ÿã—ãŸå ´åˆã«ã¯ã€åŸºæœ¬çš„ã«ã¯ã€Œå¾Œå‹ã¡ã€ã§ã™ã€‚
  - ç‰¹ã«ã€ set() ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå˜ä½ã§ä¸Šæ›¸ãã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€é …ç›®å˜ä½ã®æ›´æ–°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€ update() ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã‚’æ¤œè¨Žã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚µãƒ¼ãƒãƒ¼ä¸Šã®ãƒ‡ãƒ¼ã‚¿ãŒä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦æ›´æ–°ã•ã‚Œã¦ã„ãŸå ´åˆã¯ã€è‡ªåˆ†ã®æ›´æ–°ã‚’ãƒªãƒˆãƒ©ã‚¤ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚
    - è©³ç´°ã¯ã€ [ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³](#ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³) ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


### ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³

Firestore ã® ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆtransactionï¼‰ ã¯ã€è¤‡æ•°ã®èª­ã¿æ›¸ãã‚’ å®‰å…¨ã«ä¸€è²«æ€§ã‚’ä¿ã£ã¦è¡Œã† ãŸã‚ã®ä»•çµ„ã¿ã§ã™ã€‚ç‰¹ã«è¤‡æ•°äººãŒåŒã˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç·¨é›†ã™ã‚‹ã‚±ãƒ¼ã‚¹ã‚„ã€å€¤ã®æ•´åˆæ€§ãŒå¤§äº‹ãªå ´é¢ã§æ´»èºã—ã¾ã™ã€‚


#### ðŸ”¸ Firestore ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ï¼Ÿ

- ã€Œèª­ã¿å–ã‚Š â†’ å‡¦ç† â†’ æ›¸ãè¾¼ã¿ã€ã®ä¸€é€£ã®æµã‚Œã‚’ã€ä¸€ã¤ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã€ã¾ã¨ã‚ã¦å®Ÿè¡Œ
- ã™ã¹ã¦æˆåŠŸã—ãŸã¨ãã®ã¿æ›¸ãè¾¼ã¿ã‚’ç¢ºå®šï¼ˆå¤±æ•—æ™‚ã¯è‡ªå‹•ã§å†è©¦è¡Œï¼‰
- èª­ã¿å–ã£ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒé€”ä¸­ã§å¤‰æ›´ã•ã‚ŒãŸã‚‰ãƒªãƒˆãƒ©ã‚¤ã™ã‚‹ã€‚
- åŸºæœ¬ã¯ å˜ä¸€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ•´åˆæ€§ç¢ºä¿ã«æœ€é©


#### ðŸ”¸ ã‚ˆãã‚ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒã‚¤ãƒ³ãƒˆåŠ ç®—
- åœ¨åº«ã®æ•°é‡å¤‰æ›´ï¼ˆè³¼å…¥æ™‚ãªã©ï¼‰
- ã„ã„ã­ï¼ã‚«ã‚¦ãƒ³ãƒˆã®å¢—æ¸›
- èª°ã‹ãŒæ›´æ–°ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ãŸããªã„ã¨ã


#### ðŸ”¸ ã‚µãƒ³ãƒ—ãƒ«ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒã‚¤ãƒ³ãƒˆã‚’åŠ ç®—

```kotlin
val db = FirebaseFirestore.getInstance()
val docRef = db.collection("users").document("user123")

db.runTransaction { transaction ->
    // â‘  ç¾åœ¨ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—
    val snapshot = transaction.get(docRef)

    // â‘¡ å€¤ã‚’èª­ã¿å–ã‚‹
    val currentPoints = snapshot.getLong("points") ?: 0L

    // â‘¢ æ–°ã—ã„å€¤ã‚’è¨ˆç®—ã—ã¦æ›¸ãè¾¼ã¿
    transaction.update(docRef, "points", currentPoints + 10)

    // â‘£ ä»»æ„ã®çµæžœã‚’è¿”ã™ï¼ˆå¿…è¦ãªã‚‰ï¼‰
    currentPoints + 10
}.addOnSuccessListener { newPoints ->
    Log.d("Firestore", "ãƒã‚¤ãƒ³ãƒˆæ›´æ–°æˆåŠŸã€‚æ–°ã—ã„å€¤: $newPoints")
}.addOnFailureListener { e ->
    Log.w("Firestore", "ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¤±æ•—", e)
}
```

- runTransaction ãƒ–ãƒ­ãƒƒã‚¯å†…ã§ã¯ get() ã¨ update() ãŒä½¿ãˆã‚‹
- å¤±æ•—æ™‚ã¯æœ€å¤§5å›žãã‚‰ã„ã¾ã§è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ï¼ˆãŸã ã—å›žæ•°ã¯ä¿è¨¼ã•ã‚Œãªã„ï¼‰
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¿…é ˆã€‚ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã¯ä½¿ãˆãªã„
  - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ `runTransaction{}` ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€å³åº§ã« `addOnFailureListener{}` ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
- ä»–ã®äººãŒå…ˆã«ãã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å¤‰æ›´ã—ã¦ã„ãŸã‚‰ â†’ è‡ªå‹•ã§ã‚„ã‚Šç›´ã™
- set() ã‚‚ä½¿ãˆã‚‹ãŒã€ merge: true ã®ã‚ˆã†ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ä½¿ãˆãªã„ã®ã§æ³¨æ„
- é•·æ™‚é–“ã‹ã‹ã‚‹å‡¦ç†ã‚’å…¥ã‚Œã‚‹ã®ã¯é¿ã‘ã‚‹ï¼ˆå†è©¦è¡Œæ™‚ã«å•é¡Œã«ãªã‚‹ï¼‰


## æ¡ä»¶ä»˜ãã‚¯ã‚¨ãƒªï¼ˆWhereï¼‰ãƒ»é †åºæŒ‡å®šã‚¯ã‚¨ãƒªï¼ˆOrderByï¼‰

```kotlin
db.collection("users")
    .whereGreaterThan("age", 20)
    .orderBy("age")
    .get()
    .addOnSuccessListener { result ->
        for (doc in result) {
            Log.d("Firestore", "Filtered user: ${doc.id} => ${doc.data}")
        }
    }
```


## å¼•ç”¨å…ƒè³‡æ–™

- ChatGPT






