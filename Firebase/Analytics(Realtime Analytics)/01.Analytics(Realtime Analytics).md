- [Analytics（Realtime Analytics）](#analyticsrealtime-analytics)
  - [🔍 Firebase Analytics とは？](#-firebase-analytics-とは)
  - [🧱 基本構成](#-基本構成)
    - [1. 自動収集されるイベント（例）](#1-自動収集されるイベント例)
    - [2. カスタムイベントの追加](#2-カスタムイベントの追加)
  - [📊 データの確認](#-データの確認)
  - [🧠 特徴と強み](#-特徴と強み)
  - [⚠️ 注意点](#️-注意点)
  - [ユーザー属性](#ユーザー属性)
    - [自動的に収集・送信されるデータ](#自動的に収集送信されるデータ)
    - [自動的に収集・送信されないデータ](#自動的に収集送信されないデータ)
      - [カスタムユーザー属性を設定する例](#カスタムユーザー属性を設定する例)
      - [注意点](#注意点)
  - [Analytics の使用例](#analytics-の使用例)
    - [例：チュートリアル画面を表示した方が良いのか、表示しない方が良いのかを分析する](#例チュートリアル画面を表示した方が良いのか表示しない方が良いのかを分析する)
      - [課題](#課題)
      - [課題解決手段](#課題解決手段)
        - [1. Analyticsで「離脱ユーザーの特徴」を分析](#1-analyticsで離脱ユーザーの特徴を分析)
        - [2. Remote Config で「チュートリアルの表示有無」を制御](#2-remote-config-でチュートリアルの表示有無を制御)
        - [3. A/B Testing でチュートリアルの出し方を比較](#3-ab-testing-でチュートリアルの出し方を比較)
        - [4. 効果を検証し、自動でベストパターンを適用](#4-効果を検証し自動でベストパターンを適用)
  - [効果的な Analytics の使用方法](#効果的な-analytics-の使用方法)
    - [🔍 単発のイベント分析だけでなく属性と組み合わせる理由：](#-単発のイベント分析だけでなく属性と組み合わせる理由)
      - [1. ユーザーセグメントごとの行動差を把握](#1-ユーザーセグメントごとの行動差を把握)
    - [🔧 主に使う要素：](#-主に使う要素)
      - [✅ イベント（Events）](#-イベントevents)
      - [✅ ユーザー属性（User Properties）](#-ユーザー属性user-properties)
      - [✅ オーディエンス（Audiences）](#-オーディエンスaudiences)
    - [📊 結果として得られること](#-結果として得られること)
  - [どのようなイベント、ユーザー属性、オーディエンスを設定するべきか](#どのようなイベントユーザー属性オーディエンスを設定するべきか)
    - [✅ 1. イベントの例（logEvent() で送信）](#-1-イベントの例logevent-で送信)
      - [🔹 基本イベント（汎用）](#-基本イベント汎用)
      - [🔹 よく使うカスタムイベント](#-よく使うカスタムイベント)
    - [✅ 2. ユーザー属性の例（setUserProperty() で設定）](#-2-ユーザー属性の例setuserproperty-で設定)
      - [🔹 例](#-例)
      - [🔹 よく使われる属性](#-よく使われる属性)
    - [✅ 3. オーディエンスの使い方](#-3-オーディエンスの使い方)
      - [🔹 オーディエンスとは？](#-オーディエンスとは)
      - [🔹 例：オーディエンスの作成（Firebase コンソール上で行う）](#-例オーディエンスの作成firebase-コンソール上で行う)
        - [🎯 オーディエンス例1：「最近アクティブな課金ユーザー」](#-オーディエンス例1最近アクティブな課金ユーザー)
        - [🎯 オーディエンス例2：「チュートリアルを完了していないユーザー」](#-オーディエンス例2チュートリアルを完了していないユーザー)
      - [🔹 オーディエンスの活用方法](#-オーディエンスの活用方法)
      - [✍️ 補足](#️-補足)
    - [🔄 使い方まとめ](#-使い方まとめ)
  - [引用元資料](#引用元資料)


# Analytics（Realtime Analytics）

## 🔍 Firebase Analytics とは？

Firebase Analytics は、アプリ内のユーザー行動を記録・可視化する無料の分析サービスです。主に次のような情報を収集できます：

- アプリのインストールや初回起動
- ユーザーが見た画面（screen_view）
- タップや購入などのイベント（logEvent）
- ユーザー属性（国、端末、年齢層など）

これにより、アプリの利用状況を把握して改善の判断ができます。


## 🧱 基本構成

### 1. 自動収集されるイベント（例）

- first_open: 初回起動
- session_start: セッション開始
- screen_view: 画面表示
- app_update: アプリのアップデート

これらはコードを書かなくても自動で記録されます。


### 2. カスタムイベントの追加

自分でイベントを送るには以下のように記述します：

```kotlin
val analytics = Firebase.analytics
val bundle = Bundle().apply {
    putString("item_name", "ButtonA")
}
analytics.logEvent("button_click", bundle)
```


## 📊 データの確認

- Firebase コンソールの Analytics タブ
  - ユーザー数、イベント数、エンゲージメント時間などをグラフで確認できます。

- DebugView（開発中の確認に便利）
  - デバッグ端末からのイベントをリアルタイムで確認できます。 (通常、商用環境では遅延があります。) 

```bash
adb shell setprop debug.firebase.analytics.app your.package.name
```


## 🧠 特徴と強み

- ユーザーごとの属性分析が可能（例: 年齢、性別、地域など）
- BigQuery にエクスポート可能（高精度なデータ分析や機械学習にも活用できる）
  - BigQuery とは、 Google Cloud Platform の機能です。
- 他の Firebase 機能と連携
  - Remote Config や A/B Testing と組み合わせて「ユーザー行動に基づく機能出し分け」が可能


## ⚠️ 注意点

- データがコンソールに反映されるまで、数時間のラグがあることがあります（DebugViewを使えば即確認可）
- ユーザーのプライバシーに配慮して、必要な同意（GDPR, AppTrackingTransparency など）を取得しましょう


## ユーザー属性

Analytics では、ユーザーがどのような地域に住んでいるのか、どのようなデバイスを使用しているのかなど、ユーザーの属性をサーバーに送信することができます。

送信するデータには、開発者が実装しなくても自動的に収集・送信するデータと、実装しないと収集・送信できないデータがあります。


### 自動的に収集・送信されるデータ

自動的に収集・送信されるデータには、以下のものがあります。

| 属性                   | 説明                                                    |
| ---------------------- | ------------------------------------------------------- |
| 地域情報               | 国、都市、タイムゾーンなど。IPアドレスから推定。        |
| 言語                   | 端末のシステム言語設定（例: ja, en-US）                 |
| OS情報                 | OS名、バージョン（例: Android 13）                      |
| デバイス情報           | メーカー、モデル（例: Google Pixel 7）                  |
| アプリバージョン       | インストールされているアプリのバージョン番号            |
| 初回起動日             | 初めてアプリを起動した日（first_open イベントに基づく） |
| ユーザーの新規/既存    | ユーザーが新規かどうか（new or returning）              |
| 流入元（キャンペーン） | Google広告やリンククリックで来た場合の参照元情報        |
| ユーザーの収益属性     | In-App Purchase や課金イベントから自動的に推定          |

自動で収集される情報はすべて 個人を特定できない範囲に制限されていて、Google 側で匿名化・集計処理されます。
ただし地域によっては、 **（GDPR等の）ユーザーの同意の取得** が必要です。

自動収集対象データの収集方法は、様々な手段で収集されます。以下は、収集方法の例です。

| 属性             | 取得方法                              | 備考                                             |
| ---------------- | ------------------------------------- | ------------------------------------------------ |
| 地域（国、都市） | IPアドレスを元に Google が自動で判定  | 非常に高精度（手動設定不要）                     |
| 年齢、性別       | Google アカウントや利用履歴からの推定 | Googleアカウントと紐づいていない場合は不明になる |
| デバイスタイプ   | 端末のモデル情報やOSから自動取得      | 自動取得される。例: Android 12, Pixel 5          |
| 言語設定         | 端末のシステム言語から取得            | Firebase SDK によって自動取得                    |


### 自動的に収集・送信されないデータ

以下に列挙するデータは、開発者が明示的に収集・送信する必要があります。

| 属性             | 備考                                     |
| ---------------- | ---------------------------------------- |
| 性別             | 自動では取得されない                     |
| 年齢             | 自動では取得されない                     |
| 会員ランク       | 自動では取得されない（例: free/premium） |
| カスタムカテゴリ | 例：好きなジャンル、登録プランなど       |

こうした属性は、自分で収集し、 `setUserProperty()` を使用して、自分で送信する必要があります。


#### カスタムユーザー属性を設定する例

```kotlin
if (isPremiumUser) {
    Firebase.analytics.setUserProperty("user_type", "premium")
    Firebase.analytics.logEvent("premium_feature_used", null)
} else {
    Firebase.analytics.setUserProperty("user_type", "free")
}
```

ユーザー属性に応じて Remote Config のパラメータを切り替える、または、通知の配信ターゲットに使うといったことも可能です。


#### 注意点

- setUserProperty() で設定できるのは 最大25件の属性
- 各属性の値は 最大 36 文字
- 属性名には英数字とアンダースコア（_）のみ使用可能（先頭に英字推奨）
- 実際のデータ反映には数時間かかることがあります（DebugView ではすぐ確認可能）


## Analytics の使用例

### 例：チュートリアル画面を表示した方が良いのか、表示しない方が良いのかを分析する

#### 課題

初回起動ユーザーがチュートリアル画面で離脱してしまう可能性がある。


#### 課題解決手段

##### 1. Analyticsで「離脱ユーザーの特徴」を分析

例：初回起動してから1分以内にアプリを閉じるユーザーが多い


##### 2. Remote Config で「チュートリアルの表示有無」を制御

例：パラメータ show_tutorial を定義して、 true / false で表示制御

```kotlin
val showTutorial = Firebase.remoteConfig.getBoolean("show_tutorial")
if (showTutorial) {
    showTutorialScreen()
}
```


##### 3. A/B Testing でチュートリアルの出し方を比較

- パターンA：通常通りチュートリアルを表示
- パターンB：チュートリアルをスキップしてメイン画面に遷移
- 成果指標（Conversion Event）：tutorial_completed、app_retention_day2 (インストール後 2 日目にアプリを開いたか)


##### 4. 効果を検証し、自動でベストパターンを適用

A/B Testing を使用することで、より良い結果となった方を自動的に採用します。


## 効果的な Analytics の使用方法

Firebase Analytics（正式には Google Analytics for Firebase）は、単なる「ボタンが何回押されたか」のようなイベントカウントだけでなく、ユーザー属性とイベントを組み合わせて「どのようなユーザーが、どのように行動しているのか」を分析することに本領を発揮します。


### 🔍 単発のイベント分析だけでなく属性と組み合わせる理由：

#### 1. ユーザーセグメントごとの行動差を把握

たとえば：

- 「新規ユーザー」と「リピーター」で機能の使い方がどう違うか？
- 「課金ユーザー」はどの画面を頻繁に見ているか？
- 「Android ユーザー」と「iOS ユーザー」で使われている機能に差があるか？

これにより、機能改善やマーケティング施策を精密に調整できます。


### 🔧 主に使う要素：

#### ✅ イベント（Events）

- ボタンタップ、画面遷移、購入完了など。
- logEvent("purchase", bundleOf(...)) などで送信。


#### ✅ ユーザー属性（User Properties）

- 性別、年齢層、地域、アプリのインストール日など。
- 自前で定義も可能（例: "user_type": "premium"）。


#### ✅ オーディエンス（Audiences）

- 条件を満たすユーザー群を定義。
- 例: 「過去30日以内に購入し、3日以上ログインしているユーザー」。

これを使って Remote Config や通知（Firebase Cloud Messaging）とも連携できます。


### 📊 結果として得られること

- 「特定の行動をしたユーザーに向けた体験の最適化」
- 「リテンションの高い層の行動パターンから、離脱ユーザー対策を立てる」
- 「A/B テストの結果をユーザータイプごとに分析して精度を上げる」

要するに、 **イベントは"何が起こったか"、属性は"誰がやったのか"** を表すので、両方を組み合わせることで、分析も施策も「点」ではなく「線と面」で考えられるようになります。


## どのようなイベント、ユーザー属性、オーディエンスを設定するべきか

### ✅ 1. イベントの例（logEvent() で送信）

ユーザーがアプリ内で「何をしたか」を記録します。

#### 🔹 基本イベント（汎用）

```kotlin
Firebase.analytics.logEvent("button_click") {
    param("button_name", "purchase_button")
}
```

例: 購入ボタンが押された回数を分析


#### 🔹 よく使うカスタムイベント

- screen_view: 画面の表示
- tutorial_complete: チュートリアル完了
- purchase: 購入
- item_view: 商品詳細を見た
- login: ログイン完了
- level_up: ゲームのレベルアップ


### ✅ 2. ユーザー属性の例（setUserProperty() で設定）

ユーザーが「どんな人か」を記録します。これはイベントとは別に設定し、全イベントに影響します。

#### 🔹 例

```kotlin
Firebase.analytics.setUserProperty("membership_status", "premium")
Firebase.analytics.setUserProperty("favorite_category", "sports")
Firebase.analytics.setUserProperty("app_version", "1.3.2")
```


#### 🔹 よく使われる属性

- `user_type` : guest / registered / premium
- `app_language` : ja / en / fr
- `first_login_date` : YYYY-MM-DD など（文字列で工夫）
- `onboarding_status` : completed / skipped


### ✅ 3. オーディエンスの使い方

#### 🔹 オーディエンスとは？

特定の条件を満たすユーザー群を定義し、Remote Config・通知・分析・A/B テストに活用する機能です。


#### 🔹 例：オーディエンスの作成（Firebase コンソール上で行う）

##### 🎯 オーディエンス例1：「最近アクティブな課金ユーザー」

- `event` : `purchase` を過去30日以内に実行
- `user_property` : `membership_status = premium`


##### 🎯 オーディエンス例2：「チュートリアルを完了していないユーザー」

- `event` : `tutorial_complete` を含まない
- 滞在期間が 3日以上


#### 🔹 オーディエンスの活用方法

作成したオーディエンスは以下の機能で利用可能です。

- Remote Config
  - 特定のオーディエンスにだけ設定を変更
- A/B テスト
  - テスト対象のユーザー群を絞る
- Firebase Cloud Messaging
  - プッシュ通知の送信対象として使用
    - 例：30日間アプリを起動していないユーザーにのみ通知を送信する
- 分析
  - オーディエンス別にイベントの発生状況を確認


#### ✍️ 補足

- リアルタイム反映ではないため、条件に一致しても反映に最大24～48時間ほどかかることがあります。
- 条件に一致したユーザー数もコンソールでグラフ表示されます。


### 🔄 使い方まとめ

| 要素              | 役割                         | 使用例                                            |
| ----------------- | ---------------------------- | ------------------------------------------------- |
| `logEvent`        | ユーザーのアクションを記録   | 商品詳細を表示、購入完了、ログインなど            |
| `setUserProperty` | ユーザーの属性を設定         | ユーザー種別、アプリバージョン、関心カテゴリなど  |
| オーディエンス    | 特定ユーザー群をセグメント化 | A/Bテストの対象、通知送信先、RemoteConfig制御など |


## 引用元資料

- ChatGPT


