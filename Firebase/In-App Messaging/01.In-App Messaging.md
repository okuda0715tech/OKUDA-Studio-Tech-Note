- [In-App Messaging](#in-app-messaging)
  - [🔧 主な機能](#-主な機能)
  - [✅ 利用手順（概要）](#-利用手順概要)
    - [1. Firebase プロジェクトにアプリを追加](#1-firebase-プロジェクトにアプリを追加)
    - [2. 必要な SDK を追加](#2-必要な-sdk-を追加)
    - [3. Firebase Analytics を有効化](#3-firebase-analytics-を有効化)
    - [4. Firebase コンソールでメッセージを作成](#4-firebase-コンソールでメッセージを作成)
    - [5. （必要に応じて）カスタムイベントで表示をトリガー](#5-必要に応じてカスタムイベントで表示をトリガー)
  - [🎨 UI カスタマイズ（任意）](#-ui-カスタマイズ任意)
  - [🔒 注意点](#-注意点)
  - [表示遅延について](#表示遅延について)
  - [FIAM の使用に適したユースケース](#fiam-の使用に適したユースケース)
    - [1. アプリの新機能紹介](#1-アプリの新機能紹介)
    - [2. レビュー・フィードバックのお願い](#2-レビューフィードバックのお願い)
    - [3. ユーザーの離脱防止（リテンション強化）](#3-ユーザーの離脱防止リテンション強化)
    - [4. 機能への誘導（オンボーディングの強化）](#4-機能への誘導オンボーディングの強化)
    - [5. アカウント登録やログインの促し](#5-アカウント登録やログインの促し)
    - [6. サブスクリプション・課金誘導](#6-サブスクリプション課金誘導)
    - [7. 重要なメンテナンス・終了のお知らせ（非Push）](#7-重要なメンテナンス終了のお知らせ非push)
    - [👎 向いていないユースケース（参考）](#-向いていないユースケース参考)
    - [🧠 一言で言うと](#-一言で言うと)
  - [注意点](#注意点)
  - [引用元資料](#引用元資料)


# In-App Messaging

Firebase In-App Messaging（FIAM）は、アプリ内でユーザーに直接メッセージを表示できる Firebase のサービスです。プロモーションやお知らせ、ガイドメッセージなどをリアルタイムに表示したいときに役立ちます。

通常のダイアログとの違いは、プログラミングなしで、任意のタイミングで任意の内容のダイアログ等を表示できることです。

ただし、メッセージの取得は、アプリの起動時 or フォアグラウンド時にのみ行い、しかも、 Firebase SDK が不要と判断したメッセージはダウンロードしないことから、表示のタイミングが可能性もあると思われます。よって、アプリの障害情報などの緊急性の高いメッセージの表示には向きません。 Cloud Messaging と違い、アプリがフォアグラウンドになっている時にしかメッセージを表示しない点も、緊急性のあるメッセージの表示には「向いていない」と言えます。


## 🔧 主な機能

- ターゲティング
  - 特定のユーザー属性や行動（例: ある画面を開いた、イベントをトリガーした）に応じてメッセージを表示。
- カスタマイズ可能な UI
  - カード、バナー、モーダル、画像など複数の表示形式をサポート。
- A/B テスト対応
  - Firebase Remote Config や A/B Testing と連携してテスト可能。
- イベントトリガー
  - Firebase Analytics で送信されたイベントに応じてメッセージを表示。
- コードレス操作
  - 基本的にコンソール上でメッセージ作成・管理が可能（コード変更なしで運用できる）。
- ボタンで画面遷移
  - Firebase Dynamic Links に対応しており、ボタンタップで、アプリ内の特定の画面に遷移することが可能です。


## ✅ 利用手順（概要）

### 1. Firebase プロジェクトにアプリを追加

Firebase Console でアプリを設定。


### 2. 必要な SDK を追加

firebase-inappmessaging を build.gradle に追加:

```kotlin
implementation("com.google.firebase:firebase-inappmessaging-display:<最新バージョン>")
```


### 3. Firebase Analytics を有効化

FIAM は Analytics を使ってイベントトリガーするため、必須。


### 4. Firebase コンソールでメッセージを作成

表示形式、トリガー条件、ターゲットを設定。

### 5. （必要に応じて）カスタムイベントで表示をトリガー

```kotlin
Firebase.analytics.logEvent("custom_event_name", null)
```


## 🎨 UI カスタマイズ（任意）

デフォルトの UI で足りない場合は、カスタムメッセージレンダラーを実装することも可能です。ただし、やや高度な設定が必要になります。


## 🔒 注意点

- オフラインでも一度受信したメッセージは表示可能（一定期間キャッシュされる）。
- 通知ではなく「アプリ内表示」なので、ユーザーがアプリを開いているときしか表示されない。
- コンソール上でスケジュールや頻度制限も設定可能（例: 同じユーザーに何回表示するか）。


## 表示遅延について

アプリ起動時やアプリのフォアグラウンド時に、サーバー上からメッセージを取得し、ローカルにキャッシュします。キャッシュされたメッセージは、指定したアナリティクスイベントが発生すると、たとえオフラインであったとしても、メッセージは表示されます。

ローカルにダウンロードされたメッセージが存在すれば、アナリティクスインベントが発生してから、メッセージが表示されるまでの遅延はほとんどないそうです。


## FIAM の使用に適したユースケース

### 1. アプリの新機能紹介

- 例：「新しくダークモードが使えるようになりました！」
- 狙い：アップデート後の新機能をユーザーに周知

📌 特定のアプリバージョン以上をターゲットにすれば、未対応ユーザーには表示されない。


### 2. レビュー・フィードバックのお願い

- 例：「このアプリ、気に入ってますか？レビューをお願いします！」
- 狙い：アプリ評価を促してストアランキングを向上

📌 ある程度使ったユーザー（例: アプリ起動5回以上）だけに表示して質の高いレビューを得やすくなる。


### 3. ユーザーの離脱防止（リテンション強化）

- 例：「また遊びに来てくれてありがとう！今だけログインボーナス！」
- 狙い：久しぶりに戻ってきたユーザーを定着させる

📌 「最後の起動から7日以上経過したユーザー」など、条件付きで配信できる。


### 4. 機能への誘導（オンボーディングの強化）

- 例：「お気に入り機能を使って、よく使う商品をすぐに見つけましょう」
- 狙い：あまり使われていない機能への導線強化

📌 Analytics イベント（例: favorited_item 未送信ユーザー）でターゲティング可能。


### 5. アカウント登録やログインの促し

- 例：「ログインするとデータを引き継げます。今すぐログインしましょう！」
- 狙い：未ログインユーザーのコンバージョン向上

📌 匿名ユーザーを識別し、登録・ログイン済ユーザーには表示しない設定も可能。


### 6. サブスクリプション・課金誘導

- 例：「プレミアムプランなら広告非表示。今なら30日無料体験！」
- 狙い：アップセルの導線

📌 有料プランに未加入のユーザーに限定表示できる。


### 7. 重要なメンテナンス・終了のお知らせ（非Push）

- 例：「この機能は来月で終了します。詳しくはこちら」
- 狙い：Push通知の許可がないユーザーへのリーチ手段として活用

📌 Pushを受け取っていないユーザーにもメッセージが届くという点で優秀。


### 👎 向いていないユースケース（参考）

- 緊急性がある通知（例: サーバートラブル、警告）→ Push通知が適切
- ユーザーの許可が必要な処理（例: パーミッション要求）→ 通常のダイアログを使うべき


### 🧠 一言で言うと

FIAM は、「特定の条件を満たすユーザーに、タイミングよくメッセージを出したい」ときにとても便利です。しかも、アプリのアップデートなしでコントロールできるのが最大の強みです。


## 注意点

- メッセージ表示は「リアルタイム配信」ではない（事前取得 + トリガー発動）
- 同時に複数のメッセージは表示されない（1つずつのみ）
- 表示タイミングの制御は限定的（細かいカスタマイズには限界あり）
- カスタム UI はできない（プリセットスタイルのみ：バナー、モーダル、全画面、画像）


## 引用元資料

- ChatGPT



