<!-- TOC START min:1 max:3 link:true asterisk:false update:true -->
- [アプリが起動しない場合](#アプリが起動しない場合)
  - [マニフェスト内の intent-filter に autoVerify="true" が設定されているか？](#マニフェスト内の-intent-filter-に-autoverifytrue-が設定されているか)
  - [アプリを再インストールする](#アプリを再インストールする)
  - [ブラウザのキャッシュクリアを行う](#ブラウザのキャッシュクリアを行う)
  - [しばらくしてから試す](#しばらくしてから試す)
<!-- TOC END -->


# アプリが起動しない場合

Android アプリリンクから、アプリを起動しようとしても起動しない場合は、以下の項目をチェックしてみてください。


## マニフェスト内の intent-filter に autoVerify="true" が設定されているか？

以下の例のように、アプリリンクで起動したい `Activity` の `<intent-filter>` に  
`android:autoVerify="true"` が設定されていることを確認してください。

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="xxxxx">

    <application>
        <activity>
            <intent-filter android:autoVerify="true">
              <action android:name="android.intent.action.VIEW" />

              <category android:name="android.intent.category.BROWSABLE" />
              <category android:name="android.intent.category.DEFAULT" />
              <!-- 以下で始まる URL を開いた場合にアクティビティを起動する -->
              <!-- "http://restaurantseatsmanager.web.app”  -->
              <!-- "https://restaurantseatsmanager.web.app”  -->
              <!-- "http://restaurantseatsmanager.firebaseapp.com” -->
              <!-- "https://restaurantseatsmanager.firebaseapp.com” -->
              <data android:scheme="http" />
              <data android:scheme="https" />
              <data android:host="restaurantseatsmanager.web.app" />
              <data android:host="restaurantseatsmanager.firebaseapp.com" />
            </intent-filter>
        </activity>
    </application>

</manifest>
```

これは、アプリインストール時に、このインテントフィルター内の URL に対して、  
デジタルアセットリンクファイル ( assetlinks.json ) が格納されているかを確認する役割があります。

assetlinks.json の格納が確認できた場合には、その URL を開こうとしたときに、  
代わりに該当のアプリを起動するようになります。


## アプリを再インストールする

アプリリンクの仕組みを利用して、 URL からアプリを起動するには、 assetlinks.json が  
該当のサーバー ( URL ) に格納されていることを事前に確認しておく必要があります。

その確認作業は、アプリをインストールした直後に実施されるため、アプリを再インストールすることで、  
アプリリンクでアプリを起動できるようになる可能性があります。

例えば、 assetlinks.json を修正して、サーバーをデプロイした場合などは、アプリを再インストールしない限り、  
最新の  assetlinks.json を確認してくれません。


## ブラウザのキャッシュクリアを行う

キャッシュが残っていると、アプリが起動しないことがあります。

Chrome の場合は、以下の手順でキャッシュのクリアが行えます。

1. 何らかの Web ページを開く
2. 三点メニューを開く
3. 設定
4. プライバシーとセキュリティ
5. 閲覧履歴データの削除
6. データを削除
  - 「 google.com のサイトデータは重要な可能性があります。」 というメッセージが出るが、  
    削除しても現時点で特に問題は発生していない。


## しばらくしてから試す

Firebase Hosting に、 `assetlinks.json` を配置 (デプロイ) しても、すぐには反映されないことがあります。  

以前、夜の 9 時ごろにデプロイして、その後 30 分くらいは、更新内容が反映されていませんでした。  
(もちろん、 Chrome のキャッシュクリアを行ってから試しましたが、 30 分以内では更新されていませんでした。)

翌日の昼の 12 時ごろに、再度 Chrome のキャッシュクリアを行ってから試したところ、  
無事に、アプリリンクからアプリを起動することができました。
