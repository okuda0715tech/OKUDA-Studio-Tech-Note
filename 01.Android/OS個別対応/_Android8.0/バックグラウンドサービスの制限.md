<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [バックグラウンドサービスの制限](#制限)
	- [フォアグラウンドサービスの起動方法の変更](#起動方法変更)

<!-- /TOC -->


# バックグラウンドサービスの制限

## バックグランドの定義

「バックグラウンドである」、「フォアグラウンドである」とみなされる対象は「アプリ」である場合と「サービス」である場合が存在します。  
文脈上、どちらのことを指しているのか区別する必要があります。

サービス制限の目的におけるバックグラウンドの定義は、メモリ管理で使用される定義とは異なります。  
メモリ管理においてはバックグラウンドに存在するが、サービス制限においてはフォアグラウンドに存在する場合があります。

以下の場合は、メモリ管理、サービス制限のいずれにおいてもフォアグランドであるとみなされます。

- 可視アクティビティがある（アクティビティが開始されているか一時停止されているかに関係なく）。
- フォアグラウンド サービスを使用している。

以下の場合は、メモリ管理においてはバックグラウンド、サービス制限においてはフォアグラウンドとみなされます。

- 別のフォアグラウンド アプリが、該当アプリのいずれかのサービスにバインドされるか、該当アプリのいずれかのコンテンツ プロバイダを使用することで、該当アプリに接続している。 たとえば、別のアプリが次のいずれかのサービスにバインドされる場合です。
  - IME
  - 壁紙サービス
  - 通知リスナー
  - 音声またはテキスト サービス


## フォアグラウンドサービスの起動方法の変更

Android8未満

- バックグラウンドアプリからバックグラウンドサービスを起動する。
- バックグラウンドサービスをフォアグラウンドサービスに昇格させる。

Android8以降

- バックグラウンドアプリからバックグラウンドサービスを起動できない
- `startForegroundService()`メソッドでフォアグラウンドサービスを起動する
- `startForegroundService()`メソッドでサービスが作成され後、アプリは、サービスの startForeground() メソッドを 5 秒以内に呼び出して、その新しいサービスの通知をユーザーに表示します。
- 5秒以内に呼び出されない場合は、システムによってサービスが停止され、アプリが ANR になります。
