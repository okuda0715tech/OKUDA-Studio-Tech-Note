<!-- TOC START min:1 max:3 link:true asterisk:false update:true -->
- [クラッシュ_ANRのレポート](#クラッシュ_anrのレポート)
  - [2 種類のレポート確認方法](#2-種類のレポート確認方法)
  - [Google Play Console を介したレポート](#google-play-console-を介したレポート)
    - [レポートを出力する](#レポートを出力する)
    - [レポートを確認する](#レポートを確認する)
  - [Firebase Crashlytics を介したレポート](#firebase-crashlytics-を介したレポート)
<!-- TOC END -->


# クラッシュ_ANRのレポート

## 2 種類のレポート確認方法

アプリのエラーログをユーザから取得する方法は、 2 種類存在します。  
一つは、 Google Play Console で確認する方法です。  
もう一つは、 Firebase Crashlytics で確認する方法です。

Google Play Console の場合は、設定不要で簡単にエラーログを確認することができる一方で、  
確認方法がスタックトレースのみであるため、確認に時間がかかります。

Firebase Crashlytics の場合は、多少の設定が必要ですが、エラーを重要度別に分類してくれたり、  
エラーの状況をグラフで表示してくれたりと、リッチな UI が特徴です。


## Google Play Console を介したレポート

アプリで発生したクラッシュと ANR ( Application Not Responding ) は、 Google Play Console を介して、  
開発者が該当エラーのスタックトレースを確認することができます。  
( ANR もエラーに含まれます。)


### レポートを出力する

この Play Console を介した方法では、アプリが難読化されている場合は、難読化を解除する必要があります。  
難読化されていない場合は、開発者は何も準備する必要はありません。

また、ユーザ側がアプリで発生したエラーログの共有設定を行っている必要があります。


#### アプリが Android App Bundle 形式でリリースされている場合

難読化を解除するために、次の keep ルールをモジュールの `proguard-rules.pro` ファイルに追加してください。  

```
-keepattributes LineNumberTable,SourceFile
```

これによって、難読化を解除 (シンボリケート) した状態でログが表示されます。  
AAB 内に難読化で使用したマッピングファイルが含まれているため、別途マッピングファイルを  
アップロードする必要はなく、 Google のサーバ側で難読化を解除してくれています。

【参考】マッピングファイルが生成される場所は以下になります。  
```
{プロジェクトディレクトリ}/app/build/outputs/mapping[/{フレーバー名}]/{ビルドタイプ}/mapping.txt
```


#### ユーザがエラーログの共有設定を行う

ユーザがアプリログを Google に共有 (送信) する設定を行っていれば、自動的にスタックトレースが  
Google に送信され、開発者は Play Console で、そのエラーログを確認することができます。

ログを Google に共有するには、ユーザは以下の設定を行います。

```
設定アプリ -> Google -> 三点メニュー -> 使用状況と診断情報 -> ON にする
```

似たような設定に 「ウェブとアプリのアクティビティ」 という設定がありますが、こちらは関係ありません。  
こちらは、デバイス上でユーザがウェブ検索やアプリ起動を行った場合に、  
「どのような検索ワードで検索を行ったのか」 や 「アプリをいつ起動したか」 程度の情報しか共有しません。  
これらの情報は、 Google が検索時により適切なウェブページやアプリを検索結果として返すために使用されます。  
なお、この設定画面は以下に存在しています。

```
設定アプリ -> Google -> Google アカウントの管理 -> 「データとプライバシー」タグ
-> 履歴の設定 -> ウェブとアプリのアクティビティ
```


### レポートを確認する

```
品質 -> Android Vitals -> クラッシュと ANR
```

最大で、過去 2 or 6 ヶ月のレポートを確認することができます。  
(サイトによって 2 ヶ月だったり、 6 ヶ月だったので正確な期間は不明。)


## Firebase Crashlytics を介したレポート

Android では、以前はクラッシュレポートツールとして Firebase Crash Reporting を提供しており、  
古いウェブページでは、 Android の公式ページでも、まだこの名前が残っています。  
しかし、今は非推奨となっています。代わりに Crashlytics 社のシステムをベースにした  
Firebase Crashlytics が推奨となっています。
