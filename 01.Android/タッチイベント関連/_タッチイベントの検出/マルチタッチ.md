<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [マルチタッチ](#)
	- [タッチポイントの管理方法（概要）](#管理方法概要)
	- [IDについて](#id)
	- [INDEXについて](#index)
	- [実装パターン](#実装)

<!-- /TOC -->


# マルチタッチ

## タッチポイントの管理方法（概要）

マルチタッチでは、複数のタッチポイントを管理するために、IDとINDEXが使用されます。

## IDについて

- 概要
  - IDとは、複数の指が画面に触れている時に、指を一意に特定するための識別子である。
- 有効期間
	- 指が画面に触れてから、画面から離れる、もしくは、ジェスチャーがキャンセルされた時まで（その間にIDの値は変更されません）。
	- `ACTION_DOWN`/`ACTION_POINTER_DOWN`から`ACTION_UP`/`ACTION_POINTER_UP`もしくは`ACTION_CANCEL`まで。
- 取得方法
  - `MotionEvent.getPointerId(int pointerIndex);`
- 用途
  - マルチタッチ状況下で、それぞれのタッチポイントを識別するのに使用する。


## INDEXについて

- 概要
  - 複数の指が画面に触れている時に、システムはそれらを一つのリストで管理している。
  - そのリストの要素一つ一つが一つのタッチポイントを示している。
  - INDEXは、そのリストの要素番号にあたるものである。（0 から size - 1 までの整数が割り当てられる。）
  - IDはそのリストの要素にあたると考えて、だいたいOK。
- 有効期間
  - いつでも変更される可能性があるため、実質的に定義不可。
    - 例えば、以下のようなことが起こる（以下の例は概略の話なので、これを踏まえたコーディングはしないこと！）
      - 指Aをタップしたとき、AのINDEX=0となる。
      - その後、指Bをタップしたとき、BのINDEX=1となる。
      - その後、Aを画面から離すと、BのINDEX=0となる。
- 取得方法
  - ”今”受信したイベントのINDEXを取得したい場合
  	- `MotionEvent.getActionIndex()`
  - ”過去に”受信したイベントの"今"のINDEXを取得したい場合
    - `findPointerIndex(int pointerId)`
    - 事前にIDを保存しておく必要あり。
  - （ここで言う「受信」とは、`onTouchEvent`や`onTouch`コールバックが呼ばれることを示す。）
- 用途
  - タッチポイントの座標などのデータを取得する場合にパラメータとして使用する。（IDではデータを取得することはできない。）


## 実装パターン

```Java
@Override
public boolean onTouchEvent(MotionEvent event) {
	int eventAction = event.getActionMasked();
	int pointerIndex = event.getActionIndex();
	// IDの取得
	int pointerId = event.getPointerId(pointerIndex);

	switch(eventAction){
		case MotionEvent.ACTION_DOWN:
			// do something.
			// ここでIDをActivityのフィールド等に保存することが多い
			break;
		case MotionEvent.ACTION_POINTER_DOWN:
			// ここでIDをActivityのフィールド等に保存することが多い
			break;
		case MotionEvent.ACTION_POINTER_UP:
			// ここでActivityのフィールド等に保存しているIDを解放することが多い
			break;
		case MotionEvent.ACTION_CANCEL:
		case MotionEvent.ACTION_UP:
			// ここでActivityのフィールド等に保存しているIDを解放することが多い
			break;
		case MotionEvent.ACTION_MOVE:
			break;

		...

		default:
			// do something.
			break;
	}
}
```
