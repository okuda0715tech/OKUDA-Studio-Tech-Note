- [03.Matcher API の使用](#03matcher-api-の使用)
  - [CoreMatcher が提供する Matcher](#corematcher-が提供する-matcher)
    - [is](#is)
      - [使用方法](#使用方法)
      - [null 値の比較を行いたい場合](#null-値の比較を行いたい場合)
      - [メソッドチェーン](#メソッドチェーン)
    - [nullValue](#nullvalue)
    - [not](#not)
    - [notNullValue](#notnullvalue)
    - [sameInstance](#sameinstance)
    - [instanceOf](#instanceof)
  - [JUnitMatchers が提供する Matcher](#junitmatchers-が提供する-matcher)
    - [hasItem](#hasitem)
    - [hasItems](#hasitems)
  - [その他 Hamcrest が提供する Matcher](#その他-hamcrest-が提供する-matcher)


# 03.Matcher API の使用

Matcher API を使用する際は、以下のいずれか、または、両方のクラスをインポートします。

- org.hamcrest.CoreMatchers
- org.junit.matchers.JUnitMatchers

Matcher API を import する際は、以下の 2 点を考慮すると良いです。

- static インポートをする。
- 個々のメソッドをインポートするのではなく、ワイルドカードでクラスごとインポートする。


## CoreMatcher が提供する Matcher

よく使用するメソッドを紹介します。


### is

#### 使用方法

オブジェクトの equals() メソッドを使用した比較を行います。

```java
assertThat(actual, is(expected));
```


#### null 値の比較を行いたい場合

is() メソッドは、引数に型パラメータを受け取るため、引数に null を渡すとコンパイルエラーとなります。 null を渡したい場合には、後述の `nullValue` メソッドを使用してください。


#### メソッドチェーン

is() メソッドには、引数に Matcher 型を受け取るオーバーロードメソッドが存在します。そのため、メソッドチェーンが可能です。

```java
assertThat(actual, is(not(expected)));
```

not() メソッドの使用方法については、後述します。


### nullValue

nullValue メソッドは、単体で使用することもできますが、多くの場合は、 is() メソッドと組み合わせて使用されます。

以下の例は、実行結果が null である場合に、テストが成功したとみなされます。

```java
assertThat(actual, is(nullValue()));
```


### not

not メソッドは、 nullValue() メソッドと同様に、 is() メソッドと組み合わせて使用されます。

以下の例は、実行結果が 0 ではない場合に、テストが成功したとみなされます。

```java
assertThat(actual, is(not(0)));
```


### notNullValue

以下の例は、実行結果が null ではない場合に、テストが成功したとみなされます。

```java
assertThat(actual, is(notNullValue()));
```

上記の実装は、下記の実装と同じ結果となります。

```java
assertThat(actual, is(not(nullValue())));
```


### sameInstance

sameInstance() メソッドは、期待値と実測値が同じインスタンスを示している場合に、テストが成功したとみなします。つまり、 Java の `==` 演算子、 Kotlin の `===` 演算子と同じです。

```java
assertThat(actual, is(sameInstance(expected)));
```

プリミティブ型の値を検証する場合には、注意が必要です。プリミティブ型を比較する場合は、ラッパー型にボクシングされてから比較が行われます。意図せず、別のインスタンスになる可能性があります。そのため、プリミティブ型を検証するのは避けたほうがよさそうです。

Kotlin のプリミティブ型については、 [参照型とプリミティブ型](../../../../../../Kotlin/型_変数_値/基本(プリミティブ)型/数値/型/参照型とプリミティブ型.md) を参照してください。

プリミティブ型の値を検証したい場合には、 `equalTo()` メソッドを使用してください。

equalTo() メソッドは、内部で、 `.equals()` メソッドを使用して値を比較してくれるため、問題なく値の一致判定が行えます。

`comparesEqualTo()` メソッドでも、数値の比較は行えます。こちらは、 `Comparable` インターフェースを使用した比較を行います。 Comparable インターフェースは、単なる一致判定ではなく、値の大小比較を行うためのインターフェースです。そのため、処理に多少のオーバーヘッドが発生するため、通常は、 `equalTo()` メソッドでの検証が良いでしょう。 ( compareXxx ではなく、 comparesXxx であることに注意してください。)


### instanceOf

instanceOf() メソッドは、実測値の型が、期待値の型と互換性があれば、テストが成功したとみなします。つまり、期待値の型と同じ型、もしくは、サブタイプなら成功したとみなします。

以下の例は、 actual の型が、 Serializable 型か、もしくは、そのサブタイプの場合に、テストが成功します。

```java
assertThat(actual, is(instanceOf(Serializable.class)));
```

なお、実測値が null の場合には、失敗となります。


## JUnitMatchers が提供する Matcher

よく使用するメソッドを紹介します。


### hasItem

hasItem() メソッドは、リストや配列などの反復可能なオブジェクトに、期待する値が含まれていれば、テストが成功したとみなします。

```java
List<String> actual = sut.getList();
assertThat(actual, hasItem("World"));
```


### hasItems

hasItems() メソッドは、リストや配列などの反復可能なオブジェクトに、期待する "すべて" の値が含まれていれば、テストが成功したとみなします。

```java
List<String> actual = sut.getList();
assertThat(actual, hasItems("Hello", "World"));
```


## その他 Hamcrest が提供する Matcher

hamcrest-liblary で提供されている Matcher の一部を紹介します。

| クラス名                                     | メソッド名           | 検証内容                                              |
| -------------------------------------------- | -------------------- | ----------------------------------------------------- |
| org.hamcrest.collection.IsEmptyCollection    | empty                | 空の Collection であること                            |
| org.hamcrest.collection.IsCollectionWithSize | hasSize              | Collection が期待するサイズであること                 |
| org.hamcrest.collection.IsMapContaining      | hasEntry             | Map が指定した Key と Value を持つこと                |
| org.hamcrest.collection.IsMapContaining      | hasKey               | Map が指定した Key を持つこと                         |
| org.hamcrest.collection.IsMapContaining      | hasValue             | Map が指定した Value を持つこと                       |
| org.hamcrest.number.OrderingComparison       | comparesEqualTo      | 比較して同じ数値であること                            |
| org.hamcrest.number.OrderingComparison       | greaterThan          | 比較して期待値より大きいこと (算術演算の `>` に相当)  |
| org.hamcrest.number.OrderingComparison       | greaterThanOrEqualTo | 比較して期待値以上であること (算術演算の `>=` に相当) |
| org.hamcrest.number.OrderingComparison       | lessThan             | 比較して期待値より小さいこと (算術演算の `<` に相当)  |
| org.hamcrest.number.OrderingComparison       | lessThanOrEqualTo    | 比較して期待値以下であること (算術演算の `<=` に相当) |
| org.hamcrest.number.IsCloseTo                | closeTo              | 比較して期待値の範囲の数値であること                  |
| org.hamcrest.text.IsEmptyString              | isEmptyString        | 文字列が空文字であること                              |
| org.hamcrest.text.IsEmptyString              | isEmptyOrNullString  | 文字列が空文字、または、 null であること              |
| org.hamcrest.text.IsEqualIgnoringCase        | equalToIgnoringCase  | 大文字小文字を無視して文字列が一致すること            |
| org.hamcrest.beans.SamePropertyValuesAs      | samePropertyValuesAs | Bean のプロパティがそれぞれ一致すること               |








