- [04.RuleChain によるルールの連鎖](#04rulechain-によるルールの連鎖)
  - [RuleChain の基本的な使い方](#rulechain-の基本的な使い方)
  - [例 : RuleChain を使ったルールの適用](#例--rulechain-を使ったルールの適用)
  - [実行結果](#実行結果)
  - [RuleChain の動作](#rulechain-の動作)


# 04.RuleChain によるルールの連鎖

本書の説明がわかりづらかったため、 ChatGPT の情報を引用して説明を記載します。

RuleChain は、 JUnit で複数のルール ( `@Rule` または `@ClassRule` ) を順番に適用するために使用されるクラスです。これにより、ルールの適用順序を明示的に指定でき、特定のルールを他のルールの前または後に実行することができます。


## RuleChain の基本的な使い方

JUnit 4 では、@Rule を使ってテストルールを適用できますが、複数のルールがある場合、実行順序を制御するのが難しくなります。そのため、 RuleChain を使うと、ルールの適用順序を明示的に制御できます。


## 例 : RuleChain を使ったルールの適用

```java
import org.junit.Rule;
import org.junit.Test;
import org.junit.rules.ExternalResource;
import org.junit.rules.RuleChain;
import org.junit.rules.TestRule;

public class RuleChainExampleTest {
    
    private ExternalResource rule1 = new ExternalResource() {
        @Override
        protected void before() {
            System.out.println("Rule 1: before");
        }
        @Override
        protected void after() {
            System.out.println("Rule 1: after");
        }
    };

    private ExternalResource rule2 = new ExternalResource() {
        @Override
        protected void before() {
            System.out.println("Rule 2: before");
        }
        @Override
        protected void after() {
            System.out.println("Rule 2: after");
        }
    };

    @Rule
    public TestRule ruleChain = RuleChain
        .outerRule(rule1) // 最初に実行されるルール
        .around(rule2);   // rule1 の後に実行されるルール

    @Test
    public void testMethod() {
        System.out.println("Executing test method");
    }
}
```


## 実行結果

```
Rule 1: before
Rule 2: before
Executing test method
Rule 2: after
Rule 1: after
```


## RuleChain の動作

1. outerRule(rule1) の before メソッドが実行される
2. around(rule2) の before メソッドが実行される
3. テスト実行 ( testMethod() )
4. around(rule2) の after メソッドが実行される
5. outerRule(rule1) の after メソッドが実行される

つまり、行は正順で実行され、帰りは逆順で実行されます。






