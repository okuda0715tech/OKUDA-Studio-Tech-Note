<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [コンバーター](#コンバーター)
	- [IntやStringなどの基本型以外の型を列として定義する](#intやstringなどの基本型以外の型を列として定義する)
		- [補足](#補足)

<!-- /TOC -->


# コンバーター

## IntやStringなどの基本型以外の型を列として定義する

Roomでは、IntやStringなどの基本的な型しかEntityのフィールドとして定義できません。  
（追記）Enumも定義できるようです。DB内部ではTEXT型として扱われます。

Date型など、その他の型を使用したい場合は、変換クラスを作成し、それらのクラスと基本型の双方向の変換メソッドを実装します。

こうすることで、Date型なども変換後の基本型としてDBに格納することができるため、EntityのフィールドにもDate型などを定義できるようになります。


**Converters.java**

```Java
public class Converters {
		@TypeConverter
		public static Date fromTimestamp(Long value) {
				return value == null ? null : new Date(value);
		}

		@TypeConverter
		public static Long dateToTimestamp(Date date) {
				return date == null ? null : date.getTime();
		}
}
```


**AppDatabase.java**

```java
@Database(entities = {User.class}, version = 1)
@TypeConverters({Converters.class})
public abstract class AppDatabase extends RoomDatabase {
		public abstract UserDao userDao();
}
```


**User.java**

```java
@Entity
public class User {
		private Date birthday;
}
```


**UserDao.java**

```Java
@Dao
public interface UserDao {
		@Query("SELECT * FROM user WHERE birthday BETWEEN :from AND :to")
		List<User> findUsersBornBetweenDates(Date from, Date to);
}
```


### 補足

`@TypeConverters`アノテーションは、それを定義する場所によって、コンバーターの有効なスコープを管理することができます。

- データベースに配置すると、そのデータベース内のすべてのDaosとエンティティがそれを使用できるようになります。
- Daoに配置すると、Daoのすべてのメソッドで使用できます。
- エンティティに配置すると、エンティティのすべてのフィールドで使用できます。
- POJOに配置すると、POJOのすべてのフィールドで使用できます。
- Entityフィールドに配置すると、そのフィールドのみが使用できます。
- Daoメソッドに配置すると、メソッドのすべてのパラメーターでそれを使用できます。
- Daoメソッドのパラメーターに配置すると、そのフィールドだけで使用できます。
