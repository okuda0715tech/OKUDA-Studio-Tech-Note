<!-- TOC START min:1 max:3 link:true asterisk:false update:true -->
- [逆コンパイル](#逆コンパイル)
  - [大まかな手順](#大まかな手順)
  - [1. apk ファイルから dex ファイルを取り出す](#1-apk-ファイルから-dex-ファイルを取り出す)
  - [2. dex ファイルを jar ファイルに変換する](#2-dex-ファイルを-jar-ファイルに変換する)
    - [コマンド実行例](#コマンド実行例)
    - [出力](#出力)
  - [3. jarファイル から class ファイル 取り出す](#3-jarファイル-から-class-ファイル-取り出す)
  - [4. classファイルを java ファイルに変換する](#4-classファイルを-java-ファイルに変換する)
<!-- TOC END -->


# 逆コンパイル

## 大まかな手順

1. apk ファイルから dex ファイルを取り出す
2. dex ファイルを jar ファイルに変換する
3. jarファイル から class ファイル 取り出す
4. classファイルを java ファイルに変換する

この資料では、 APK から逆コンパイルする手順を記載しています。
Android App Bundle ( AAB ) から逆コンパイルする場合は、 AAB から一度 APK を生成してから、  
この手順を実行します。

AAB から APK を生成するには、 `bundletool` を使用する方法があります。 `bundletool` に関しては、  
[ [こちら](https://developer.android.com/studio/command-line/bundletool) ] を参照してください。


## 1. apk ファイルから dex ファイルを取り出す

apk ファイルの実体は zip ファイルであるため、解凍すれば、 apk ファイルを取り出すことができます。

apk ファイルを右クリックし、メニューから 「解凍」 で解凍を行います。

そうすると、 apk ファイルのファイル名と同じ名前のフォルダが作成され、その中に  
`classes.dex` ファイルが生成されています。


## 2. dex ファイルを jar ファイルに変換する

dex ファイルを jar ファイルに変換するには、 `dex2jar` というツールを使用します。

私の PC では、以下のフォルダにツールが置いてあります。  
`(前略)\デスクトップ\CLaunch\ツール\dex2jar-2.0`  
上記のフォルダ内に `d2j-dex2jar.bat` というファイルがあり、これをコマンドプロンプトから実行します。

### コマンド実行例

```
// フォーマット
d2j-dex2jar.bat <パス>\classes.dex
// 例
C:\Users>E:\(中略)\d2j-dex2jar.bat E:\(中略)\classes.dex
```

### 出力

jar ファイルは、コマンドを実行した時のカレントディレクトリに作成されます。  
出力ファイル名は、 `classes-dex2jar.jar` です。

同じフォルダ内に `classes-error.zip` というエラーファイルが出力されましたが、  
最終的に java ファイルを復元できていたようなので、今のところこのエラーは無視しています。


## 3. jarファイル から class ファイル 取り出す

jar ファイルの実体は zip ファイルであるため、解凍すれば、 class ファイルを取り出すことができます。

jar ファイルを右クリックし、メニューから 「解凍」 で解凍を行います。


## 4. classファイルを java ファイルに変換する

class ファイルを java ファイルに変換するには、 `Java Decompiler` というツールを使用します。

私の PC では、以下のフォルダにツールが置いてあります。  
`(前略)\デスクトップ\CLaunch\ツール\jd-gui-windows-1.6.6`

使い方は簡単で、 `jd-gui.exe` というファイルをダブルクリックで実行して、 class ファイルを  
どれか一つツール内にドロップすれば、すべての class ファイルを java ファイルに変換してくれます。  
私が実際に操作したときは、 classes-dex2jar フォルダ配下のすべての class ファイルを変換してくれました。
