- [Compose 内のテーマの構造](#compose-内のテーマの構造)
  - [テーマシステムのクラス](#テーマシステムのクラス)
  - [テーマのシステムのコンポジションローカル](#テーマのシステムのコンポジションローカル)
  - [テーマの関数](#テーマの関数)
  - [テーマのオブジェクト](#テーマのオブジェクト)


# Compose 内のテーマの構造

Jetpack Compose のテーマは、いくつかの低レベル構造と関連 API で構成されています。これらは MaterialTheme の [ソースコード](https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:compose/material3/material3/src/commonMain/kotlin/androidx/compose/material3/MaterialTheme.kt) で確認でき、カスタム デザイン システムにも適用できます。


## テーマシステムのクラス

テーマは通常、共通の視覚的および動作的概念をグループ化する多数のサブシステムで構成されます。これらのシステムは、テーマ値を持つクラスを使用してモデル化できます。

たとえば、MaterialTheme には、 [ColorScheme](https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:compose/material3/material3/src/commonMain/kotlin/androidx/compose/material3/ColorScheme.kt) (カラー システム)、 [Typography](https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:compose/material3/material3/src/commonMain/kotlin/androidx/compose/material3/Typography.kt) (タイポグラフィ システム)、および [Shapes](https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:compose/material3/material3/src/commonMain/kotlin/androidx/compose/material3/Shapes.kt) (シェイプ システム) が含まれます。

注: クラスには、Compose コンパイラーに情報を提供するため、 [Stable](https://developer.android.com/reference/kotlin/androidx/compose/runtime/Stable?_gl=1*8sipag*_up*MQ..*_ga*MTUwODg0NTA4NS4xNzI2MTIyODUy*_ga_6HH9YJMN9M*MTcyNjEyMjg1MS4xLjAuMTcyNjEyMjg1MS4wLjAuMTEzMTg1Mzc1OQ..) または [@Immutable](https://developer.android.com/reference/kotlin/androidx/compose/runtime/Immutable?_gl=1*8sipag*_up*MQ..*_ga*MTUwODg0NTA4NS4xNzI2MTIyODUy*_ga_6HH9YJMN9M*MTcyNjEyMjg1MS4xLjAuMTcyNjEyMjg1MS4wLjAuMTEzMTg1Mzc1OQ..) でアノテーションを付ける必要があります。詳細については、 [コンポーザブルのライフサイクルガイド](https://developer.android.com/develop/ui/compose/lifecycle?_gl=1*8sipag*_up*MQ..*_ga*MTUwODg0NTA4NS4xNzI2MTIyODUy*_ga_6HH9YJMN9M*MTcyNjEyMjg1MS4xLjAuMTcyNjEyMjg1MS4wLjAuMTEzMTg1Mzc1OQ..#skipping) をご覧ください。

```kotlin
@Immutable
data class ColorSystem(
    val color: Color,
    val gradient: List<Color>
    /* ... */
)

@Immutable
data class TypographySystem(
    val fontFamily: FontFamily,
    val textStyle: TextStyle
)
/* ... */

@Immutable
data class CustomSystem(
    val value1: Int,
    val value2: String
    /* ... */
)

/* ... */
```

## テーマのシステムのコンポジションローカル

テーマ システム クラスは、CompositionLocal インスタンスとしてコンポジション ツリーに暗黙的に提供されます。これにより、テーマ値をコンポーズ可能な関数で静的に参照できます。

CompositionLocal の詳細については、「 [CompositionLocal を使用したローカル スコープのデータ](https://developer.android.com/develop/ui/compose/compositionlocal?_gl=1*16micy2*_up*MQ..*_ga*MTUwODg0NTA4NS4xNzI2MTIyODUy*_ga_6HH9YJMN9M*MTcyNjEyMjg1MS4xLjAuMTcyNjEyMjg1MS4wLjAuMTEzMTg1Mzc1OQ..) 」ガイドをご覧ください。

注: クラスの CompositionLocal は、compositionLocalOf または staticCompositionLocalOf を使用して作成できます。これらの関数には、提供しているのと同じ型のフォールバック値を提供する defaultFactory (末尾のラムダ) があります。Color.Unspecified、TextStyle.Default などの適切なデフォルトを使用することをお勧めします。

```kotlin
val LocalColorSystem = staticCompositionLocalOf {
    // デフォルト値
    ColorSystem(
        color = Color.Unspecified,
        gradient = emptyList()
    )
}

val LocalTypographySystem = staticCompositionLocalOf {
    // デフォルト値
    TypographySystem(
        fontFamily = FontFamily.Default,
        textStyle = TextStyle.Default
    )
}

val LocalCustomSystem = staticCompositionLocalOf {
    // デフォルト値
    CustomSystem(
        value1 = 0,
        value2 = ""
    )
}

/* ... */
```


## テーマの関数

theme 関数はエントリ ポイントであり、主要な API です。テーマ システム CompositionLocals のインスタンスを構築します (実際の値と必要なロジックを使用)。このインスタンスは、 [CompositionLocalProvider](https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary?_gl=1*1wldcaf*_up*MQ..*_ga*MTUwODg0NTA4NS4xNzI2MTIyODUy*_ga_6HH9YJMN9M*MTcyNjEyMjg1MS4xLjAuMTcyNjEyMjg1MS4wLjAuMTEzMTg1Mzc1OQ..#compositionlocalprovider) でコンポジション ツリーに提供されます。content パラメータを使用すると、ネストされたコンポーザブルは、それより下の階層では、テーマ値にアク​​セスできます。

```kotlin
@Composable
fun Theme(
    // この content コンポーザブル配下のコンポーザブル関数には、
    // この Theme が適用されます。
    content: @Composable () -> Unit
) {
    val colorSystem = ColorSystem(
        color = Color(0xFF3DDC84),
        gradient = listOf(Color.White, Color(0xFFD7EFFF))
    )
    val typographySystem = TypographySystem(
        fontFamily = FontFamily.Monospace,
        textStyle = TextStyle(fontSize = 18.sp)
    )
    val customSystem = CustomSystem(
        value1 = 1000,
        value2 = "Custom system"
    )
    /* ... */
    CompositionLocalProvider(
        LocalColorSystem provides colorSystem,
        LocalTypographySystem provides typographySystem,
        LocalCustomSystem provides customSystem,
        /* ... */
        content = content
    )
}
```


## テーマのオブジェクト

テーマ システムへのアクセスは、便利なプロパティを持つオブジェクトを使用して行われます。一貫性を保つために、オブジェクトの名前はテーマ関数と同じになる傾向があります。プロパティは、現在の構成をローカルに取得するだけです。

```kotlin
// 例えば、 Theme.colorSystem.color のようにしてテーマカラーにアクセスできます。
object Theme {
    val colorSystem: ColorSystem
        @Composable
        get() = LocalColorSystem.current
    val typographySystem: TypographySystem
        @Composable
        get() = LocalTypographySystem.current
    val customSystem: CustomSystem
        @Composable
        get() = LocalCustomSystem.current
    /* ... */
}
```

