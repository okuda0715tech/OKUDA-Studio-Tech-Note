- [Android でのテスト項目](#android-でのテスト項目)
  - [テストディレクトリの編成](#テストディレクトリの編成)
  - [単体テスト](#単体テスト)
    - [エッジケースのテスト](#エッジケースのテスト)
    - [避けるべき単体テスト](#避けるべき単体テスト)
  - [UI テスト](#ui-テスト)
  - [その他のテスト](#その他のテスト)
  - [参考資料](#参考資料)


# Android でのテスト項目

テストすべき内容は、アプリのタイプ、開発チーム、レガシーコードの量、使用されているアーキテクチャなどの要因によって異なります。以下のセクションでは、初心者がアプリでのテストを計画する際に考慮すべき点を概説します。


## テストディレクトリの編成

Android Studio の一般的なプロジェクトには、実行環境に応じてテストを保持する 2 つのディレクトリがあります。次のように、テストを次のディレクトリに整理します。

- `androidTest` ディレクトリには、実際のデバイス、または、仮想デバイスで実行するテストを含める必要があります。このようなテストには、統合テストやエンドツーエンド テストのほか、JVM だけではアプリの機能を検証できないテストが含まれます。
- `test` ディレクトリには、ローカルマシンで実行するテスト（単体テストなど）を格納する必要があります。上記とは対照的に、これらはローカル JVM で実行するテストです。


## 単体テスト

ベストプラクティスに従う場合は、次のような場合に単体テストを使用してください。

- **ViewModel** (プレゼンター) の単体テスト。
- **データレイヤ**（特にリポジトリ）の単体テスト。データレイヤーのほとんどは、プラットフォームに依存しないものにする必要があります。これにより、テストダブルで、テストのデータベース モジュールとリモート データソースを置き換えることができます。 [Android でテストダブルを使用する方法](./3.Android%20でテストダブルを使用する.md) についてのガイドをご覧ください。
- **ドメインレイヤ** など、他のプラットフォームに依存しないレイヤの単体テスト（ユースケースやインタラクタ (※ 1 ) など）。
  - (※ 1 ) ユースケースとインタラクタは、ほぼ同じ意味ですが、ユースケースが概念であるのに対して、その具体的な実装をインタラクタと呼びます。
- 文字列操作や数学などの **ユーティリティクラス** の単体テスト。


### エッジケースのテスト

ここでいうエッジケースとは、境界値テストのことではなく、異常系のことを示します。

単体テストは、通常ケースとエッジケースの両方に焦点を当てる必要があります。エッジケースは、人間のテスターや大規模なテストでは検出できないまれなシナリオです。以下に例を示します。

- 負の数、ゼロ、境界条件を使用する数学演算。
- 考えられるすべてのネットワーク接続エラー。
- 不正な形式の JSON など、データが破損している。
- ファイルへの保存時にストレージの空き容量不足をシミュレートします。
- プロセスの途中で再作成されるオブジェクト（デバイスが回転されたときのアクティビティなど）。


### 避けるべき単体テスト

一部の単体テストは、価値が低いため避けてください。

- コードではなく、フレームワーク、または、ライブラリの正常な動作を検証するテスト。
- アクティビティ、フラグメント、サービスなどのフレームワークのエントリポイントには、ビジネスロジックを持たせないため、単体テストを優先すべきではありません。アクティビティの単体テストは、ほとんどがフレームワークコードをカバーし、 **より複雑なセットアップが必要になるため、** ほとんど価値がありません。 **UI テストなどのインストルメンテーションテストは、これらのクラスに対応しています。**


## UI テスト

採用すべき UI テストには、次のようなものがあります。

- **画面 UI テスト** : 重要なユーザー インタラクションを 1 つの画面でチェックします。 **ボタンのクリック、フォームへの入力、表示状態の確認など** のアクションを実行します。最初に画面ごとに 1 つのテストクラスを用意することをおすすめします。
- 最も一般的なパスを対象とする **ユーザーフローテスト** または **ナビゲーションテスト** 。これらのテストは、ユーザーがナビゲーション フローを移動する場合をシミュレートします。これはシンプルなテストであり、初期化時の実行時のクラッシュを確認する際に役立ちます。

**注** : **テストカバレッジは、** 一部のテストツールで計算できる指標であり、テストでアクセスしたコードの量を示します。コードベースのテストされていない部分を検出できますが、 **適切なテスト戦略を主張するための唯一の指標として使用しないでください。**


## その他のテスト

スクリーンショットテスト、パフォーマンステスト、 [Monkey テスト](https://developer.android.com/studio/test/other-testing-tools/monkey?_gl=1*1knwern*_up*MQ..*_ga*MzgzNjQyNS4xNzIzMTAyNTUx*_ga_6HH9YJMN9M*MTcyMzEwMjU1MC4xLjAuMTcyMzEwMjU1MC4wLjAuMA..) など、より専門的なテストがあります。回帰、ユーザー補助機能、互換性などの目的別にテストを分類することもできます。


## 参考資料

単独でテストするには、テスト対象の依存関係を、一般的に「テストダブル」と呼ばれる疑似 (フェイク) 、または、モックの依存関係に置き換える必要があります。詳しくは、 [Android でテストダブルを使用する](https://developer.android.com/training/testing/fundamentals/test-doubles?hl=ja&_gl=1*1cn31op*_up*MQ..*_ga*MzgzNjQyNS4xNzIzMTAyNTUx*_ga_6HH9YJMN9M*MTcyMzEwMjU1MC4xLjAuMTcyMzEwMjU1MC4wLjAuMA..) をご覧ください。

単体テストや UI テストの作成方法について詳しくは、 [テストの Codelab](https://developer.android.com/codelabs/advanced-android-kotlin-training-testing-basics?hl=ja&_gl=1*1cn31op*_up*MQ..*_ga*MzgzNjQyNS4xNzIzMTAyNTUx*_ga_6HH9YJMN9M*MTcyMzEwMjU1MC4xLjAuMTcyMzEwMjU1MC4wLjAuMA..) をご覧ください。



