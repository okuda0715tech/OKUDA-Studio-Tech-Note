- [ファイル情報の取得](#ファイル情報の取得)
  - [ファイルの MIME タイプを取得する](#ファイルの-mime-タイプを取得する)
  - [ファイルの名前とサイズを取得する](#ファイルの名前とサイズを取得する)
- [引用元資料](#引用元資料)


# ファイル情報の取得

クライアントアプリは、コンテンツ URI を持つファイルを操作する前に、ファイルのデータ型やファイルサイズなど、ファイルに関する情報をサーバーアプリに要求できます。データ型は、クライアントアプリがファイルを処理できるかどうかを判断するのに役立ち、ファイルサイズは、クライアントアプリがファイルのバッファリングとキャッシュを設定するのに役立ちます。

このレッスンでは、サーバーアプリの [FileProvider](https://developer.android.com/reference/androidx/core/content/FileProvider) を照会して、ファイルの MIME タイプとサイズを取得する方法を説明します。


## ファイルの MIME タイプを取得する

ファイルのデータ型は、クライアントアプリにファイルのコンテンツを処理する方法を示します。コンテンツ URI を指定して共有ファイルのデータ型を取得するには、クライアントアプリは [ContentResolver.getType()](https://developer.android.com/reference/android/content/ContentResolver#getType(android.net.Uri)) を呼び出します。このメソッドは、ファイルの MIME タイプを返します。デフォルトでは、 FileProvider はファイル名拡張子からファイルの MIME タイプを決定します。

次のコードスニペットは、サーバーアプリがコンテンツ URI をクライアントに返した後、クライアントアプリがファイルの MIME タイプを取得する方法を示しています。

```kotlin
...
/*
 * Get the file's content URI from the incoming Intent, then
 * get the file's MIME type
 */
val mimeType: String? = returnIntent.data?.let { returnUri ->
    contentResolver.getType(returnUri)
}
...
```


## ファイルの名前とサイズを取得する

[FileProvider](https://developer.android.com/reference/androidx/core/content/FileProvider) クラスには、コンテンツ URI に関連付けられたファイルの名前とサイズを [Cursor](https://developer.android.com/reference/android/database/Cursor) で返す [query()](https://developer.android.com/reference/android/content/ContentProvider#query(android.net.Uri,%20java.lang.String[],%20android.os.Bundle,%20android.os.CancellationSignal)) メソッドのデフォルト実装があります。デフォルト実装では、次の 2 つの列が返されます:

- [DISPLAY_NAME](https://developer.android.com/reference/android/provider/OpenableColumns#DISPLAY_NAME)
  - ファイル名 ( String 型)。
  - この値は、 [File.getName()](https://developer.android.com/reference/java/io/File#getName()) によって返される値と同じです。
- [SIZE](https://developer.android.com/reference/android/provider/OpenableColumns#SIZE)
  - ファイルのサイズ (バイト単位) ( long 型)。
  - この値は、 [File.length()](https://developer.android.com/reference/java/io/File#length()) によって返される値と同じです。

クライアントアプリは、コンテンツ URI を除く query() のすべての引数を null に設定することで、ファイルの [DISPLAY_NAME](https://developer.android.com/reference/android/provider/OpenableColumns#DISPLAY_NAME) と [SIZE](https://developer.android.com/reference/android/provider/OpenableColumns#SIZE) の両方を取得できます。たとえば、次のコードスニペットは、ファイルの DISPLAY_NAME と SIZE を取得し、それぞれを別の TextView に表示します。

```kotlin
/*
 * Get the file's content URI from the incoming Intent,
 * then query the server app to get the file's display name
 * and size.
 */
returnIntent.data?.let { returnUri ->
    contentResolver.query(returnUri, null, null, null, null)
}?.use { cursor ->
    /*
     * Get the column indexes of the data in the Cursor,
     * move to the first row in the Cursor, get the data,
     * and display it.
     */
    val nameIndex = cursor.getColumnIndex(OpenableColumns.DISPLAY_NAME)
    val sizeIndex = cursor.getColumnIndex(OpenableColumns.SIZE)
    cursor.moveToFirst()
    findViewById<TextView>(R.id.filename_text).text = cursor.getString(nameIndex)
    findViewById<TextView>(R.id.filesize_text).text = cursor.getLong(sizeIndex).toString()
    ...
}
```

その他の関連情報については、以下をご覧ください。

- [プロバイダからデータを取得する](../12.コンテンツプロバイダ/2.コンテンツプロバイダの基本.md/#プロバイダからデータを取得する)


# 引用元資料

- [ファイル情報の取得](https://developer.android.com/training/secure-file-sharing/retrieve-info?hl=ja)

