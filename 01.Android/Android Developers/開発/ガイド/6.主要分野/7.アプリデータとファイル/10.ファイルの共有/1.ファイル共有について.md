- [ファイル共有について](#ファイル共有について)
  - [FileProvider の役割](#fileprovider-の役割)
    - [FileProvider が必要な背景](#fileprovider-が必要な背景)
  - [レッスン](#レッスン)
  - [引用元資料](#引用元資料)


# ファイル共有について

多くの場合、アプリでは 1 つ以上のファイルを、別のアプリに提供する必要があります。たとえば、画像ギャラリーアプリから、画像エディタアプリへファイルを提供する場合や、ファイル管理アプリで、ユーザーが外部ストレージの領域間でファイルをコピーして貼り付けられるようにする場合などです。送信側アプリがファイルを共有する方法の一つとして、受信側アプリからのリクエストに応答する方法があります。

アプリから別のアプリにファイルを提供する安全な方法は、ファイルのコンテンツ URI を受信側のアプリへ送信し、その URI に一時的なアクセス権限を付与することです。 一時的な URI アクセス権限のあるコンテンツ URI は、 **URI を受け取るアプリにのみ適用され** 、自動的に期限切れになるため、安全です。Android の [FileProvider](https://developer.android.com/reference/androidx/core/content/FileProvider?hl=ja) コンポーネントには、ファイルのコンテンツ URI を生成するためのメソッド [getUriForFile()](https://developer.android.com/reference/androidx/core/content/FileProvider?hl=ja#getUriForFile(android.content.Context,%20java.lang.String,%20java.io.File)) が用意されています。

少量のテキスト、または、数値データをアプリ間で共有する場合は、そのデータを含む [Intent](https://developer.android.com/reference/android/content/Intent?hl=ja) を送信する必要があります。Intent を使用してシンプルなデータを送信する方法については、 [シンプルなデータの共有](../9.データの共有/1.データの共有について.md) をご覧ください。

このクラスでは、 Android [FileProvider](https://developer.android.com/reference/androidx/core/content/FileProvider?hl=ja) コンポーネントによって生成されたコンテンツ URI と、コンテンツ URI の一時的な権限を使用して、アプリから別のアプリにファイルを安全に共有する方法について説明します。


## FileProvider の役割

FileProvider の役割は、自分のアプリのアプリ固有ディレクトリ内のファイルを、他のアプリに共有することです。

FileProvider を使う際は、自分で FileProvider クラスを継承する必要はなく、 AndroidX が提供している `androidx.core.content.FileProvider` をそのまま使うことができます。つまり、マニフェストファイルに、 `<provider>` タグを追加して、その `android:name` に `androidx.core.content.FileProvider` を指定するだけで FileProvider が使用可能になります。


### FileProvider が必要な背景

Android 7.0（API 24）以降、 `file://` URI を他アプリに渡すと `FileUriExposedException` が発生します。これは、アプリ間のファイルアクセスをセキュアにするための制限です。その代替手段が FileProvider です。 FileProvider を使用すると、コンテンツプロバイダを介して、 `content://` 形式の URI で、ファイルの URI を共有することが可能です。


## レッスン

- ファイル共有のセットアップ
  - ファイルを共有するようにアプリを設定する方法について学びます。
- ファイルの共有
  - ファイルのコンテンツ URI を生成し、URI にアクセス権限を付与して、URI を他のアプリに送信する方法を学習します。
- 共有ファイルのリクエスト
  - 別のアプリのファイルをリクエストし、ファイルのコンテンツ URI を受け取り、ファイルを開く方法を学習します。
- ファイル情報の取得
  - FileProvider で生成されたコンテンツ URI を使用して、 MIME タイプやファイルサイズなどのファイル情報を取得する方法について学習します。

その他の関連情報については、以下をご覧ください。

- [ストレージオプション](../2.ストレージについて.md)
- [シンプルなデータを共有する](../9.データの共有/1.データの共有について.md)


## 引用元資料

- [ファイルの共有](https://developer.android.com/training/secure-file-sharing?hl=ja)




