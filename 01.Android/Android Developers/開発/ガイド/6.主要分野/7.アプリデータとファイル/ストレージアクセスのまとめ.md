- [ストレージアクセスのまとめ](#ストレージアクセスのまとめ)
  - [API やフレームワーク等の一覧](#api-やフレームワーク等の一覧)
  - [Intent 関連](#intent-関連)
    - [Action](#action)
      - [ACTION\_OPEN\_DOCUMENT と ACTION\_GET\_CONTENT の違い](#action_open_document-と-action_get_content-の違い)
  - [パス](#パス)
    - [外部ストレージ](#外部ストレージ)
  - [権限の一覧](#権限の一覧)
  - [引用元](#引用元)


# ストレージアクセスのまとめ

## API やフレームワーク等の一覧

| API やフレームワーク等           | 役割                                                                                                                 |
| -------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| Storage Access Framework ( SAF ) | 権限なしで、統一された UI からファイルアクセスを提供する                                                             |
| DocumentsProvider                | SAF からアクセス可能なコンテンツプロバイダを実装する。 ContentProvider を継承しています。                            |
| ContentProvider                  | アプリ固有のストレージ内のデータに、他のアプリがアクセスできるインターフェースを提供する。                           |
| FileProvider                     | アプリ固有のストレージ内のファイルに、他のアプリがアクセスできる URI を提供する。 ContentProvider を継承しています。 |
| 写真選択ツール                   | ユーザーが写真 or 動画を選択するための UI を提供し、選択された写真 or 動画の URI を返す                              |
| MediaStore                       | メディアファイルのメタデータをデータベース上で管理する。アプリ間で共有可能なストレージ上で、セキュアなファイル共有を実現する。共有されたファイルは、ギャラリーアプリや音楽アプリから、即時に閲覧可能となる。|


## Intent 関連

### Action

| Action                      | 概要                                                                                                         |
| --------------------------- | ------------------------------------------------------------------------------------------------------------ |
| ACTION_CREATE_DOCUMENT      | SAF を起動して、ファイルを作成する URI を返す。                                                              |
| ACTION_OPEN_DOCUMENT        | SAF を起動して、開きたいファイルの URI を返す。永続的な                                                      |
| ACTION_OPEN_DOCUMENT_TREE   | SAF を起動して、読み書きしたいディレクトリの URI を返す。                                                    |
| ACTION_GET_CONTENT          | 一時的な権限でコンテンツを取得する。 SAF を使用せず、直接他のアプリを開く。                                  |
| ACTION_PICK_IMAGES          | 写真選択ツールを起動する。ただし、非推奨 (※ 1 )                                                              |
| ACTION_MANAGE_STORAGE       | デバイス上の空き容量を確保するために、ファイルを選択して削除するよう、ユーザーに求めるプロンプトを表示する。 |
| ACTION_CLEAR_APP_CACHE      | デバイス上のすべてのアプリから、キャッシュファイルを削除するようユーザーに求める。                           |
| ACTION_OPEN_DOCUMENT        | デバイスで写真選択ツールを使用できない場合、ライブラリが代わりに呼び出すアクション                           |
| ACTION_REQUEST_MANAGE_MEDIA | 設定アプリの [メディア管理アプリ] 画面に移動する。特別なアプリアクセス権を付与したり、破棄する。             |

(※ 1 )  
ACTION_PICK_IMAGES アクションよりも、 ActivityResultContracts.PickVisualMedia を使用して、写真選択ツールを起動する方法が推奨されます。


#### ACTION_OPEN_DOCUMENT と ACTION_GET_CONTENT の違い

- ACTION_OPEN_DOCUMENT
  - コンテンツへの永続的なアクセス権を取得する。
  - SAF を介してコンテンツへアクセスする。
- ACTION_GET_CONTENT
  - コンテンツへの一時的なアクセス権を取得する。
  - SAF を介さず、他のアプリへ直接アクセスして、コンテンツにアクセスする。


## パス

### 外部ストレージ

- 外部ストレージのルート
  - `/storage/emulated/0/`
- 外部ストレージ内のアプリ固有のディレクトリ
  - `/storage/emulated/0/Android/data/<my-package-name>/`
- 外部ストレージの目的別ディレクトリの例
  - `/storage/emulated/0/Documents/` は、 「ドキュメント」 ディレクトリを示します。


## 権限の一覧

| 権限                           | 権限を持っているとできること                                                                                                                 |
| ------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------- |
| READ_EXTERNAL_STORAGE          | 外部ストレージにあるファイルを参照する。                                                                                                     |
| WRITE_EXTERNAL_STORAGE         | 外部ストレージにファイルを更新する。ただし、 Android 10 以降は、アプリ固有ディレクトリ内のファイルか、共有ディレクトリのメディアファイルのみ |
| READ_MEDIA_IMAGES              | 他のアプリが作成した画像 or 写真を参照する。                                                                                                 |
| READ_MEDIA_VIDEO               | 他のアプリが作成した動画を参照する。                                                                                                         |
| READ_MEDIA_AUDIO               | 他のアプリが作成したオーディオを参照する。                                                                                                   |
| ACCESS_MEDIA_LOCATION          | 写真の位置情報にアクセスする。                                                                                                               |
| FLAG_GRANT_READ_URI_PERMISSION | URI が指し示すコンテンツにアクセスする。                                                                                                     |
| MANAGE_EXTERNAL_STORAGE        | 共有ストレージ内のすべてのファイルを参照、更新する。 MediaStore.Files テーブルの内容を参照する。など                                                                                         |
| MANAGE_MEDIA                   |MANAGE_EXTERNAL_STORAGE 権限が付与されている場合に、追加の確認ダイアログを表示させないようにする|


## 引用元

- 各種資料から独自にまとめました。



